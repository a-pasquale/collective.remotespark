function login(a){function d(a){for(;a.hasChildNodes();)a.removeChild(a.firstChild)}hi5.tool.disableInput();var c=!1,b=hi5.browser.cookie2Obj();b.svSession&&b.svEmail&&(a+="&svSession="+b.svSession+"&svEmail="+encodeURIComponent(b.svEmail));(function(a,d){window.__sparkUser=null;var b=new hi5.WebSocket(a);b.onclose=function(){c||(alert(__svi18n.errorCode.connection),showLogDlg());c=!1;hi5.tool.enableInput()};b.onmessage=function(a){c=!0;a=JSON.parse(a.data);a.error||b.send("A1"+navigator.userAgent);
d(a);b.close()};return!1})(a,function(a){hi5.tool.enableInput();if(a.error)alert(__svi18n.errorCode["S"+a.name]);else{document.getElementById("frmLogin").style.display="none";document.getElementById("frmConn").style.display="block";var c=document.getElementById("programs");d(c);var b=a.servers;if(!a.accessNotInList){var g=document.getElementById("anyconn");g&&(g.style.display="none")}window.__sparkUser={session:a.session,account:document.getElementById("user").value,gateway:document.getElementById("gateway").value,
servers:b};a=b.length;if(!(1>a))for(g=0;g<a;g++){var j=b[g].server,k=b[g].id,j=b[g].displayName||k||j,l=b[g].icon;l||(l="rdp32.png");var i=document.createElement("div");i.className="icon";var h=document.createElement("img");h.src=l;h.id=k;h.alt=k;h.title=j;h.style.cursor="pointer";h.onclick=function(a){connect(a.target.id)};i.appendChild(h);i.appendChild(document.createElement("br"));i.appendChild(document.createTextNode(j));c.appendChild(i)}}});return!1}
function connect(a){var d=window.__sparkUser,c=d.servers,b=c.length;d.server=null;window.sparkGateway=d.gateway;for(var f=0;f<b;f++){var e=c[f];if(a==e.id){e=connvertServer(e);e.gateway=d.gateway;e.session=d.session;e.account=d.account;d.server=e;b=e.color;a=window.innerWidth;c=window.innerHeight;e.width=a;e.height=c;b||(b=16);e.width=a;e.height=c;e.color=b;break}}d.server?0<d.server.exe.length&&hi5.browser.isMultitask?openRail():window.open("rdpdirect.html"):alert("Not a valid server")}
function startExitingApp(a){function d(b){c.addSurface(b);c.startExitingApp(a)}var c=svManager.getInstance();window.svOnSurfaceReady=d;window.open("rail.html").svOnSurfaceReady=d;var b=document.getElementById(a),f=b.parentNode;f.removeChild(b);f=f.parentNode;0==f.getElementsByTagName("input").length&&(f.dismiss(),c.checkRemaining(2E3))}
function openRail(){function a(a){c.addSurface(a);c.running()?c.startApp(d.exe,d.args,""):c.run()}var d=window.__sparkUser.server,c=svManager.getInstance();null==c&&(c=new svGlobal.Rdp2(d),c.sessionTimeout=9E5);window.svOnSurfaceReady=a;window.open("rail.html").svOnSurfaceReady=a}function openDesktop(){window.open("rdp.html?gateway="+document.getElementById("gateway").value)}
function showLogDlg(){window.__sparkUser=null;var a=document.getElementById("frmLogin");a.elements.pwd.value="";a.style.display="block";document.getElementById("frmConn").style.display="none";(a=svManager.getInstance())&&a.running()&&a.close()}window.addEventListener("load",function(){document.getElementById("user").focus();var a=hi5.browser.cookie2Obj();if(a.svSession&&a.svEmail){var d=$id("frmLogin").elements;d.user.value=a.svEmail;d.pwd.value="fake";setTimeout(start,1E3)}},!1);
