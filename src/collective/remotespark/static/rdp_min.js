function connvertServer(m){var p={};p.id=m.id;p.server=m.id;p.displayName=m.displayName||m.id;(m=m.rdp)||(m={});p.port=m.port||3389;p.user=m.username||"";p.pwd=m.password||"";p.domain=m.domain||"";p.keyboard=m.keyboard||1033;p.useConsole=m.console||!1;p.legacyMode=m.leagacyMode||m.legacyMode||!1;p.server_bpp=m.color||16;p.playSound=m.playSound||0;p.mapClipboard=m.mapClipboard||!0;p.playSound=m.playSound||0;p.mapPrinter=m.mapPrinter||!0;p.mapDisk=m.mapDisk||!0;p.command=m.command||"";p.directory=m.directory||
"";p.exe=m.remoteProgram||"";p.args=m.remoteArgs||"";p.startProgram=0<p.exe.length?"app":0<p.command.length?"shell":"noapp";m.loadBalanceInfo&&(p.loadBalanceInfo=m.loadBalanceInfo);return p}
function getServers(m,p){var w=Connection.getValue(Connection.KEY_TIMESTAMP),w=null==w?"":"?since="+w;hi5.appcfg&&"boolean"==typeof hi5.appcfg.useWSS&&(m=(hi5.appcfg.useWSS?"wss":"ws")+m.substring(m.indexOf("://")));var q=new hi5.WebSocket(m+w),D=!1,A=!1;q.onmessage=function(m){D=!0;svGlobal.logger.debug(m.data);m=JSON.parse(m.data);m.lastModified&&Connection.setValue(Connection.KEY_TIMESTAMP,m.lastModified+"");if(m=m.connections)for(var p=0,w=m.length;p<w;p++){var J=m[p];null==Connection.getValue(J.id)&&
(Connection.save(J.id,connvertServer(J)),A=!0)}q.close()};q.onclose=function(){p(A,D)}}var svManager={getInstance:function(){return"rdpConnection"in window&&rdpConnection.running()?rdpConnection:null}};svGlobal.getInstance=svManager.getInstance;
window.addEventListener("beforeunload",function(m){var p=svManager.getInstance();if(p&p.isRemoteApp()){var p=p.getRunninApps(),w=p.length;if(0<w){for(var q=__svi18n.remoteApp.warn+"\n\n",D=0;D<w;D++)q+=p[D]+"\n";q+="\n"+__svi18n.remoteApp.close+"\n";hi5.browser.isFirefox&&hi5.notifications.notify({msg:q});m&&(m.returnValue=q);return q}}},!1);
function Rdp2(m){if(!m){var p=window.opener;try{p&&(p.__sparkUser&&p.__sparkUser.server)&&(m=p.__sparkUser.server),!m&&p.sparkServer&&(m=p.sparkServer)}catch(w){}m||(m=hi5.browser.cookie2Obj());if(!m)return alert(__svi18n.noauth),null}var q=p="",D=window.innerWidth,A=window.innerHeight,I=16,F=null,S;for(S in m){svGlobal.logger.debug("** p:"+S+" v="+m[S]);""!=p&&(p+="&");var J=m[S];if("useSSL"==S)F="true"===J||!0===J;else{if("boolean"==typeof J)if(J)J="on";else continue;p+=S+"="+encodeURIComponent(J);
switch(S){case "gateway":q=J;break;case "width":D=parseInt(J);break;case "height":A=parseInt(J);break;case "color":I=parseInt(J)}}}null===F&&(F="https:"==location.protocol);p=(F?"wss://":"ws://")+q+"/RDP?"+p;return new Rdp(p,D,A,I)}svGlobal.Rdp2=Rdp2;
function Rdp(m,p,w,q){var D,A,I,F;function S(){function a(a){a&=65535;return 32767<a?a-65536:a}function b(a){for(var b,d=0,c=0;320>c;c++)b=a[c],A[d++]=b&255,A[d++]=b>>8&255;return A}function c(a,b){var c=Array(8),f=Array(4),j=Array(4),i=Array(4),k=Array(4),g=Array(52),h=b,e=0,e=a[h++]&255;c[0]=e&63;e=(65535&e)>>>6|a[h++]<<2&1023;c[1]=e&63;e=(65535&e)>>>6;e|=a[h++]<<4&4095;c[2]=e&31;e=(65535&e)>>>5;c[3]=e&31;e=(65535&e)>>>5;e|=a[h++]<<2&1023;c[4]=e&15;e=(65535&e)>>>4;c[5]=e&15;e=(65535&e)>>>4;e|=a[h++]<<
2&1023;c[6]=e&7;e=(65535&e)>>>3;c[7]=e&7;e=(65535&e)>>>3;e|=a[h++]<<4&4095;f[0]=e&127;e=(65535&e)>>>7;i[0]=e&3;e=(65535&e)>>>2;j[0]=e&3;e=(65535&e)>>>2;e|=a[h++]<<1&511;k[0]=e&63;e=(65535&e)>>>6;g[0]=e&7;e=a[h++]&255;g[1]=e&7;e=(65535&e)>>>3;g[2]=e&7;e=(65535&e)>>>3;e|=a[h++]<<2&1023;g[3]=e&7;e=(65535&e)>>>3;g[4]=e&7;e=(65535&e)>>>3;g[5]=e&7;e=(65535&e)>>>3;e|=a[h++]<<1&511;g[6]=e&7;e=(65535&e)>>>3;g[7]=e&7;e=(65535&e)>>>3;g[8]=e&7;e=a[h++]&255;g[9]=e&7;e=(65535&e)>>>3;g[10]=e&7;e=(65535&e)>>>3;e|=
a[h++]<<2&1023;g[11]=e&7;e=(65535&e)>>>3;g[12]=e&7;e=(65535&e)>>>3;e|=a[h++]<<4&4095;f[1]=e&127;e=(65535&e)>>>7;i[1]=e&3;e=(65535&e)>>>2;j[1]=e&3;e=(65535&e)>>>2;e|=a[h++]<<1&511;k[1]=e&63;e=(65535&e)>>>6;g[13]=e&7;e=a[h++]&255;g[14]=e&7;e=(65535&e)>>>3;g[15]=e&7;e=(65535&e)>>>3;e|=a[h++]<<2&1023;g[16]=e&7;e=(65535&e)>>>3;g[17]=e&7;e=(65535&e)>>>3;g[18]=e&7;e=(65535&e)>>>3;e|=a[h++]<<1&511;g[19]=e&7;e=(65535&e)>>>3;g[20]=e&7;e=(65535&e)>>>3;g[21]=e&7;e=a[h++]&255;g[22]=e&7;e=(65535&e)>>>3;g[23]=e&
7;e=(65535&e)>>>3;e|=a[h++]<<2&1023;g[24]=e&7;e=(65535&e)>>>3;g[25]=e&7;e=(65535&e)>>>3;e|=a[h++]<<4&4095;f[2]=e&127;e=(65535&e)>>>7;i[2]=e&3;e=(65535&e)>>>2;j[2]=e&3;e=(65535&e)>>>2;e|=a[h++]<<1&511;k[2]=e&63;e=(65535&e)>>>6;g[26]=e&7;e=a[h++]&255;g[27]=e&7;e=(65535&e)>>>3;g[28]=e&7;e=(65535&e)>>>3;e|=a[h++]<<2&1023;g[29]=e&7;e=(65535&e)>>>3;g[30]=e&7;e=(65535&e)>>>3;g[31]=e&7;e=(65535&e)>>>3;e|=a[h++]<<1&511;g[32]=e&7;e=(65535&e)>>>3;g[33]=e&7;e=(65535&e)>>>3;g[34]=e&7;e=a[h++]&255;g[35]=e&7;e=
(65535&e)>>>3;g[36]=e&7;e=(65535&e)>>>3;e|=a[h++]<<2&1023;g[37]=e&7;e=(65535&e)>>>3;g[38]=e&7;e=(65535&e)>>>3;e|=a[h++]<<4&4095;f[3]=e&127;e=(65535&e)>>>7;i[3]=e&3;e=(65535&e)>>>2;j[3]=e&3;e=(65535&e)>>>2;e|=a[h++]<<1&511;k[3]=e&63;e=(65535&e)>>>6;g[39]=e&7;e=a[h++]&255;g[40]=e&7;e=(65535&e)>>>3;g[41]=e&7;e=(65535&e)>>>3;e|=a[h++]<<2&1023;g[42]=e&7;e=(65535&e)>>>3;g[43]=e&7;e=(65535&e)>>>3;g[44]=e&7;e=(65535&e)>>>3;e|=a[h++]<<1&511;g[45]=e&7;e=(65535&e)>>>3;g[46]=e&7;e=(65535&e)>>>3;g[47]=e&7;e=a[h++]&
255;g[48]=e&7;e=(65535&e)>>>3;g[49]=e&7;e=(65535&e)>>>3;e|=a[h++]<<2&1023;g[50]=e&7;e=(65535&e)>>>3;g[51]=e&7;e=(65535&e)>>>3;d(c,f,j,i,k,g,z,0);e&=15;e|=a[h++]<<4&4095;c[0]=e&63;e=(65535&e)>>>6;c[1]=e&63;e=a[h++]&255;c[2]=e&31;e=(65535&e)>>>5;e|=a[h++]<<3&2047;c[3]=e&31;e=(65535&e)>>>5;c[4]=e&15;e=(65535&e)>>>4;e|=a[h++]<<2&1023;c[5]=e&15;e=(65535&e)>>>4;c[6]=e&7;e=(65535&e)>>>3;c[7]=e&7;e=a[h++]&255;f[0]=e&127;e=(65535&e)>>>7;e|=a[h++]<<1&511;i[0]=e&3;e=(65535&e)>>>2;j[0]=e&3;e=(65535&e)>>>2;e|=
a[h++]<<5&8191;k[0]=e&63;e=(65535&e)>>>6;g[0]=e&7;e=(65535&e)>>>3;g[1]=e&7;e=(65535&e)>>>3;e|=a[h++]<<1&511;g[2]=e&7;e=(65535&e)>>>3;g[3]=e&7;e=(65535&e)>>>3;g[4]=e&7;e=a[h++]&255;g[5]=e&7;e=(65535&e)>>>3;g[6]=e&7;e=(65535&e)>>>3;e|=a[h++]<<2&1023;g[7]=e&7;e=(65535&e)>>>3;g[8]=e&7;e=(65535&e)>>>3;g[9]=e&7;e=(65535&e)>>>3;e|=a[h++]<<1&511;g[10]=e&7;e=(65535&e)>>>3;g[11]=e&7;e=(65535&e)>>>3;g[12]=e&7;e=a[h++]&255;f[1]=e&127;e=(65535&e)>>>7;e|=a[h++]<<1&511;i[1]=e&3;e=(65535&e)>>>2;j[1]=e&3;e=(65535&
e)>>>2;e|=a[h++]<<5&8191;k[1]=e&63;e=(65535&e)>>>6;g[13]=e&7;e=(65535&e)>>>3;g[14]=e&7;e=(65535&e)>>>3;e|=a[h++]<<1&511;g[15]=e&7;e=(65535&e)>>>3;g[16]=e&7;e=(65535&e)>>>3;g[17]=e&7;e=a[h++]&255;g[18]=e&7;e=(65535&e)>>>3;g[19]=e&7;e=(65535&e)>>>3;e|=a[h++]<<2&1023;g[20]=e&7;e=(65535&e)>>>3;g[21]=e&7;e=(65535&e)>>>3;g[22]=e&7;e=(65535&e)>>>3;e|=a[h++]<<1&511;g[23]=e&7;e=(65535&e)>>>3;g[24]=e&7;e=(65535&e)>>>3;g[25]=e&7;e=a[h++]&255;f[2]=e&127;e=(65535&e)>>>7;e|=a[h++]<<1&511;i[2]=e&3;e=(65535&e)>>>
2;j[2]=e&3;e=(65535&e)>>>2;e|=a[h++]<<5&8191;k[2]=e&63;e=(65535&e)>>>6;g[26]=e&7;e=(65535&e)>>>3;g[27]=e&7;e=(65535&e)>>>3;e|=a[h++]<<1&511;g[28]=e&7;e=(65535&e)>>>3;g[29]=e&7;e=(65535&e)>>>3;g[30]=e&7;e=a[h++]&255;g[31]=e&7;e=(65535&e)>>>3;g[32]=e&7;e=(65535&e)>>>3;e|=a[h++]<<2&1023;g[33]=e&7;e=(65535&e)>>>3;g[34]=e&7;e=(65535&e)>>>3;g[35]=e&7;e=(65535&e)>>>3;e|=a[h++]<<1&511;g[36]=e&7;e=(65535&e)>>>3;g[37]=e&7;e=(65535&e)>>>3;g[38]=e&7;e=a[h++]&255;f[3]=e&127;e=(65535&e)>>>7;e|=a[h++]<<1&511;i[3]=
e&3;e=(65535&e)>>>2;j[3]=e&3;e=(65535&e)>>>2;e|=a[h++]<<5&8191;k[3]=e&63;e=(65535&e)>>>6;g[39]=e&7;e=(65535&e)>>>3;g[40]=e&7;e=(65535&e)>>>3;e|=a[h++]<<1&511;g[41]=e&7;e=(65535&e)>>>3;g[42]=e&7;e=(65535&e)>>>3;g[43]=e&7;e=a[h++]&255;g[44]=e&7;e=(65535&e)>>>3;g[45]=e&7;e=(65535&e)>>>3;e|=a[h++]<<2&1023;g[46]=e&7;e=(65535&e)>>>3;g[47]=e&7;e=(65535&e)>>>3;g[48]=e&7;e=(65535&e)>>>3;e|=a[h++]<<1&511;g[49]=e&7;e=(65535&e)>>>3;g[50]=e&7;e=(65535&e)>>>3;g[51]=e&7;d(c,f,j,i,k,g,z,160);return z}function d(a,
b,d,c,x,A,z,w){var t=0,e=Array(160);e.fill(0);var B=Array(40);B.fill(0);for(var E=0;3>=E;E++,t+=13){var u=x[E],F=d[E],I=t,C=A,D=B,Da=Array(13);Da.fill(0);var K=void 0,G=K=0;15<u&&(K=(u>>3)-1);G=u-(K<<3);if(0==G)K=-4,G=7;else{for(;7>=G;)G=G<<1|1,K--;G-=8}if(-4>K||6<K)throw"Invalid quantization, exp:"+K;if(0>G||7<G)throw"Invalid quantization, mant = "+G;u=Array(2);u[0]=K;u[1]=G;for(var K=u,u=Da,H=void 0,J=G=void 0,M=void 0,G=g[K[1]],J=j(6,K[0]),K=j(J,1),M=16<=K?0:-16>=K?-0:0>K?16<=-K?0:-16>=-K?0:0>
-K?1<<- -K:1>>-K:1<<K,P=K=0;13>P;P++){H=(C[I++]<<1)-7;if(!(7>=H&&-7<=H))throw"Invalid inverse quantization, temp = "+H;H<<=12;H=n(G,H);H=k(H,M);u[K++]=16<=J?0>H?-1:0:-16>=J?0:0>J?H<<-J:H>>J}C=13;K=u=0;if(!(0<=F&&3>=F))throw"Invalid positioning: Mc = "+F;switch(F){case 3:D[K++]=0;case 2:D[K++]=0;case 1:D[K++]=0;case 0:D[K++]=Da[u++],C--}do D[K++]=0,D[K++]=0,D[K++]=Da[u++];while(0<--C);for(;4>++F;)D[K++]=0;u=b[E];K=c[E];D=B;C=F=Da=void 0;s=C=40>u||120<u?s:u;if(!(40<=C&&120>=C))throw"Invlaid filtering Nr = "+
C;Da=l[K];if(-32768==Da)throw"Invlaid filtering brp = "+Da;for(u=0;39>=u;u++)F=n(Da,m[u-C+120]),m[u+120]=k(D[u],F);hi5.tool.arraycopy(m,40,m,0,120);hi5.tool.arraycopy(m,120,e,40*E,39)}b=Array(8);d=p[q];c=p[q^=1];x=0;i(a,d,x++,0,0,-32,13107);i(a,d,x++,0,0,-32,13107);i(a,d,x++,0,2048,-16,13107);i(a,d,x++,0,-2560,-16,13107);i(a,d,x++,0,94,-8,19223);i(a,d,x++,0,-1792,-8,17476);i(a,d,x++,0,-341,-4,31454);i(a,d,x++,0,-1144,-4,29708);for(a=0;8>a;a++)b[a]=k(c[a]>>2,d[a]>>2),b[a]=k(b[a],c[a]>>1);f(b);h(b,
13,e,z,0,w);for(a=0;8>a;a++)b[a]=k(c[a]>>1,d[a]>>1);f(b);h(b,14,e,z,13,w);for(a=0;8>a;a++)b[a]=k(c[a]>>2,d[a]>>2),b[a]=k(b[a],d[a]>>1);f(b);h(b,13,e,z,27,w);for(a=0;8>a;a++)b[a]=d[a];f(b);h(b,120,e,z,40,w);a=w;for(b=w+160;b-- >w;a++)e=n(y,28180),y=k(z[a],e),z[a]=k(y,y)&65528}function i(a,b,d,c,f,g,h){c=k(a[d],g)<<10;c=j(c,f<<1);c=n(h,c);b[d]=k(c,c)}function f(a){for(var b=0,d=0;8>d;d++)0>a[d]?(b=-32768===a[d]?32767:-a[d],a[d]=-(11059>b?b<<1:20070>b?b+11059:k(b>>2,26112))):(b=a[d],a[d]=11059>b?b<<
1:20070>b?b+11059:k(b>>2,26112))}function h(b,d,c,f,g,h){for(var i=0,n=0,l=0,e=a;0!=d;){d--;for(var i=c[g],m=7;0<=m;m--)n=b[m],l=x[m],l=e(-32768==n&&-32768==l?32767:65535&n*l+16384>>15),i=j(i,l),n=e(-32768==n&&-32768==i?32767:65535&n*i+16384>>15),x[m+1]=k(x[m],n);f[h+g++]=x[0]=i}}function n(b,d){if(-32768==b&&-32768==d)return 32767;var c;c=b*d+16384>>15;return a(c)}function k(a,b){var d=a+b;return-32768>d?-32768:32767<d?32767:d}function j(a,b){var d=a-b;return-32768>d?-32768:32767<d?32767:d}var g=
[18431,20479,22527,24575,26623,28671,30719,32767],l=[3277,11469,21299,32767],m=Array(280);m[0]=0;var p=[Array(8),Array(8)],q=0,s=40,x=Array(9),y=0,A=Array(640);A[0]=0;var z=Array(320);z[0]=0;this.decode=function(a,d,f){for(var g=[];d<f;)var j=c(a,d),g=g.concat(b(j)),d=d+65;return g};this.decodeBytes=c}function J(a,b){function c(a,b,c,f,i){for(var a=a.createImageData(f,i),h=a.data,m=d,f=b+f,i=c+i,p,q=0,x,y=c;y<i;y++)for(x=b;x<f;x++)c=m[y][x],p=q<<2,h[p]=c>>16&255,h[p+1]=c>>8&255,h[p+2]=c&255,h[p+3]=
255,q++;return a}var d=Array(b),i=Array(a);i[0]=0;d[0]=i;for(var f=0;f<b;f++)i=Array(a),i[0]=0,d[f]=i;var h=null;this.width=a;this.height=b;this.getBuffer=function(){return d};this.setRGB=function(a,b,c){d[b][a]=c};this.getRGB=function(a,b){return d[b][a]};this.setRGBs=function(a,b,c,f,i,h,m){for(var p=0,c=a+c,f=b+f,q=d;b<f;b++,h+=m)for(var p=h,x=a;x<c;x++)q[b][x]=i[p++]};this.copyArea=function(a,b,c,f,h,i){for(var m=this.getRGBs(a,b,c,f),a=a+h,i=b+i,b=d,c=a+c,f=i+f,h=0,p=i;p<f;p++)for(i=a;i<c;i++)b[p][i]=
m[h++]};this.getRGBs=function(a,b,c,f){var i=Array(c*f);i[0]=0;for(var h=d,c=a+c,f=b+f,m=0,p=b;p<f;p++)for(b=a;b<c;b++)i[m++]=h[p][b];return i};this.repaint=function(d,f,i,g){d+i>a&&(i=a-d);f+g>b&&(g=b-f);Ta.putImageData(c(Ta,d,f,i,g),d,f)};this.postPaint=function(a,b,d,c){h?h.union(a,b,d,c):h=new hi5.graphic.Rectangle(a,b,d,c)};this.commitPaint=function(){h&&(this.repaint(h.x,h.y,h.width,h.height),h=null)};this.fillRect=function(a,b,c,f,i){for(var h=d,c=a+c,f=b+f,m=b;m<f;m++)for(b=a;b<c;b++)h[m][b]=
i}}function Ea(){var a="SI_"+s.server;Y.domain&&(a+=Y.domain);Y.user&&(a+=Y.user);return a}function Oc(){if(!O&&"sessionStorage"in window&&!Y.pwd){var a=sessionStorage[Ea()];if(null!=a)try{var b=JSON.parse(a);if(!("random"in b))return"";for(var c=b.random,a=0;16>a;a++)c[a]&=255;svGlobal.logger.info("load session, id="+b.logId+" server="+s.server);return"&logId="+b.logId+"&random="+encodeURIComponent(aa.enc(c))}catch(d){}}return""}function Vb(a){return 4278190080|(a>>8&248|a>>13&7)<<16|(a>>3&252|a>>
9&3)<<8|a<<3&248|a>>2&7}function Pc(a){return 4278190080|(a>>7&248|a>>12&7)<<16|(a>>2&248|a>>8&7)<<8|a<<3&248|a>>2&7}function Qc(a){return 4278190080|ma[0][a]<<16|ma[1][a]<<8|ma[2][a]}function Rc(a){return 4278190080|(a&255)<<16|a&65280|(a&16711680)>>16}function Sc(a){return 4278190080|(a&255)<<16|a&65280|(a&16711680)>>16}function Ua(a,b,c,d,i,f){for(var h=0,n=0,k=0,j=k=0,g=0,l=0,m=l=0,p=0,q=b,s=f;n<d;){f=s+4*c*d-4*(n+1)*c;g=0;p=f;h=0;if(0==m)for(;h<c;){k=a[b++]&255;j=k&15;k=k>>4&15;l=j<<4|k;47>=
l&&16<=l&&(j=l,k=0);for(;0<k;)g=a[b++]&255,i[f]=g,f+=4,h++,k--;for(;0<j;)i[f]=g,f+=4,h++,j--}else for(;h<c;){k=a[b++]&255;j=k&15;k=k>>4&15;l=j<<4|k;47>=l&&16<=l&&(j=l,k=0);for(;0<k;)l=a[b++]&255,0!=(l&1)?(l>>=1,l+=1,g=-l):g=l>>=1,l=i[m+4*h]+g,i[f]=l,f+=4,h++,k--;for(;0<j;)l=i[m+4*h]+g,i[f]=l,f+=4,h++,j--}n++;m=p}return b-q}function Tc(a,b,c,d){var i=0;if(16!=d[0])throw"Wrong tag.";var f=1,c=Array(4*a*b);c[0]=0;i=Ua(d,f,a,b,c,3);f+=i;i=Ua(d,f,a,b,c,2);f+=i;i=Ua(d,f,a,b,c,1);Ua(d,f+i,a,b,c,0);a=Math.floor(c.length/
4);b=Array(a);for(i=d=b[0]=0;i<a;i++)d=i<<2,b[i]=(c[d+3]&255)<<24|(c[d+2]&255)<<16|(c[d+1]&255)<<8|(c[d+0]&255)<<0;return b}function Uc(a,b,c,d){function i(a,b){for(var d=0,c=2;0<=c;c--)d<<=8,d|=a[b+c]&255;return d}var f=-1,h=-1,n=0,c=n+c,k=0,j=0,g=0,l=a,m=-1,p=0,q=j=0,s=0,x=g=0,y=4294967295,A=!1,z=!1,r=!1,v=Array(a*b);for(v[0]=0;n<c;){p=0;j=d[n++]&255;k=j>>4;switch(k){case 12:case 13:case 14:k-=6;j&=15;g=16;break;case 15:k=j&15;9>k?(j=d[n++]&255,j|=(d[n++]&255)<<8):j=11>k?8:1;g=0;break;default:k>>=
1,j&=31,g=32}0!=g&&(r=2==k||7==k,0==j?j=r?(d[n++]&255)+1:(d[n++]&255)+g:r&&(j<<=3));switch(k){case 0:m==k&&!(l==a&&-1==f)&&(A=!0);break;case 8:q=i(d,n,3),n+=3;case 3:s=i(d,n,3);n+=3;break;case 6:case 7:y=i(d,n,3);n+=3;k-=5;break;case 9:x=3;k=2;p=3;break;case 10:x=5,k=2,p=5}m=k;for(g=0;0<j;){if(l>=a){if(0>=b)throw"Decompressing bitmap failed! Height = "+b;l=0;b--;f=h;h=0+b*a}switch(k){case 0:A&&(v[h+l]=-1==f?y:v[f+l]^y,A=!1,j--,l++);if(-1==f){for(;0!=(j&-8)&&l+8<a;)for(r=0;8>r;r++)v[h+l]=0,j--,l++;
for(;0<j&&l<a;)v[h+l]=0,j--,l++}else{for(;0!=(j&-8)&&l+8<a;)for(r=0;8>r;r++)v[h+l]=v[f+l],j--,l++;for(;0<j&&l<a;)v[h+l]=v[f+l],j--,l++}break;case 1:if(-1==f){for(;0!=(j&-8)&&l+8<a;)for(r=0;8>r;r++)v[h+l]=y,j--,l++;for(;0<j&&l<a;)v[h+l]=y,j--,l++}else{for(;0!=(j&-8)&&l+8<a;)for(r=0;8>r;r++)v[h+l]=v[f+l]^y,j--,l++;for(;0<j&&l<a;)v[h+l]=v[f+l]^y,j--,l++}break;case 2:if(-1==f){for(;0!=(j&-8)&&l+8<a;)for(r=0;8>r;r++)g<<=1,g&=255,0==g&&(x=0!=p?p&255:d[n++],g=1),v[h+l]=0!=(x&g)?y:0,j--,l++;for(;0<j&&l<a;)g<<=
1,g&=255,0==g&&(x=0!=p?p&255:d[n++],g=1),v[h+l]=0!=(x&g)?y:0,j--,l++}else{for(;0!=(j&-8)&&l+8<a;)for(r=0;8>r;r++)g<<=1,g&=255,0==g&&(x=0!=p?p&255:d[n++],g=1),v[h+l]=0!=(x&g)?v[f+l]^y:v[f+l],j--,l++;for(;0<j&&l<a;)g<<=1,g&=255,0==g&&(x=0!=p?p&255:d[n++],g=1),v[h+l]=0!=(x&g)?v[f+l]^y:v[f+l],j--,l++}break;case 3:for(;0!=(j&-8)&&l+8<a;)for(r=0;8>r;r++)v[h+l]=s,j--,l++;for(;0<j&&l<a;)v[h+l]=s,j--,l++;break;case 4:for(;0!=(j&-8)&&l+8<a;)for(r=0;8>r;r++)v[h+l]=i(d,n,3),n+=3,j--,l++;for(;0<j&&l<a;)v[h+l]=
i(d,n,3),n+=3,j--,l++;break;case 8:for(;0!=(j&-8)&&l+8<a;)for(r=0;8>r;r++)z?(v[h+l]=s,z=!1):(v[h+l]=q,z=!0,j++),j--,l++;for(;0<j&&l<a;)z?(v[h+l]=s,z=!1):(v[h+l]=q,z=!0,j++),j--,l++;break;case 13:for(;0!=(j&-8)&&l+8<a;)for(r=0;8>r;r++)v[h+l]=16777215,j--,l++;for(;0<j&&l<a;)v[h+l]=16777215,j--,l++;break;case 14:for(;0!=(j&-8)&&l+8<a;)for(r=0;8>r;r++)v[h+l]=0,j--,l++;for(;0<j&&l<a;)v[h+l]=0,j--,l++;break;default:throw"Unimplemented decompress opcode "+k;}}}return v}function Wb(a,b,c,d){function i(a,
b){var d=a[b]&255,c=(a[b+1]&255)<<8|d,f=c>>8&248,c=c>>3&252,d=d<<3&255;return(f|f>>5)<<16|(c|c>>6)<<8|d|d>>5}var f=-1,h=-1,n=0,c=n+c,k=0,j=0,g=0,l=a,m=-1,p=0,q=j=0,s=0,x=g=0,y=4294967295,A=!1,z=!1,r=!1,v=Array(a*b);for(v[0]=0;n<c;){p=0;j=d[n++]&255;k=j>>4;switch(k){case 12:case 13:case 14:k-=6;j&=15;g=16;break;case 15:k=j&15;9>k?(j=d[n++]&255,j|=(d[n++]&255)<<8):j=11>k?8:1;g=0;break;default:k>>=1,j&=31,g=32}0!=g&&(r=2==k||7==k,0==j?j=r?(d[n++]&255)+1:(d[n++]&255)+g:r&&(j<<=3));switch(k){case 0:m==
k&&!(l==a&&-1==f)&&(A=!0);break;case 8:q=i(d,n),n+=2;case 3:s=i(d,n);n+=2;break;case 6:case 7:y=i(d,n);n+=2;k-=5;break;case 9:x=3;k=2;p=3;break;case 10:x=5,k=2,p=5}m=k;for(g=0;0<j;){if(l>=a){if(0>=b)throw"Decompressing bitmap failed! Height = "+b;l=0;b--;f=h;h=0+b*a}switch(k){case 0:A&&(v[h+l]=-1==f?y:v[f+l]^y,A=!1,j--,l++);if(-1==f){for(;0!=(j&-8)&&l+8<a;)for(r=0;8>r;r++)v[h+l]=0,j--,l++;for(;0<j&&l<a;)v[h+l]=0,j--,l++}else{for(;0!=(j&-8)&&l+8<a;)for(r=0;8>r;r++)v[h+l]=v[f+l],j--,l++;for(;0<j&&l<
a;)v[h+l]=v[f+l],j--,l++}break;case 1:if(-1==f){for(;0!=(j&-8)&&l+8<a;)for(r=0;8>r;r++)v[h+l]=y,j--,l++;for(;0<j&&l<a;)v[h+l]=y,j--,l++}else{for(;0!=(j&-8)&&l+8<a;)for(r=0;8>r;r++)v[h+l]=v[f+l]^y,j--,l++;for(;0<j&&l<a;)v[h+l]=v[f+l]^y,j--,l++}break;case 2:if(-1==f){for(;0!=(j&-8)&&l+8<a;)for(r=0;8>r;r++)g<<=1,g&=255,0==g&&(x=0!=p?p&255:d[n++]&255,g=1),v[h+l]=0!=(x&g)?y:0,j--,l++;for(;0<j&&l<a;)g<<=1,g&=255,0==g&&(x=0!=p?p&255:d[n++]&255,g=1),v[h+l]=0!=(x&g)?y:0,j--,l++}else{for(;0!=(j&-8)&&l+8<a;)for(r=
0;8>r;r++)g<<=1,g&=255,0==g&&(x=0!=p?p&255:d[n++]&255,g=1),v[h+l]=0!=(x&g)?v[f+l]^y:v[f+l],j--,l++;for(;0<j&&l<a;)g<<=1,g&=255,0==g&&(x=0!=p?p&255:d[n++]&255,g=1),v[h+l]=0!=(x&g)?v[f+l]^y:v[f+l],j--,l++}break;case 3:for(;0!=(j&-8)&&l+8<a;)for(r=0;8>r;r++)v[h+l]=s,j--,l++;for(;0<j&&l<a;)v[h+l]=s,j--,l++;break;case 4:for(;0!=(j&-8)&&l+8<a;)for(r=0;8>r;r++)v[h+l]=i(d,n),n+=2,j--,l++;for(;0<j&&l<a;)v[h+l]=i(d,n),n+=2,j--,l++;break;case 8:for(;0!=(j&-8)&&l+8<a;)for(r=0;8>r;r++)z?(v[h+l]=s,z=!1):(v[h+l]=
q,z=!0,j++),j--,l++;for(;0<j&&l<a;)z?(v[h+l]=s,z=!1):(v[h+l]=q,z=!0,j++),j--,l++;break;case 13:for(;0!=(j&-8)&&l+8<a;)for(r=0;8>r;r++)v[h+l]=16777215,j--,l++;for(;0<j&&l<a;)v[h+l]=16777215,j--,l++;break;case 14:for(;0!=(j&-8)&&l+8<a;)for(r=0;8>r;r++)v[h+l]=0,j--,l++;for(;0<j&&l<a;)v[h+l]=0,j--,l++;break;default:throw"Unimplemented decompress opcode "+k;}}}return v}function Va(a){q=a;Vc=(a+7)/8>>0;switch(a){case 16:ra=Vb;Fb=Wb;break;case 15:ra=Pc;break;case 8:ra=Qc;break;case 32:ra=Rc;Fb=Tc;break;
case 24:ra=Sc,Fb=Uc}}function kb(a,b){p=a;w=b;P=U=0;G=p-1;H=w-1}function Xb(a){var b=__svi18n.errorCode[a];if(b){if(s.onerror)s.onerror({name:a,message:b});s.displayMsg&&hi5.notifications.notify({msg:b});0<svGlobal.log&&console.error(b)}}function Wc(){if(null==Fa)return"";var a=Ga()+"/CLIP?s="+Fa+"&t="+(new Date).getTime(),b=new XMLHttpRequest;b.open("GET",a,!1);b.setRequestHeader("Content-Type","text/plain;charset=UTF-8");b.send(null);return b.responseText}function Od(){function a(a){return a.winWidth&&
a.winHeight&&a.showState&&45<a.winHeight&&45<a.winWidth}var b=[],c=(new Date).getTime(),d=this;this.addWin=function(a){b.push(a)};this.isNew=function(){return 3E4>(new Date).getTime()-c};this.getAll=function(){return b};this.hasWin=function(a){return 0<=b.indexOf(a)};this.close=function(){for(var a=0,d=b.length;a<d;a++)b[a].close()};this.delWin=function(a){for(var d=0,c=b.length;d<c;d++)if(b[d].id==a)return b.splice(d,1),d;return-1};this.isRunning=function(){var d,c=b.length;if(1>c)return!1;for(var h=
0,c=b.length;h<c;h++)if(d=b[h],a(d))return!0;return!1};this.getWinById=function(a){var d,c=b.length;if(1>c)return!1;for(var n=0,c=b.length;n<c;n++)if(d=b[n],d.id==a)return d;return null};this.getTopWin=function(c){var f=null,h,n=c.length;for(h=0;h<n&&(!(f=d.getWinById(c[h]))||!a(f));h++)f=null;if(!f){svGlobal.logger.warn("No win found");n=b.length;for(h=n-1;0<=h&&!(f=b[h],a(f));h--)f=null}return f};this.getMain=function(b){if(b=d.getTopWin(b)){for(var c;0<b.ownerWinid;)if((c=d.getWinById(b.ownerWinid))&&
a(c))b=c;else break;return b}return null}}function lb(a,b){R&&(svGlobal.logger.info("reconnecting..."),C.send("8E0"+(a&-4)+"\t"+(b&-4)))}function lc(a){var b={},c=0;this.read=function(d,i,f){function h(b){b.target.readyState==FileReader.DONE&&(b=new Uint8Array(b.target.result),a.send(d,i,f,b),c+=f,n.setProgress(c))}var n=B.getFocused().fileProgress,k=b[d];if("undefined"!=typeof k){var j=k.name;1>k.size?alert(__svi18n.file.zero+j):(k=k.slice(i,i+f),j=new FileReader,j.onloadend=h,j.readAsArrayBuffer(k))}};
this.addFile=function(d){if(!("slice"in d)&&(d.slice=d.webkitSlice||d.mozSlice,!("slice"in d))){alert(__svi18n.file.slice);return}var c=B.getFocused().fileProgress;"none"==c.style.display&&(c.style.display="block");var f=d.name;b[f]=d;c.maxValue+=d.size;a.start(f,d.size)};this.confirmId=function(a,c){b[a]=b[c]};this.close=function(a){var i=B.getFocused(),f=i.fileProgress,h=b[a];h&&(delete b[a],delete b[h.name]);for(var n in b)return;c=f.maxValue=0;f.style.display="none";i.showMessage(__svi18n.file.uploadDone);
i.refreshFiles()}}function Yb(a){if(ha&&Wa)for(var b=0,c=a.length;b<c;b++)ha.addFile(a[b])}function mc(){this.start=function(a,b){C.send("3A0"+a+"\t"+b)};this.send=function(a,b,c,d){C.send("3A3"+a+"\t"+b+"\t"+c+"\t"+aa.enc(d))}}function Xa(a,b){return E&&E.width>a&&E.height>b?E:new J(a,b)}function Pd(a){svGlobal.logger.warn(a)}function Qd(){svGlobal.logger.info("opened...");R=!0;C.send("87"+navigator.userAgent);if(s.onopen)s.onopen()}function Ya(a){a=aa.dec(a,0);return new RdpBuffer(a,0,a.length)}
function Rd(a){var b,c=a.data;if("string"==typeof c)switch(b=parseInt(c.substring(0,2),16),a=c.substring(2),b){case 15:if(ia&&ia.onopen)ia.onopen();break;case 26:b=JSON.parse(a);if(b.name){svGlobal.logger.info("msg="+a);if(s.onerror)s.onerror(b);a=__svi18n.errorCode["S"+b.name];a+=b.message;s.displayMsg&&s.showMessage(a)}else 0<svGlobal.log&&console.erro("No error code for message:"+a);break;case 27:B.drawLicense(a);break;case 48:nc(Ya(a));break;case 49:oc(Ya(a));break;case 50:b=parseInt(a.substring(0,
1));a=a.substring(1);switch(b){case 1:svGlobal.logger.info("....... copy to clip:"+a);B.copyToClip(a);s.openLink&&(b=0==a.indexOf("http://")||0==a.indexOf("https://")||0==a.indexOf("ftp://")||0==a.indexOf("mailto:")||0==a.indexOf("tel:")||0==a.indexOf("callto:"),!b&&0==a.indexOf("www.")&&(b=!0,a="http://"+a),b&&(b=B.getFocused())&&b.processLink(a));break;case 2:svGlobal.logger.info("....... clipReq, clipString:"+sa),Ha.clipRequired=!0,Ha.prePaste||(C.send("881"+(null==sa?"":sa)),Ha.clipRequired=!1,
sa="")}break;case 51:B.setReadOnly("1"==a);break;case 54:a=Ga()+a;svGlobal.logger.info("Downloading file:"+a);b=B.getFocused();null!=b&&b.showPDF(a);break;case 55:b=parseInt(a.substring(0,1),16);c=a.substring(1);switch(b){case 0:a=c.split("\t");D=parseInt(a[0]);A=parseInt(a[1]);I=parseInt(a[2]);F=parseInt(a[3]);svGlobal.logger.debug("Audio Format, tag="+D+" channels="+A+" bitsPerSample="+I+" samplePerSec="+F);hi5.browser.isFirefox&&null==ba&&(ba=new pc(s.audioBuffer));break;case 1:if(b=function(a){var b=
0,a=a*h;for(k=0;k<h;k++)b|=(f[a+k]&255)<<8*k;b>j?(b-=l,b/=-g):b/=j;return b},a=function(){C.send("8A"+i)},ja.available){var d=c.indexOf("\t"),i=c.substring(0,d),f=aa.dec(c,d+1);49==D&&(Za||(Za=new S),f=Za.decode(f,0,f.length));var c=I,h=c>>3,n=Math.floor(f.length/h),k=0,j=Math.pow(2,c-1)-1,g=-j-1,l=Math.pow(2,c),c=0;if(hi5.browser.isFirefox){d=Array(n);d[0]=0.1;for(c=0;c<n;c++)d[c]=b(c);b=ba.add(d);setTimeout(a,b-1E3*ja.delay)}else{for(var d=A,n=Math.floor(n/d),m=ja.getBuffer(n),q=m.getChannelData(0),
u=m.getChannelData(1),c=0;c<n;){var t=2*c,x=b(t);1==d?(x*=0.707,q[c]=x,u[c]=x):(q[c]=x,u[c]=b(t+1));c++}b=ja.playBuffer(m);setTimeout(a,1E3*(b-ja.delay))}}}break;case 56:$a=a=JSON.parse(a);Fa=a.session;$a.server=s.server;if(a=hi5.$("joinSelect"))a.value=$a.joinMode;if(a=hi5.$("requestControl"))a.disabled=$a.hasControl;break;case 58:b=a;a=parseInt(b.charAt(0));b=b.substring(1);if(5==a)Ha.notifyFiles(JSON.parse(b));else if(null!=ha)switch(b=b.split("\t"),a){case 1:ha.confirmId(b[0],b[1]);break;case 2:ha.read(b[0],
parseInt(b[1]),parseInt(b[2]));break;case 4:ha.close(b[0])}break;case 59:a=aa.dec(a,0);a=(new RdpBuffer(a,0,a.length)).getLittleEndian32();ab||!(a&16)?(mb=!1,ha=null,B.execute("setFileHandler",[null])):a&128&&(ha=null,B.execute("disableUpload",[null]));if(a&64&&(b=__svi18n.info.recording))s.displayMsg&&hi5.notifications.notify({msg:b}),svGlobal.logger.info(b);a&256||B.execute("disableShadow",[null]);break;case 60:qc(Ya(a));break;case 61:a=JSON.parse(a);switch(a.type){case 0:kb(a.width,a.height);E=
Xa(p,w);Va(a.color);if(b=a.server)s.server=a.server;Zb=a.length;if(c=B.getFocused())if(c.setSize(p,w,O?"hidden":null),b&&s.setTitle&&(c.browser.document.title=Y.displayName||s.server),b=a.keyboard,"undefined"!==typeof b&&0===b&&c.setUnicode(!0),b=a.mapDisk)mb=!0,c.setFileHandler(Yb),null==ha&&(ha=new lc(new mc));if(s.onopened)s.onopened(a);break;case 1:if(a=a.duration,s.onprogress)s.onprogress(a,Zb)}break;case 62:b=parseInt(a.substring(0,1),16);var y,c=a.substring(1),a=!1;switch(b){case 0:y=JSON.parse(c);
sa=null;R=!1;ma=null;ud();ca=new $b;bb=0;rc=null;ac=Array(256);nb=[];for(a=0;12>a;a++)sc[a]=Array(256);Gb=Array(20);Ia.reset();R=!0;a=y.width;b=y.height;if(a==p&&b==w)break;kb(a,b);B.setSize(a,b,O?"hidden":null);E=Xa(a,b);break;case 1:tc=s.reconnectOnResize;s.reconnectOnResize=!1;y=JSON.parse(c);s.onsessionjoin&&(a=s.onsessionjoin(y));if(a)break;s.showMessage(__svi18n.info.joinsession.applyArgs([y.numericId,y.__ip,y.name]));break;case 2:y=JSON.parse(c);0===y.joined&&(s.reconnectOnResize=tc);s.onsessionexit&&
(a=s.onsessionexit(y));if(a)break;s.showMessage(__svi18n.info.exitsession.applyArgs([y.numericId,y.__ip,y.name]));break;case 3:B.setReadOnly(!1);if(b=hi5.$("requestControl"))b.disabled=!0;s.ongivecontrol&&(a=s.ongivecontrol());if(a)break;s.showMessage(__svi18n.info.givecontrol);break;case 4:B.setReadOnly(!0);if(b=hi5.$("requestControl"))b.disabled=!1;s.ontakebackcontrol&&(a=s.ontakebackcontrol());if(a)break;s.showMessage(__svi18n.info.nocontrol);break;case 5:y=JSON.parse(c);s.onrequirecontrol&&(a=
s.onrequirecontrol(y));if(a)break;a=__svi18n.info.title.applyArgs([y.name,y.numericId,y.__ip]);hi5.notifications.notify({title:a,msg:"Requesting control.",cbYes:function(){s.giveControl(y.numericId);this.destroy()},cbNo:function(){s.refuseControl(y.numericId);this.destroy()}});break;case 6:B.execute("setTouchRemoting",[!0]);break;case 7:y=JSON.parse(c);y.width&y.height&&(s.reconnectOnResize=!1,E=Xa(y.width,y.height),kb(y.width,y.height),B.setSize(y.width,y.height),svGlobal.logger.warn("Resolution changed, width:"+
y.width+" height:"+y.height));y.color&&(Va(y.color),svGlobal.logger.warn("Color depth changed to:"+y.color));break;case 8:y=JSON.parse(c),B.getFocused().requestCredential(y)}break;case 63:a=Ya(a);ia&&ia.process(a);break;default:svGlobal.logger.warn("@TODO:"+c+"\n")}else switch(a=new Int8Array(c),d=new RdpBuffer(a,0,a.length),b=d.getLittleEndian16(),b){case 48:nc(d);break;case 49:oc(d);break;case 55:switch(d.getByte()){case 0:D=d.getLittleEndian16();A=d.getLittleEndian16();F=d.getLittleEndian32();
d.skipPosition(6);I=d.getLittleEndian16();svGlobal.logger.debug("Audio Format, tag="+D+" channels="+A+" bitsPerSample="+I+" samplePerSec="+F);hi5.browser.isFirefox&&null==ba&&(ba=new pc(s.audioBuffer));break;case 1:if(b=function(){var a=0,a=z[J++]&255|(z[J++]&255)<<8;a>r?(a-=H,a/=-v):a/=r;return a},a=function(){C.send("8A"+G)},ja.available){var G=d.getByte()+","+d.getLittleEndian16()+","+d.getLittleEndian64(),c=d.getPosition(),z=d.getData(),n=d.getEnd()-c;49==D&&(Za||(Za=new S),z=Za.decode(z,c,n),
c=0,n=z.length);var d=I,n=Math.floor(n/(d>>3)),r=Math.pow(2,d-1)-1,v=-r-1,H=Math.pow(2,d),J=c,c=0;if(hi5.browser.isFirefox){d=Array(n);d[0]=0.1;for(c=0;c<n;c++)d[c]=b(c);b=ba.add(d);setTimeout(a,b-1E3*ja.delay)}else{d=A;n=Math.floor(n/d);m=ja.getBuffer(n);q=m.getChannelData(0);u=m.getChannelData(1);for(c=0;c<n;)t=b(),1==d?(t*=0.707,q[c]=t,u[c]=t):(q[c]=t,u[c]=b()),c++;b=ja.playBuffer(m);ab||setTimeout(a,1E3*(b-ja.delay))}}}break;case 60:qc(d);break;case 63:ia&&ia.process(d);break;default:svGlobal.logger.warn("@TODO:"+
b+"\n")}}function qc(a){switch(a.getByte()){case 32:a.getLittleEndian16();var b=a.getLittleEndian16(),a=a.getLittleEndian16();B.getFocused().moveCursor(b,a,!0)}}function pc(a){var b=[],c,d,i,f=new Sd(A,F,function(b){var c=b.length,f=c>h.size();if(d||f)h.stop(),setTimeout(function(){h.start()},1E3*a);else for(f=0;f<c;f++)b[f]=h.pull()}),h=this;this.delay=a;this.reset=function(){c=b.length=0;d=!0;f.stop();i=0};this.reset();this.start=function(){d&&(f.start(),d=!1)};this.stop=function(){f.stop();d=!0};
this.size=function(){for(var a=b.length,c=0,d=0;d<a;d++)c+=b[d].length;return c};this.add=function(c){var d=(new Date).getTime();i<d&&(i=d);i+=1E3*(c.length/(F*A));var h=b.length;b[h]=c;0==h&&(d=(new Date).getTime(),setTimeout(function(){f.start()},1E3*a));return i-d};this.pull=function(){if(0==b.length)return null;var a=b[0];if(c<a.length)return a[c++];b.shift();c=0;return this.pull()}}function Sd(a,b,c){function d(){var a;if(n){a=i.mozWriteAudio(n.subarray(k));f+=a;k+=a;if(k<n.length)return;n=null}a=
i.mozCurrentSampleOffset()+h-f;if(0<a){var b=new Float32Array(a);c(b);a=i.mozWriteAudio(b);a<b.length&&(n=b,k=a);f+=a}}var i=new Audio;i.mozSetup(a,b);var f=0,h=a*b/2,n=null,k=0,j=null;this.start=function(){j=setInterval(d,100)};this.stop=function(){null!=j&&clearInterval(j)}}function Ga(){var a=m.indexOf("://"),b=m.substring(a+3),a=b.indexOf("/");0<a&&(b=b.substring(0,a));return location.protocol+"//"+b}function nc(a){var b=a.getLittleEndian16(),c=a.getByte(),d=a.getByte(),i=a.getLittleEndian16(),
f=null;if(0!=(d&32)){if(65536<b)throw"Invalid package size for decompression.";if(-1==Ia.dec(a.getData(),a.getPosition(),i-18,d))throw"Error on decompressing data.";f=Ia.getData()}else f=a;switch(c){case 2:var h=f,n=h.getLittleEndian16();switch(n){case 0:h.skipPosition(2);n=h.getLittleEndian16();h.skipPosition(2);uc(h,n);break;case 1:vc(h);break;case 2:wc(h);break;case 3:break;default:svGlobal.logger.warn("Unimplemented Update type "+n)}break;case 20:break;case 31:break;case 27:h=f;n=0;n=h.getLittleEndian16();
h.skipPosition(2);switch(n){case 3:h.skipPositon(4);break;case 6:Hb(h,24);break;case 7:xc(h);break;case 1:h=h.getLittleEndian16();switch(h){case 0:B.setCursor("default");break;default:svGlobal.logger.warn("XXX system pointer message "+h)}break;case 8:n=h.getLittleEndian16(),Hb(h,n)}break;case 34:break;case 38:a=f;b=a.getLittleEndian32();if(3>b){Wa=!0;try{var k=s.sessionInfo;switch(b){case 0:a.skipPosition(4);k.domain=a.getUnicodeString(52,!0);a.skipPosition(4);k.userName=a.getUnicodeString(512,!0);
k.sessionId=a.getLittleEndian32();break;case 1:k.version=a.getLittleEndian16(),a.skipPosition(4),k.sessionId=a.getLittleEndian32(),h=a.getLittleEndian32(),n=a.getLittleEndian32(),a.skipPosition(558),k.domain=a.getUnicodeString(h,!0),k.userName=a.getUnicodeString(n,!0)}if(s.onloggedin)s.onloggedin()}catch(j){}}else if(3==b&&(a.skipPosition(2),2!=a.getLittleEndian32())){a.skipPosition(4);if(28!=a.getLittleEndian32())throw"Invalid length of SaveSessoinInfo PDU";a.skipPosition(4);h={};h.logId=a.getLittleEndian32();
h.time=(new Date).getTime();s.sessionInfo.sessionId=h.logId;if(!Wa&&s.onloggedin)s.onloggedin();Wa=!0;n=a.getBytes(16);k=Array(16);for(a=0;16>a;a++)k[a]=n[a]&255;h.random=k;C.send("8D"+h.logId+"\t"+aa.enc(k));if("sessionStorage"in window)try{sessionStorage[Ea()]=JSON.stringify(h)}catch(g){}}break;case 40:C.send("8E50");break;case 41:break;case 47:h=f.getLittleEndian32();1>h||Xb(h);break;case 54:h=f.getLittleEndian32().toString(16).toUpperCase();h=__svi18n.serverStatus[h];s.displayMsg&&s.showMessage(h);
break;case 55:break;default:svGlobal.logger.warn("Unimplemented Data PDU type "+c)}}function oc(a){var b=a.getByte(),c=b&15,d=b>>4&3;if(0!=d)throw"Fragmentation is not supported yet";var i,f=0;2==(b>>6&3)&&(f=a.getByte());i=a.getLittleEndian16();b=null;if(0!=(f&32)){if(1!=(f&15))throw"only support PACKET_COMPR_TYPE_64K";if(-1==Ia.dec(a.getData(),a.getPosition(),i,f))throw __svi18n.errorDecompress;b=Ia.getData()}else b=a;if(0!=d)if(2==d&&(null==va?va=[]:va.length=0),va.push(b.getData().slice(b.getPosition(),
b.getEnd())),1==d){a=0;d=va.length;for(a=0;a<d;a++);f=[];for(a=0;a<d;a++)f.concat(va[a]);b=new RdpBuffer(f,0,f.length);va.length=0}else return;switch(c){case 0:c=b.getLittleEndian16();uc(b,c);break;case 1:b.skipPosition(2);vc(b);break;case 2:b.skipPosition(2);wc(b);break;case 3:break;case 5:B.setCursor("default");break;case 6:break;case 8:break;case 9:Hb(b,24);break;case 10:xc(b);break;case 11:c=b;a=c.getLittleEndian16();Hb(c,a);break;default:svGlobal.logger.warn("XXX RDP5 opcode "+c)}}function xc(a){a=
a.getLittleEndian16();(a=yc(a))&&B.setCursor(a)}function Td(a,b,c,d,i,f,h,n){this.x=a;this.y=b;this.width=c;this.height=d;this.mask=i;this.pixel=f;this.bpp=h;this.cache_idx=n}function Hb(a,b){if(!Ud){var c=0,d=0,i=0,f=0,h=0,n=0,k=0,h=a.getLittleEndian16(),c=a.getLittleEndian16(),d=a.getLittleEndian16(),i=a.getLittleEndian16(),f=a.getLittleEndian16(),n=a.getLittleEndian16(),k=a.getLittleEndian16(),k=a.getBytes(k),j=a.getBytes(n);if(0>c||c>=i-1)c=0;0>d?d=0:d>=f&&(d=f-1);for(var g=!0,l=0;l<n;l++)if(-1!=
j[l]){g=!1;break}if(!g){k=new Td(c,d,i,f,j,k,b,h);if(!hi5.browser.isOpera){var d=k.x,i=k.y,n=k.width,f=k.height,c=k.cache_idx,j=k.mask,g=k.pixel,l=k.bpp,k=Array(n*f),m=k[0]=0,p=0<d&&0==j[0],q=0,s,x;for(s=0;s<f;s++)for(x=0;x<n;x++){k[m]=Vd(x,s,n,f,l,g);if(!p)if(q=s,1!=l&&(q=f-q-1),q=q*n+x,q=0==(j[q/8>>0]&128>>q%8)?1:0,0==q&&0!=k[m])k[m]=~k[m],k[m]|=4278190080;else if(1==q||0!=k[m])k[m]|=4278190080;m++}g=4*n*f;l=n*f/8;j=62+g+l+l;m=Array(j);m[0]=0;j=new RdpBuffer(m,0,j);j.setLittleEndian16(0);j.setLittleEndian16(2);
j.setLittleEndian16(1);j.setByte(n);j.setByte(f);j.setByte(0);j.setByte(0);j.setLittleEndian16(d);j.setLittleEndian16(i);j.setLittleEndian32(40+g+l+l);j.setLittleEndian32(22);j.setLittleEndian32(40);j.setLittleEndian32(n);j.setLittleEndian32(2*f);j.setLittleEndian16(1);j.setLittleEndian16(32);j.setLittleEndian32(0);j.setLittleEndian32(l+l);j.setLittleEndian32(0);j.setLittleEndian32(0);j.setLittleEndian32(0);j.setLittleEndian32(0);for(g=f-1;0<=g;g--)for(l=0;l<n;l++)m=k[n*g+l],j.setByte(m&255),j.setByte(m>>
8&255),j.setByte(m>>16&255),j.setByte(m>>24&255);n=n/8>>0;for(g=0;g<f;g+=1)for(l=0;l<n;l+=1)j.setByte(0);for(g=0;g<f;g+=1)for(l=0;l<n;l+=1)j.setByte(0);d={data:"data:image/x-icon;base64,"+aa.enc(j.getData()),hotX:d,hotY:i};if(20>c)Gb[c]=d;else throw"Could not put Cursor!";}(h=yc(h))&&B.setCursor(h)}}}function Vd(a,b,c,d,i,f){1!=i&&(b=d-b-1);b=(b*c+a)*i;c=b/8>>0;a=f[c]&255;switch(i){case 1:return 0==(a&128>>b%8)?0:4294967295;case 8:return 0==a?0:4294967295;case 15:return a|=(f[c+1]&255)<<8,i=Array(4),
Ib(a,15,i,0),i[0]<<16|i[1]<<8|i[2];case 16:return a|=(f[c+1]&255)<<8,i=Array(4),Ib(a,16,i,0),i[0]<<16|i[1]<<8|i[2];case 24:return(f[c+2]&255)<<16|(f[c+1]&255)<<8|a;case 32:return(f[c+3]&255)<<24|(f[c+2]&255)<<16|(f[c+1]&255)<<8|a;default:throw"invalid bpp value for Xor Mask.";}}function wc(a){var b=0,c=null,d=null,i=null,f=0;a.skipPosition(2);b=a.getLittleEndian16();a.skipPosition(2);for(var c=Array(b),d=Array(b),i=Array(b),a=a.getBytes(3*b),h=0;h<b;h++)c[h]=a[f],d[h]=a[f+1],i[h]=a[f+2],f+=3;256==
b&&(null==ma&&(ma=Array(3)),ma[0]=c,ma[1]=d,ma[2]=i)}function uc(a,b){for(var c=0,d=0,i=0;c<b;){d=a.getByte();i=d&3;switch(i){case 1:var f=a,h=d,n=0,k=0,j=!1;if(0==(h&1))throw"Not a standard order!";0!=(h&8)&&(ca.orderType=f.getByte());switch(ca.orderType){case 14:case 27:k=3;break;case 1:case 13:case 9:k=2;break;default:k=1}var g=f,l=k,m=0,s=0;0!=(h&64)&&l--;0!=(h&128)&&(l=2>l?0:l-2);for(var A=0;A<l;A++)s=g.getByte(),m|=s<<8*A;n=m;if(0!=(h&4)){if(0==(h&32)){var t=f,x=ca.bounds,y=t.getByte();0!=(y&
1)?x.left=u(t,x.left,!1):0!=(y&16)&&(x.left=u(t,x.left,!0));0!=(y&2)?x.top=u(t,x.top,!1):0!=(y&32)&&(x.top=u(t,x.top,!0));0!=(y&4)?x.right=u(t,x.right,!1):0!=(y&64)&&(x.right=u(t,x.right,!0));0!=(y&8)?x.bottom=u(t,x.bottom,!1):0!=(y&128)&&(x.bottom=u(t,x.bottom,!0))}var F=ca.bounds;U=F.left;P=F.top;G=F.right;H=F.bottom}j=0!=(h&16);switch(ca.orderType){case 0:var z=f,r=ca.destBlt,v=n,C=j;0!=(v&1)&&(r.x=u(z,r.x,C));0!=(v&2)&&(r.y=u(z,r.y,C));0!=(v&4)&&(r.cx=u(z,r.cx,C));0!=(v&8)&&(r.cy=u(z,r.cy,C));
0!=(v&16)&&(r.opcode=zc(z.getByte()));var D=r.x,I=r.y,J=r.cx,M=r.cy,R=r.opcode;if(!(D>p||I>w)){var Q=D+J-1;Q>G&&(Q=G);D<U&&(D=U);var J=Q-D+1,e=I+M-1;e>H&&(e=H);I<P&&(I=P);M=e-I+1;1>J||1>M||(bc(R,E,p,D,I,J,M,null,0,0,0),E.repaint(D,I,J,M))}break;case 1:var S=f,T=ca.patBlt,O=n,Y=j;0!=(O&1)&&(T.x=u(S,T.x,Y));0!=(O&2)&&(T.y=u(S,T.y,Y));0!=(O&4)&&(T.cx=u(S,T.cx,Y));0!=(O&8)&&(T.cy=u(S,T.cy,Y));if(0!=(O&16)){var ma=T,ha=S.getByte();ma.opcode=ha&3|(ha&48)>>2}0!=(O&32)&&(T.backgroundColor=Ja(S));0!=(O&64)&&
(T.foregroundColor=Ja(S));vd(S,T.brush,O>>7);var ia=T.x,ja=T.y;if(!(ia>G||ja>H)){var K=T.opcode,aa=ia,ba=ja,qa=T.cx,ya=T.cy,sa=T.foregroundColor,va=T.backgroundColor,Ta=T.brush.xOrigin,Wa=T.brush.yOrigin,Ha=T.brush.style,Za=T.brush.pattern,sa=ra(sa),va=ra(va),Ea=aa+qa-1;Ea>G&&(Ea=G);aa<U&&(aa=U);var qa=Ea-aa+1,Fa=ba+ya-1;Fa>H&&(Fa=H);ba<P&&(ba=P);ya=Fa-ba+1;if(!(1>qa||1>ya)){var Ka=null;switch(Ha){case 0:for(var Ka=Array(qa*ya),ob=Ka[0]=0;ob<Ka.length;ob++)Ka[ob]=sa;bc(K,E,p,aa,ba,qa,ya,Ka,qa,0,0);
E.repaint(aa,ba,qa,ya);break;case 2:svGlobal.logger.warn("hatch");break;case 3:for(var Ka=Array(qa*ya),$a=Ka[0]=0,ob=0;ob<ya;ob++)for(var Ia=0;Ia<qa;Ia++)Ka[$a]=0==(Za[(ob+Wa)%8]&1<<(Ia+Ta)%8)?sa:va,$a++;bc(K,E,p,aa,ba,qa,ya,Ka,qa,0,0);E.repaint(aa,ba,qa,ya);break;default:svGlobal.logger.warn("Unsupported brush style "+Ha)}}}break;case 2:var pb=f,W=ca.screenBlt,qb=n,Jb=j;0!=(qb&1)&&(W.x=u(pb,W.x,Jb));0!=(qb&2)&&(W.y=u(pb,W.y,Jb));0!=(qb&4)&&(W.cx=u(pb,W.cx,Jb));0!=(qb&8)&&(W.cy=u(pb,W.cy,Jb));0!=
(qb&16)&&(W.opcode=zc(pb.getByte()));0!=(qb&32)&&(W.srcX=u(pb,W.srcX,Jb));0!=(qb&64)&&(W.srcY=u(pb,W.srcY,Jb));var La=W.x,Ma=W.y;if(!(La>G||Ma>H)){var cb=W.cx,Kb=W.cy,ib=W.opcode,xa=W.srcX,cc=W.srcY,Ua=La+cb-1;Ua>G&&(Ua=G);La<U&&(La=U);var cb=Ua-La+1,Va=Ma+Kb-1;Va>H&&(Va=H);Ma<P&&(Ma=P);Kb=Va-Ma+1;xa+=La-W.x;cc+=Ma-W.y;1>cb||1>Kb||(12!=ib?bc(ib,E,cb,La,Ma,cb,Kb,null,cb,xa,cc):E.copyArea(xa,cc,cb,Kb,La-xa,Ma-cc),E.repaint(La,Ma,cb,Kb))}break;case 9:var db=f,$=ca.line,eb=n,Ga=j;0!=(eb&1)&&($.mixmode=
db.getLittleEndian16());0!=(eb&2)&&($.startX=u(db,$.startX,Ga));0!=(eb&4)&&($.startY=u(db,$.startY,Ga));0!=(eb&8)&&($.endX=u(db,$.endX,Ga));0!=(eb&16)&&($.endY=u(db,$.endY,Ga));0!=(eb&32)&&($.backgroundColor=Ja(db));0!=(eb&64)&&($.opcode=db.getByte());var Xa=db,Ya=$.pen,ab=eb>>7;0!=(ab&1)&&(Ya.style=Xa.getByte());0!=(ab&2)&&(Ya.width=Xa.getByte());0!=(ab&4)&&(Ya.color=Ja(Xa));var rb=$.startX,Na=$.startY,sb=$.endX,dc=$.endY,Hb=$.pen.color,Ub=$.opcode-1;if(Na==dc){if(rb>sb)var jb=rb,rb=sb,sb=jb;rb<
U&&(rb=U);sb>G&&(sb=G)}else rb==sb&&(Na>dc&&(jb=Na,Na=dc,dc=jb),Na<P&&(Na=P),Na>H&&(Na=H));wd(rb,Na,sb,dc,Hb,Ub);break;case 10:var tb=f,na=ca.rectangle,ub=n,Ac=j;0!=(ub&1)&&(na.x=u(tb,na.x,Ac));0!=(ub&2)&&(na.y=u(tb,na.y,Ac));0!=(ub&4)&&(na.cx=u(tb,na.cx,Ac));0!=(ub&8)&&(na.cy=u(tb,na.cy,Ac));0!=(ub&16)&&(bb=bb&4294967040|tb.getByte());0!=(ub&32)&&(bb=bb&4294902015|tb.getByte()<<8);0!=(ub&64)&&(bb=bb&4278255615|tb.getByte()<<16);na.color=bb;Xc(na.x,na.y,na.cx,na.cy,na.color,!0);break;case 11:var Lb=
f,wa=ca.deskSave,Mb=n,Bc=j;0!=(Mb&1)&&(wa.offset=Lb.getLittleEndian32());0!=(Mb&2)&&(wa.left=u(Lb,wa.left,Bc));0!=(Mb&4)&&(wa.top=u(Lb,wa.top,Bc));0!=(Mb&8)&&(wa.right=u(Lb,wa.right,Bc));0!=(Mb&16)&&(wa.bottom=u(Lb,wa.bottom,Bc));0!=(Mb&32)&&(wa.action=Lb.getByte());var Oa=wa,kb=Oa.right-Oa.left+1,lb=Oa.bottom-Oa.top+1;if(0==Oa.action)1>kb||1>lb||(rc=E.getRGBs(Oa.left,Oa.top,kb,lb));else{var mb=kb,Gb=lb,Ib=Oa.left,Tb=Oa.top;rc?(E.setRGBs(Ib,Tb,mb,Gb,rc,0,mb),E.repaint(Ib,Tb,mb,Gb)):svGlobal.logger.warn("XXX no matched desktop save.")}break;
case 13:var za=f,da=ca.memBlt,Pa=n,Nb=j;0!=(Pa&1)&&(da.cacheID=za.getByte(),da.colorTable=za.getByte());0!=(Pa&2)&&(da.x=u(za,da.x,Nb));0!=(Pa&4)&&(da.y=u(za,da.y,Nb));0!=(Pa&8)&&(da.cx=u(za,da.cx,Nb));0!=(Pa&16)&&(da.cy=u(za,da.cy,Nb));0!=(Pa&32)&&(da.opcode=zc(za.getByte()));0!=(Pa&64)&&(da.srcX=u(za,da.srcX,Nb));0!=(Pa&128)&&(da.srcY=u(za,da.srcY,Nb));0!=(Pa&256)&&(da.cacheIDX=za.getLittleEndian16());var ka=da,Qa=ka.x,Ra=ka.y;if(!(Qa>G||Ra>H)){var ec=ka.cx,fc=ka.cy,Cc=ka.srcX,Dc=ka.srcY,Db=Qa+
ec-1;Db>G&&(Db=G);Qa<U&&(Qa=U);var ec=Db-Qa+1,Eb=Ra+fc-1;Eb>H&&(Eb=H);Ra<P&&(Ra=P);fc=Eb-Ra+1;Cc+=Qa-ka.x;Dc+=Ra-ka.y;255==ka.cacheID&&svGlobal.logger.warn("XXX: offscree");var vb=void 0;var Yc=ka.cacheID,Vb=ka.cacheIDX,vb="undefined"==typeof nb[Yc]?null:"undefined"==typeof nb[Yc][Vb]?null:nb[Yc][Vb];null==vb?svGlobal.logger.warn("Failed to get bitmap from cache, id:"+ka.cacheID+" idx="+ka.cacheIDX):(12==ka.opcode?E.setRGBs(Qa,Ra,ec,fc,vb.byteArray,Dc*vb.width+Cc,vb.width):bc(ka.opcode,E,p,Qa,Ra,
ec,fc,vb.byteArray,vb.width,Cc,Dc),E.repaint(Qa,Ra,ec,fc))}break;case 14:var oa=f,Z=ca.triBlt,pa=n,Ob=j;0!=(pa&1)&&(Z.cacheID=oa.getByte(),Z.colorTable=oa.getByte());0!=(pa&2)&&(Z.x=u(oa,Z.x,Ob));0!=(pa&4)&&(Z.y=u(oa,Z.y,Ob));0!=(pa&8)&&(Z.cx=u(oa,Z.cx,Ob));0!=(pa&16)&&(Z.cy=u(oa,Z.cy,Ob));0!=(pa&32)&&(Z.opcode=zc(oa.getByte()));0!=(pa&64)&&(Z.srcX=u(oa,Z.srcX,Ob));0!=(pa&128)&&(Z.srcY=u(oa,Z.srcY,Ob));0!=(pa&256)&&(Z.backgroundColor=Ja(oa));0!=(pa&512)&&(Z.foregroundColor=Ja(oa));vd(oa,Z.brush,pa>>
10);0!=(pa&32768)&&(Z.cacheIDX=oa.getLittleEndian16());0!=(pa&65536)&&(Z.unknown=oa.getLittleEndian16());svGlobal.logger.warn("XXX: TriBlt");break;case 22:var wb=f,Aa=ca.polyLine,Pb=n,Wb=j;0!=(Pb&1)&&(Aa.x=u(wb,Aa.x,Wb));0!=(Pb&2)&&(Aa.y=u(wb,Aa.y,Wb));0!=(Pb&4)&&(Aa.opcode=wb.getByte());0!=(Pb&16)&&(Aa.foregroundColor=Ja(wb));0!=(Pb&32)&&(Aa.lines=wb.getByte());if(0!=(Pb&64)){var Xb=wb.getByte();Aa.dataSize=Xb;Aa.data=wb.getBytes(Xb)}var xb=Aa,Ec=xb.x,Fc=xb.y,lc=xb.foregroundColor,Yb=xb.lines,mc=
xb.dataSize,Zc=xb.data,Gc=Array(1);Gc[0]=Math.floor((Yb-1)/4)+1;for(var fb=0,nc=0,oc=xb.opcode-1,$c=0;$c<Yb&&Gc[0]<mc;$c++){var pc=Ec,qc=Fc;0==$c%4&&(fb=Zc[nc++]);0==(fb&192)&&(fb|=192);0!=(fb&64)&&(Ec+=xd(Zc,Gc));0!=(fb&128)&&(Fc+=xd(Zc,Gc));wd(pc,qc,Ec,Fc,lc,oc);fb<<=2}break;case 27:var V=f,L=ca.text2,X=n;0!=(X&1)&&(L.font=V.getByte());0!=(X&2)&&(L.flags=V.getByte());0!=(X&4)&&(L.opcode=V.getByte());0!=(X&8)&&(L.mixmode=V.getByte());0!=(X&16)&&(L.foregroundColor=Ja(V));0!=(X&32)&&(L.backgroundColor=
Ja(V));0!=(X&64)&&(L.clipLeft=V.getLittleEndian16());0!=(X&128)&&(L.clipTop=V.getLittleEndian16());0!=(X&256)&&(L.clipRight=V.getLittleEndian16());0!=(X&512)&&(L.clipBottom=V.getLittleEndian16());0!=(X&1024)&&(L.boxLeft=V.getLittleEndian16());0!=(X&2048)&&(L.boxTop=V.getLittleEndian16());0!=(X&4096)&&(L.boxRight=V.getLittleEndian16());0!=(X&8192)&&(L.boxBottom=V.getLittleEndian16());0!=(X&16384)&&V.skipPosition(1);0!=(X&32768)&&V.skipPosition(1);0!=(X&65536)&&V.skipPosition(1);0!=(X&131072)&&V.skipPosition(1);
0!=(X&262144)&&V.skipPosition(7);0!=(X&524288)&&(L.x=V.getLittleEndian16());0!=(X&1048576)&&(L.y=V.getLittleEndian16());0!=(X&2097152)&&(L.length=V.getByte(),L.text=V.getBytes(L.length));var Zb=L.font,Ba=L.flags,ad=L.mixmode,$b=L.foregroundColor,Hc=L.backgroundColor,bd=L.clipLeft,cd=L.clipTop,gc=L.boxLeft,dd=L.boxTop,fa=L.x,ta=L.y,yb=L.length,la=L.text,ed=L.clipRight-bd,fd=L.clipBottom-cd,Qb=L.boxRight-gc,gd=L.boxBottom-dd,ga=null,gb=0,ea=0;gc+Qb>p&&(Qb=p-gc);1<Qb?Xc(gc,dd,Qb,gd,Hc,!1):1==ad&&Xc(bd,
cd,ed,fd,Hc,!1);for(var tc=la.length,N=0;N<yb;)switch(la[ea+N]&255){case 255:var hd=la[ea+N+2]&255;if(hd>tc-ea){N=yb=0;break}var id=Array(la[ea+N+2]&255);id[0]=0;for(var uc=la,vc=ea,wc=id,xc=hd,Ic=0;Ic<xc;Ic++)wc[0+Ic]=uc[vc+Ic];var yc=new Wd(hd,id),hc=la[ea+N+1]&255;if(hc<ac.length)ac[hc]=yc;else throw"Could not put Text in cache";N+=3;yb-=N;ea=N;N=0;break;case 254:var zb;a:{var ic=la[ea+N+1]&255,Jc=null;if(ic<ac.length&&(Jc=ac[ic],null!=Jc&&null!=Jc.data)){zb=Jc;break a}zb=null}var Ab=null!=zb?
zb.data:null;null!=zb&&0==Ab[1]&&0==(Ba&32)&&(0!=(Ba&4)?ta+=la[ea+N+2]&255:fa+=la[ea+N+2]&255);N=N+2<yb?N+3:N+2;yb-=N;ea=N;N=0;if(null==zb)break;for(var Nc=zb.size,Ca=0;Ca<Nc;Ca++)ga=yd(Zb,Ab[Ca]&255),0==(Ba&32)&&(gb=Ab[++Ca]&255,0!=(gb&128)?(0!=(Ba&4)?ta+=Ab[Ca+1]&255|(Ab[Ca+2]&255)<<8:fa+=Ab[Ca+1]&255|(Ab[Ca+2]&255)<<8,Ca+=2):0!=(Ba&4)?ta+=gb:fa+=gb),null!=ga&&(zd(ad,fa+ga.offset&65535,ta+ga.baseLine&65535,ga.width,ga.height,ga.fontData,Hc,$b,Vc,q),0!=(Ba&32)&&(fa+=ga.width));break;default:ga=yd(Zb,
la[ea+N]&255),0==(Ba&32)&&(gb=la[ea+ ++N]&255,0!=(gb&128)?(0!=(Ba&4)?ta+=la[ea+N+1]&255|(la[ea+N+2]&255)<<8:fa+=la[ea+N+1]&255|(la[ea+N+2]&255)<<8,N+=2):0!=(Ba&4)?ta+=gb:fa+=gb),null!=ga&&(zd(ad,fa+ga.offset&65535,ta+ga.baseLine&65535,ga.width,ga.height,ga.fontData,Hc,$b,Vc,q),0!=(Ba&32)&&(fa+=ga.width)),N++}1<Qb?0<gd&&E.postPaint(gc,dd,Qb,gd):0<ed&&0<fd&&E.postPaint(bd,cd,ed,fd);break;default:svGlobal.logger.warn("XXX Order type "+ca.orderType)}0!=(h&4)&&ud();break;case 2:var jc=a,kc=d>>2;if(2!=
(d&3))throw"Not a valid Alt secondary order";switch(kc){case 11:var Rb=jc,Oc=Rb.getLittleEndian16(),Bb=Rb.getLittleEndian32(),Pc=Rb.getPosition()+(Oc-7);if(0!=(Bb&16777216))Xd(Bb,Rb);else if(0!=(Bb&33554432))svGlobal.logger.info("XXX Alt Sec window Notify="+Bb);else if(0!=(Bb&67108864)){var Sb=Bb,jd=Rb;svGlobal.logger.info("*** -- Alt Sec window Desktop="+Sb);if(0!=(Sb&1))svGlobal.logger.info("Desktop non monitored flags="+Sb);else if(0!=(Sb&32)){var Qc=jd.getLittleEndian32();svGlobal.logger.info("Desktop monitored flags="+
Sb+" winId="+Qc);if(0!=(Sb&16)){var kd=jd.getByte();if(0<kd){var ld=B.zOrders;ld.length=kd;for(var Kc=0;Kc<kd;Kc++)ld[Kc]=jd.getLittleEndian32(),svGlobal.logger.info("---zorders:"+ld[Kc])}}}}else svGlobal.logger.info("XXX Alt Sec window order flgas="+Bb);Rb.setPosition(Pc);break;case 13:jc.getLittleEndian32();break;default:svGlobal.logger.warn("XXX Alt Sec order not implemented:"+kc)}break;case 3:var Sa=a,Ad=void 0,md=void 0,Lc=void 0,Bd=void 0,Ad=Sa.getLittleEndian16(),Lc=Sa.getLittleEndian16(),
md=Sa.getByte(),Bd=Sa.getPosition()+Ad+7;switch(md){case 0:svGlobal.logger.warn("TODO: raw bitmap cache");break;case 1:svGlobal.logger.info("TODO: color cache");break;case 2:var ua=Sa,Rc=Lc,Sc=ua.getByte();ua.getByte();var nd=ua.getByte(),od=ua.getByte(),Cd=ua.getByte(),Dd=Math.floor((Cd+7)/8),Tc=ua.getLittleEndian16(),Uc=ua.getLittleEndian16(),pd=0;0!=(Rc&1024)?pd=Tc:(ua.skipPosition(2),pd=ua.getLittleEndian16(),ua.skipPosition(2),ua.skipPosition(2));var Ed=void 0,Mc=ua.getBytes(pd),Ed=1==Dd?qd(nd,
od,Mc.length,Mc):Fb(nd,od,Mc.length,Mc,Dd,q);Fd(Sc,Uc,new rd(Ed,nd,od,0,0,Cd),0);break;case 3:for(var hb=Sa,Wc=null,Gd=0,Hd=0,Id=0,Jd=0,Kd=0,sd=0,td=0,Ld=0,Gd=hb.getByte(),Hd=hb.getByte(),Md=0;Md<Hd;Md++){var Id=hb.getLittleEndian16(),Jd=hb.getLittleEndian16(),Kd=hb.getLittleEndian16(),sd=hb.getLittleEndian16(),td=hb.getLittleEndian16(),Ld=td*Math.floor((sd+7)/8)+3&-4,Cb=Wc=new Yd(Gd,Id,Jd,Kd,sd,td,hb.getBytes(Ld));if(12>Cb.font&&256>Cb.character)sc[Cb.font][Cb.character]=Cb;else throw svGlobal.logger.warn("put font: font="+
Cb.font+" c="+Cb.character),"Could not put font in cache";}break;case 4:Nd(Sa,Lc,!1);break;case 5:Nd(Sa,Lc,!0);break;default:svGlobal.logger.info("XXX second Order, type="+md)}Sa.setPosition(Bd)}c++}E.commitPaint()}function Xd(a,b){var c=b.getLittleEndian32();if(0!=(a&1073741824))svGlobal.logger.info("XXX rail icon, winId="+c);else if(0!=(a&2147483648))svGlobal.logger.info("XXX rail cache icon, winId="+c);else if(0!=(a&536870912))svGlobal.logger.info("***** delete winId="+c),B.delWin(c);else{O||(O=
!0);var d=0==(a&268435456);svGlobal.logger.info("\n\n================= winId="+c+" existed="+d);var i=d?B.getWinById(c):new Zd(c);if(i){0!=(a&2)&&(i.ownerWinid=b.getLittleEndian32(),svGlobal.logger.info("***** ownerWinid="+i.ownerWinid));0!=(a&8)&&(i.style=b.getLittleEndian32(),i.extStyle=b.getLittleEndian32(),svGlobal.logger.info("***** winId="+c+" style="+i.style+" extStyle="+i.extStyle),svGlobal.logger.info("*****--- WS_POPUP="+(0!=(i.style&2147483648))),svGlobal.logger.info("*****--- WS_DLGFRAME="+
(0!=(i.style&4194304))),svGlobal.logger.info("*****--- DS_MODALFRAME="+(0!=(i.style&128))),svGlobal.logger.info("*****--- WS_EX_DLGMODALFRAME="+(0!=(i.extStyle&1))),svGlobal.logger.info("*****--- WS_EX_TOOLWINDOW="+(0!=(i.extStyle&128))),svGlobal.logger.info("*****--- WS_BORDER="+(0!=(i.style&8388608))),svGlobal.logger.info("*****--- WS_CAPTION="+(0!=(i.style&12582912))),svGlobal.logger.info("*****--- WS_OVERLAPPED="+(0!=(i.style&0))),svGlobal.logger.info("*****--- WS_OVERLAPPEDWINDOW="+(0!=(i.style&
13565952))),svGlobal.logger.info("*****--- WS_POPUPWINDOW="+(0!=(i.style&2156396544))),svGlobal.logger.info("*****--- WS_SIZEBOX="+(0!=(i.style&262144))),svGlobal.logger.info("*****--- WS_CHILD="+(0!=(i.style&1073741824))),svGlobal.logger.info("*****--- WS_EX_MDICHILD="+(0!=(i.extStyle&64))),svGlobal.logger.info("*****--- WS_EX_LAYERED="+(0!=(i.extStyle&524288))));if(0!=(a&16)){i.showState=b.getByte();svGlobal.logger.info("***** winId="+c+" showState="+i.showState);var f=i.showState;if(3==f)i.fillBrowser();
else switch(f){case 2:3==s.windowState&&setTimeout(function(){i.exeCommand(61728)},50);break;case 3:setTimeout(function(){i.fillBrowser()},50)}}0!=(a&4)&&(f=b.getLittleEndian16(),i.titleInfo=b.getUnicodeString(f,!1),svGlobal.logger.info("***** winId="+c+" title="+i.titleInfo));0!=(a&16384)&&(i.clientOffsetX=b.getLittleEndian32(),i.clientOffsetY=b.getLittleEndian32(),svGlobal.logger.info("***** winId="+c+" coffX"+i.clientOffsetX+" coffY="+i.clientOffsetY));0!=(a&65536)&&(i.clientAreaWidth=b.getLittleEndian32(),
i.clientAreaHeight=b.getLittleEndian32(),svGlobal.logger.info("***** winId="+c+" cw"+i.clientAreaWidth+" ch="+i.clientAreaHeight));0!=(a&131072)&&(i.rpContent=b.getLittleEndian32());0!=(a&262144)&&(i.rootParentHandle=b.getLittleEndian32());0!=(a&2048)&&(i.winOffsetX=b.getLittleEndian32(),i.winOffsetY=b.getLittleEndian32(),svGlobal.logger.info("***** winId="+c+" offX"+i.winOffsetX+" offY="+i.winOffsetY));0!=(a&32768)&&(i.winClientDeltaX=b.getLittleEndian32(),i.winClientDeltaY=b.getLittleEndian32(),
svGlobal.logger.info("***** winId="+c+" dX"+i.winClientDeltaX+" dY="+i.winClientDeltaY));0!=(a&1024)&&(i.winWidth=b.getLittleEndian32(),i.winHeight=b.getLittleEndian32(),svGlobal.logger.info("***** winId="+c+" w"+i.winWidth+" h="+i.winHeight));0!=(a&256)&&(c=b.getLittleEndian16(),0<c&&b.skipPosition(8*c));0!=(a&4096)&&(i.visibleOffsetX=b.getLittleEndian32(),i.visibleOffsetY=b.getLittleEndian32());0!=(a&512)&&(c=b.getLittleEndian16(),i.numVisibilityRects=c,0<c&&b.skipPosition(8*c));d||B.addWin(i)}else svGlobal.logger.warn("XXX, No win with id:"+
c)}}function Zd(a){this.id=a;this.fillBrowser=function(){var b=B.getOwnerSurface(this);null!=b?(b=b.browser,this.resize(0,0,b.innerWidth,b.innerHeight)):svGlobal.logger.warn("XXX No browser for "+a)};this.parent=function(){return B.getWinById(this.ownerWinid)};this.resize=function(a,c,d,i){C.send("8C1"+this.id+"\t"+a+"\t"+c+"\t"+d+"\t"+i)};this.checkBound=function(){var a=B.getOwnerSurface(this);if(null==a)svGlobal.logger.warn("no surface for checkBound");else{var a=a.browser,c=this.winWidth,d=this.winHeight,
i=this.winOffsetX,f=this.winOffsetY;if(!(1>c||1>d))if(i>a.innerWidth||f>a.innerHeight)i>a.innerWidth&&(i=Math.floor(a.innerWidth/2)),f>a.innerHeight&&(f=Math.floor(a.innerHeight/2)),this.resize(i,f,c,d)}};this.exeCommand=function(b){C.send("8C4"+a+"\t"+b)};this.activate=function(b){C.send("8C3"+a+"\t"+b)};this.close=function(){this.exeCommand(61536)}}function hc(a,b,c){C.send("8C1"+a.id+"\t0\t0\t"+b+"\t"+c);a.winWidth=b;a.winHeight=c}function Nd(a,b,c){var d,i,f,h,n,k=0;i=b&7;h=((b&120)>>3)-2;b=(b&
65408)>>7;0!=(b&2)&&a.skipPosition(8);0!=(b&1)?f=d=ib.readVar2Bytes(a):(d=ib.readVar2Bytes(a),f=ib.readVar2Bytes(a));k=ib.readVar4Bytes(a);n=ib.readVar2Bytes(a);0!=(b&16)&&svGlobal.logger.warn("XXX: to do, not cache");if(c){a=1==h?qd(d,f,k,a.getBytes(k)):Fb(d,f,k,a.getBytes(k),h,q);if(!a){svGlobal.logger.warn("Failed to decompress bitmap data");return}d=new rd(a,d,f,0,0,8*h)}else{k=Array(d*f*h);k[0]=0;for(var j=a.getPosition(),g,c=0;c<f;c++)g=j+(f-c-1)*d*h,a.copyToByteArray(k,c*d*h,g,d*h);d=new rd(Tb(k,
h),d,f,0,0,8*h)}Fd(i,n,d,0);if(0!=(b&2))throw svGlobal.logger.warn("XXX:TODO, persistent"),"Persistent erro";}function u(a,b,c){var d=0;c?(d=a.getByte(),127<d&&(d-=256),b+=d):b=a.getLittleEndian16();return b}function zc(a){return a&15}function Ja(a){var b=0,c=0,b=c=a.getByte(),c=a.getByte(),b=b|c<<8,c=a.getByte();return b|c<<16}function vd(a,b,c){0!=(c&1)&&(b.xOrigin=a.getByte());0!=(c&2)&&(b.yOrigin=a.getByte());0!=(c&4)&&(b.style=a.getByte());var d=b.pattern;0!=(c&8)&&(d[0]=a.getByte());if(0!=(c&
16))for(c=1;8>c;c++)d[c]=a.getByte();b.pattern=d}function vc(a){var b=0,c=0,d=0,i=0,f=0,h=0,n=0,k=0,j=0,g=0,l=0,m=0,i=0,s,A,t,x;t=x=0;s=p;A=w;for(var b=a.getLittleEndian16(),y=0;y<b;y++){var c=a.getLittleEndian16(),d=a.getLittleEndian16(),i=a.getLittleEndian16(),f=a.getLittleEndian16(),h=a.getLittleEndian16(),n=a.getLittleEndian16(),g=a.getLittleEndian16(),u=Math.floor((g+7)/8),l=a.getLittleEndian16(),m=a.getLittleEndian16(),k=i-c+1,j=f-d+1;s>c&&(s=c);A>d&&(A=d);t<i&&(t=i);x<f&&(x=f);q!=g&&(svGlobal.logger.warn("Server limited colour depth to "+
g+" bits"),Va(g));if(0==l){f=h*u;g=n*f;i=Array(g);i[0]=0;l=a.getPosition();for(m=0;m<n;m++){for(var z=a.getData(),r=l,v=i,F=(n-m-1)*f,C=f,B=0;B<C;B++)v[F+B]=z[r+B];l+=f}a.skipPosition(g);n=void 0;n=0;u=Tb(i,u);E.setRGBs(c,d,k,j,u,n,h);E.postPaint(c,d,k,j)}else 0!=(l&1024)?i=m:(a.skipPosition(2),i=a.getLittleEndian16(),a.skipPosition(4)),i=a.getBytes(i),1==u?(n=qd(h,n,i.length,i),i=void 0,i=0,u=Tb(n,u),E.setRGBs(c,d,k,j,u,i,h),E.postPaint(c,d,k,j)):(u=Fb(h,n,i.length,i,u,q),1>k||1>j||(E.setRGBs(c,
d,k,j,u,0,h),E.postPaint(c,d,k,j)))}E.commitPaint()}function ud(){U=0;G=p-1;P=0;H=w-1}function wd(a,b,c,d,i,f){i=ra(i);if(a==c||b==d){var h,n,k;if(b==d){if(b>=P&&b<=H)if(c>a){if(a<U&&(a=U),c>G&&(c=G),h=b*p+a,k=c-a,!(1>k)){for(n=0;n<k;n++)xa(f,E,a+n,b,i),h++;E.repaint(a,b,k+1,1)}}else if(c<U&&(c=U),a>G&&(a=G),h=b*p+a,k=a-c,!(1>k)){for(n=0;n<k;n++)xa(f,E,c+n,b,i),h--;E.repaint(c,b,k+1,1)}}else if(a>=U&&a<=G)if(d>b){if(b<P&&(b=P),d>H&&(d=H),h=b*p+a,k=d-b,!(1>k)){for(n=0;n<k;n++)xa(f,E,a,b+n,i),h+=p;
E.repaint(a,b,1,k+1)}}else if(d<P&&(d=P),b>H&&(b=H),h=b*p+a,k=b-d,!(1>k)){for(n=0;n<k;n++)xa(f,E,a,d+n,i),h-=p;E.repaint(a,d,1,k+1)}}else{var j=Math.abs(c-a),g=Math.abs(d-b);h=a;n=b;var l,m,q,s,A,x;l=c>=a?k=1:k=-1;q=d>=b?m=1:m=-1;j>=g?(q=k=0,A=j,s=j/2,x=g):(m=l=0,A=g,s=g/2,x=j,j=g);if(!(1>j)){for(g=0;g<=j;g++)h<U||(h>G||n<P||n>H)||xa(f,E,h,n,i),s+=x,s>=A&&(s-=A,h+=k,n+=m),h+=l,n+=q;f=a<c?a:c;i=a>c?a:c;c=b<d?b:d;d=b>d?b:d;0>i-f||0>d-c||E.repaint(f,c,i-f+1,d-c+1)}}}function zd(a,b,c,d,i,f,h,n){var k=
0,j=128,k=Math.floor((d-1)/8)+1,g,l,n=ra(n),h=ra(h);if(!(b>G||c>H))if(g=b+d-1,g>G&&(g=G),d=b<U?U:b,g=g-b+1,l=c+i-1,l>H&&(l=H),i=c<P?P:c,l=l-c+1,!(1>g||1>l))if(k*=i-c,0==a)for(a=0;a<l;a++){for(var m=0;m<g;m++)0==j&&(k++,j=128),b+m>=d&&c+a>=i&&0<=b+m&&0<=c+a&&0!=(f[k]&j)&&E.setRGB(b+m,c+a,n),j>>=1;k++;j=128;k==f.length&&(k=0)}else for(a=0;a<l;a++){for(m=0;m<g;m++)0==j&&(k++,j=128),b+m>=d&&c+a>=i&&0<=b+m&&0<=c+a&&(0!=(f[k]&j)?E.setRGB(b+m,c+a,n):E.setRGB(b+m,c+a,h)),j>>=1;k++;j=128;k==f.length&&(k=0)}}
function xd(a,b){var c=a[b[0]++]&255,d=c&128,c=0!=(c&64)?c|-64:c&63;0!=d&&(c=c<<8|a[b[0]++]&255);return c}function Xc(a,b,c,d,i,f){if(!(a>G||b>H))if(c=a+c-1,c>G&&(c=G),a<U&&(a=U),c=c-a+1,d=b+d-1,d>H&&(d=H),b<P&&(b=P),d=d-b+1,!(1>c||1>d))if(E.fillRect(a,b,c,d,ra(i)),f)if(4E4<c*d){var f=Ta,h=Array(4);Ib(i,q,h,0);f.fillStyle="rgba("+h[0]+","+h[1]+","+h[2]+","+h[3]+")";Ta.fillRect(a,b,c,d)}else E.postPaint(a,b,c,d)}function ic(){null!=C&&R&&(C.send("85"),C.close())}function Wd(a,b){this.size=a;this.data=
b}function Yd(a,b,c,d,i,f,h){this.font=a;this.character=b;this.offset=c;this.baseLine=d;this.width=i;this.height=f;this.fontData=h}function Ub(a,b,c,d,i,f,h){for(var n=i*c+d,k=a.setRGB,j=a.getRGB,g=0;g<h;g++){for(var l=0;l<f;l++){if(null!=a){var m=j(d+l,i+g);k(d+l,i+g,~m&M)}else b[n]=~b[n]&M;n++}n+=c-f}}function bc(a,b,c,d,i,f,h,n,k,j,g){if(!(0>f|0>h|0>c|0>k))switch(a){case 0:n=b.setRGB;for(k=d;k<d+f;k++)for(b=i;b<i+h;b++)n(k,b,0);break;case 1:a=g*k+j;c=b.setRGB;for(j=0;j<h;j++){for(g=0;g<f;g++)c(d+
f,i+h,~(b.getRGB(d+f,i+h)|n[a])&M);a+=k-f}break;case 2:a=g*k+j;c=b.setRGB;b=b.getRGB;for(j=0;j<h;j++){for(g=0;g<f;g++){var l=b(d+f,i+h);c(d+f,i+h,l&~n[a]&M);a++}a+=k-f}break;case 3:Ub(b,n,k,j,g,f,h);null==n?b.copyArea(j,g,f,h,d-j,i-g):b.setRGBs(d,i,f,h,n,g*k+j,k);break;case 4:Ub(b,null,c,d,i,f,h);Nc(b,c,d,i,f,h,n,k,j,g);break;case 5:Ub(b,null,c,d,i,f,h);break;case 6:a=g*k+j;c=b.setRGB;b=b.getRGB;for(j=0;j<h;j++){for(g=0;g<f;g++)l=b(d+g,i+j),c(d+g,i+j,l^n[a]&M),a++;a+=k-f}break;case 7:a=g*k+j;c=b.setRGB;
b=b.getRGB;for(j=0;j<h;j++){for(g=0;g<f;g++)l=b(d+g,i+j),c(d+g,i+j,~(l&n[a])&M),a++;a+=k-f}break;case 8:Nc(b,c,d,i,f,h,n,k,j,g);break;case 9:a=g*k+j;c=b.setRGB;b=b.getRGB;for(j=0;j<h;j++){for(g=0;g<f;g++)l=b(d+g,i+j),c(d+g,i+j,l^~n[a]&M),a++;a+=k-f}break;case 10:break;case 11:a=g*k+j;c=b.setRGB;b=b.getRGB;for(j=0;j<h;j++){for(g=0;g<f;g++)l=b(d+g,i+j),c(d+g,i+j,l|~n[a]&M),a++;a+=k-f}break;case 12:null==n?b.copyArea(j,g,f,h,d-j,i-g):b.setRGBs(d,i,f,h,n,g*k+j,k);break;case 13:Ub(b,null,c,d,i,f,h);jc(b,
c,d,i,f,h,n,k,j,g);break;case 14:jc(b,c,d,i,f,h,n,k,j,g);break;case 15:n=b.setRGB;for(k=d;k<d+f;k++)for(b=i;b<i+h;b++)n(k,b,M);break;default:svGlobal.logger.warn("unsupported opcode: "+a)}}function xa(a,b,c,d,i){if(null!=b){var f=b.getRGB(c,d);switch(a){case 0:b.setRGB(c,d,0);break;case 1:b.setRGB(c,d,~(f|i)&M);break;case 2:b.setRGB(c,d,f&~i&M);break;case 3:b.setRGB(c,d,~i&M);break;case 4:b.setRGB(c,d,(~f&i)*M);break;case 5:b.setRGB(c,d,~f&M);break;case 6:b.setRGB(c,d,f^i&M);break;case 7:b.setRGB(c,
d,~f&i&M);break;case 8:b.setRGB(c,d,f&i&M);break;case 9:b.setRGB(c,d,f^~i&M);break;case 10:break;case 11:b.setRGB(c,d,f|~i&M);break;case 12:b.setRGB(c,d,i);break;case 13:b.setRGB(c,d,(~f|i)&M);break;case 14:b.setRGB(c,d,f|i&M);break;case 15:b.setRGB(c,d,M);break;default:svGlobal.logger.warn("unsupported pixel opcode: "+a),b.setRGB(c,d,i)}}}function Nc(a,b,c,d,i,f,h,n,k,j){b=j*n+k;k=a.setRGB;a=a.getRGB;for(j=0;j<f;j++){for(var g=0;g<i;g++){var l=a(c+g,d+j);k(c+g,d+j,l&h[b]&M);b++}b+=n-i}}function jc(a,
b,c,d,i,f,h,n,k,j){b=j*n+k;k=a.setRGB;a=a.getRGB;for(j=0;j<f;j++){for(var g=0;g<i;g++){var l=a(c+g,d+j);k(c+g,d+j,l|h[b]&M);b++}b+=n-i}}function Fd(a,b,c){"undefined"==typeof nb[a]&&(nb[a]=[]);nb[a][b]=c}function yd(a,b){if(12>a&&256>b){var c=sc[a][b];if(null!=c)return c}return null}function yc(a){return 20>a&&(a=Gb[a],null!=a)?a:null}function rd(a,b,c,d,i,f){this.byteArray=a;this.left=d;this.top=i;this.width=b;this.height=c;this.bitsperpixel=f;this.bytesperpixel=Math.floor((f+7)/8)}function Ib(a,
b,c,d){switch(b){case 16:var b=a>>8&248,i=a>>3&252,a=a<<3&255;c[d]=b|b>>5;c[d+1]=i|i>>6;c[d+2]=a|a>>5;c[d+3]=255;break;case 15:b=a>>7&248;i=a>>2&248;a=a<<3&255;c[d]=b|b>>5;c[d+1]=i|i>>5;c[d+2]=a|a>>5;c[d+3]=255;break;case 8:c[d]=ma[0][a];c[d+1]=ma[1][a];c[d+2]=ma[2][a];c[d+3]=255;break;case 32:c[d]=a&255,c[d+1]=a>>8&255,c[d+2]=a>>16&255,c[d+3]=a>>24&255;default:c[d]=a&255,c[d+1]=a>>8&255,c[d+2]=a>>16&255,c[d+3]=255}}function kc(a,b,c){return a=0|a[b+c]&255}function Tb(a,b){var c=a.length/b>>0,d=Array(c);
d[0]=0;var i=ra;switch(b){case 1:for(var f=0;f<c;f++)d[f]=i(a[f]&255);break;case 2:for(f=0;f<c;f++)d[f]=i((a[2*f+1]&255)<<8|a[2*f]&255);break;default:for(f=0;f<c;f++)d[f]=i((a[f*b+2]&255)<<16)|(a[f*b+1]&255)<<8|a[f*b]&255}return d}function qd(a,b,c,d){var i=-1,f=0,h=0,n=0,k=0,j=0,g=a,l=-1,m=0,p=k=0,q=0,s=j=0,A=4294967295,u=!1,t=!1,z=!1,r=Array(a*b);for(r[0]=0;h<c;){m=0;k=d[h++]&255;n=k>>4;switch(n){case 12:case 13:case 14:n-=6;k&=15;j=16;break;case 15:n=k&15;9>n?(k=d[h++]&255,k|=(d[h++]&255)<<8):
k=11>n?8:1;j=0;break;default:n>>=1,k&=31,j=32}0!=j&&(z=2==n||7==n,0==k?k=z?(d[h++]&255)+1:(d[h++]&255)+j:z&&(k<<=3));switch(n){case 0:l==n&&!(g==a&&-1==i)&&(u=!0);break;case 8:p=d[h++]&255;case 3:q=d[h++]&255;break;case 6:case 7:A=d[h++];n-=5;break;case 9:s=3;n=2;m=3;break;case 10:s=5,n=2,m=5}l=n;for(j=0;0<k;){if(g>=a){if(0>=b)throw"Decompressing bitmap failed! Height = "+b;g=0;b--;i=f;f=0+b*a}switch(n){case 0:u&&(r[f+g]=-1==i?A&255:(r[i+g]^A&255)&255,u=!1,k--,g++);if(-1==i){for(;0!=(k&-8)&&g+8<a;)for(z=
0;8>z;z++)r[f+g]=0,k--,g++;for(;0<k&&g<a;)r[f+g]=0,k--,g++}else{for(;0!=(k&-8)&&g+8<a;)for(z=0;8>z;z++)r[f+g]=r[i+g],k--,g++;for(;0<k&&g<a;)r[f+g]=r[i+g],k--,g++}break;case 1:if(-1==i){for(;0!=(k&-8)&&g+8<a;)for(z=0;8>z;z++)r[f+g]=A&255,k--,g++;for(;0<k&&g<a;)r[f+g]=A&255,k--,g++}else{for(;0!=(k&-8)&&g+8<a;)for(z=0;8>z;z++){var v=kc(r,i,g)^A;r[f+g]=v&255;k--;g++}for(;0<k&&g<a;)z=kc(r,i,g)^A,r[f+g]=z&255,k--,g++}break;case 2:if(-1==i){for(;0!=(k&-8)&&g+8<a;)for(z=0;8>z;z++)j<<=1,j&=255,0==j&&(s=0!=
m?m&255:d[h++],j=1),r[f+g]=0!=(s&j)?A&255:0,k--,g++;for(;0<k&&g<a;)j<<=1,j&=255,0==j&&(s=0!=m?m&255:d[h++],j=1),r[f+g]=0!=(s&j)?A&255:0,k--,g++}else{for(;0!=(k&-8)&&g+8<a;)for(z=0;8>z;z++)j<<=1,j&=255,0==j&&(s=0!=m?m&255:d[h++],j=1),r[f+g]=0!=(s&j)?(r[i+g]^A&255)&255:r[i+g],k--,g++;for(;0<k&&g<a;)j<<=1,j&=255,0==j&&(s=0!=m?m&255:d[h++],j=1),r[f+g]=0!=(s&j)?(r[i+g]^A&255)&255:r[i+g],k--,g++}break;case 3:for(;0!=(k&-8)&&g+8<a;)for(z=0;8>z;z++)r[f+g]=q&255,k--,g++;for(;0<k&&g<a;)r[f+g]=q&255,k--,g++;
break;case 4:for(;0!=(k&-8)&&g+8<a;)for(z=0;8>z;z++)r[f+g]=d[h++],k--,g++;for(;0<k&&g<a;)r[f+g]=d[h++],k--,g++;break;case 8:for(;0!=(k&-8)&&g+8<a;)for(z=0;8>z;z++)t?(r[f+g]=q&255,t=!1):(r[f+g]=p&255,t=!0,k++),k--,g++;for(;0<k&&g<a;)t?(r[f+g]=q&255,t=!1):(r[f+g]=p&255,t=!0,k++),k--,g++;break;case 13:for(;0!=(k&-8)&&g+8<a;)for(z=0;8>z;z++)r[f+g]=255,k--,g++;for(;0<k&&g<a;)r[f+g]=255,k--,g++;break;case 14:for(;0!=(k&-8)&&g+8<a;)for(z=0;8>z;z++)r[f+g]=0,k--,g++;for(;0<k&&g<a;)r[f+g]=0,k--,g++;break;default:throw"Unimplemented decompress opcode "+
n;}}}return r}function $b(){this.orderType=1;this.bounds=new BoundsOrder;this.destBlt=new DestBltOrder;this.patBlt=new PatBltOrder;this.screenBlt=new ScreenBltOrder;this.line=new LineOrder;this.rectangle=new RectangleOrder;this.deskSave=new DeskSaveOrder;this.memBlt=new MemBltOrder;this.triBlt=new TriBltOrder;this.polyLine=new PolyLineOrder;this.text2=new Text2Order}this.displayMsg=this.reconnectOnResize=!0;this.sessionTimeout=3E5;this.appTimeout=800;this.reconnectTimes=0;this.windowState=3;this.setTitle=
this.notification=this.openLink=!0;this.audioBuffer=2;this.sessionInfo={};this.mode=0;var ia=null,s=this,tc=!0,Ta=null,Za=null,Db="object"==typeof m?m:null,ab="object"==typeof m||0<m.indexOf("/PLAY?");ab?(this.mode=1,Db?m="":(p=screen.width,w=screen.height),m+="&touchpad=on",this.reconnectOnResize=!1):0<m.indexOf("/JOIN?")&&(this.mode=2,this.reconnectOnResize=!1);p||(p=window.innerWidth,w=window.innerHeight);var Y=hi5.tool.queryToObj(m.substring(m.indexOf("?")+1)),va=null;if(hi5.appcfg){var Q=hi5.appcfg;
"undefined"!==typeof Q.displayMsg&&(this.displayMsg=Q.displayMsg);"undefined"!==typeof Q.sessionTimeout&&(this.sessionTimeout=Q.sessionTimeout);"undefined"!==typeof Q.appTimeout&&(this.appTimeout=Q.appTimeout);"undefined"!==typeof Q.reconnectOnResize&&(this.reconnectOnResize=Q.reconnectOnResize);"undefined"!==typeof Q.reconnectTimes&&(this.reconnectTimes=Q.reconnectTimes);"undefined"!==typeof Q.windowState&&(this.windowState=Q.windowState);"undefined"!==typeof Q.openLink&&(this.openLink=Q.openLink);
"undefined"!==typeof Q.notification&&(this.notification=Q.notification);"undefined"!==typeof Q.setTitle&&(this.setTitle=Q.setTitle);"undefined"!=typeof Q.audioBuffer&&(this.audioBuffer=Q.audioBuffer);"boolean"==typeof Q.useWSS&&(m=(hi5.appcfg.useWSS?"wss":"ws")+m.substring(m.indexOf("://")))}Y.vmid&&(this.reconnectOnResize=!1);this.displayMsg||(this.notification=!1);p=parseInt(p);w=parseInt(w);q=q?parseInt(q):16;this.server=Y.server;this.port=parseInt(Y.port);var aa={table:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split(""),
pad:"=",enc:function(a,b){var c="",d=this.table,i=this.pad,f;b||(b=a.length);var h=b-1;for(f=0;f<h;f+=3)c+=d[a[f]>>2],c+=d[((a[f]&3)<<4)+(a[f+1]>>4)],c+=d[((a[f+1]&15)<<2)+(a[f+2]>>6)],c+=d[a[f+2]&63];b%3&&(f=b-b%3,c+=d[a[f]>>2],2===b%3?(c+=d[((a[f]&3)<<4)+(a[f+1]>>4)],c+=d[(a[f+1]&15)<<2],c+=i):(c+=d[(a[f]&3)<<4],c+=i+i));return c},binaries:[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,62,-1,-1,-1,63,52,53,54,55,
56,57,58,59,60,61,-1,-1,-1,0,-1,-1,-1,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,-1,-1,-1,-1,-1,-1,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,-1,-1,-1,-1,-1],dec:function(a,b){var c=this.binaries,d=this.pad,i,f,h,n,k,j=0,g=0;i=a.indexOf("=")-b;var l=a.length;0>i&&(i=l-b);i=Array(3*(i>>2)+Math.floor(i%4/1.5));f=i[0]=0;for(h=b;h<l;h++)n=c[a.charCodeAt(h)&127],k=a.charAt(h)===d,-1===n?0<svGlobal.log&&console.error("Illegal character '"+a.charCodeAt(h)+
"'"):(g=g<<6|n,j+=6,8<=j&&(j-=8,k||(i[f++]=g>>j&255),g&=(1<<j)-1));if(j)throw"Invalid base64 encoding";return i}};_mppcHistory=Array(65536);_mppcHistory[0]=0;var Ia={historyoff:0,history:_mppcHistory,currOff:0,currLen:0,reset:function(){this.historyoff=0;this.history=Array(65536);this.currLen=this.currOff=this.history[0]=0},getData:function(){var a=new RdpBuffer(this.history,this.currOff,this.currLen);a.markEnd(this.currOff+this.currLen);return a},dec:function(a,b,c,d){var i,f=0,h=0,n,k,j,g,l=0!=
(d&1),m=this.history;if(0==(d&32))return this.currOff=0,this.currLen=c,0;0!=(d&64)&&(this.historyoff=0);if(0!=(d&128)){for(d=65536;0<=--d;)m[d]=0;this.historyoff=0}this.currLen=this.currOff=0;this.currOff=j=n=d=this.historyoff;if(0==c)return 0;c+=h;do{if(0==f){if(h>=c)break;d=(a[b+h++]&255)<<24;f=8}if(0<=d){if(8>f){if(h>=c){if(0!=d)return-1;break}d|=(a[b+h++]&255)<<24-f;f+=8}if(65536<=n)return-1;m[n++]=d>>>24&255;d<<=8;f-=8}else{d<<=1;if(0==--f){if(h>=c)return-1;d=(a[b+h++]&255)<<24;f=8}if(0<=d){if(8>
f){if(h>=c)return-1;d|=(a[b+h++]&255)<<24-f;f+=8}if(65536<=n)return-1;m[n++]=(d>>>24|128)&255;d<<=8;f-=8}else{d<<=1;if(--f<(l?3:2)){if(h>=c)return-1;d|=(a[b+h++]&255)<<24-f;f+=8}if(l)switch(d>>>29){case 7:for(;9>f;f+=8){if(h>=c)return-1;d|=(a[b+h++]&255)<<24-f}d<<=3;i=d>>>26;d<<=6;f-=9;break;case 6:for(;11>f;f+=8){if(h>=c)return-1;d|=(a[b+h++]&255)<<24-f}d<<=3;i=(d>>>24)+64;d<<=8;f-=11;break;case 5:case 4:for(;13>f;f+=8){if(h>=c)return-1;d|=(a[b+h++]&255)<<24-f}d<<=2;i=(d>>>21)+320;d<<=11;f-=13;break;
default:for(;17>f;f+=8){if(h>=c)return-1;d|=(a[b+h++]&255)<<24-f}d<<=1;i=(d>>>16)+2368;d<<=16;f-=17}else switch(d>>>30){case 3:if(8>f){if(h>=c)return-1;d|=(a[b+h++]&255)<<24-f;f+=8}d<<=2;i=d>>>26;d<<=6;f-=8;break;case 2:for(;10>f;f+=8){if(h>=c)return-1;d|=(a[b+h++]&255)<<24-f}d<<=2;i=(d>>>24)+64;d<<=8;f-=10;break;default:for(;14>f;f+=8){if(h>=c)return-1;d|=(a[b+h++]&255)<<24-f}i=(d>>>18)+320;d<<=14;f-=14}if(0==f){if(h>=c)return-1;d=(a[b+h++]&255)<<24;f=8}if(0<=d)k=3,d<<=1,f--;else{g=l?14:11;do{d<<=
1;if(0==--f){if(h>=c)return-1;d=(a[b+h++]&255)<<24;f=8}if(0<=d)break;if(0==--g)return-1}while(1);k=(l?16:13)-g;d<<=1;if(--f<k)for(;f<k;f+=8){if(h>=c)return-1;d|=(a[b+h++]&255)<<24-f}g=k;k=d>>>32-g&~(-1<<g)|1<<g;d<<=g;f-=g}if(65536<=n+k)return-1;i=n-i&(l?65535:8191);do m[n++]=m[i++];while(0!=--k)}}}while(1);this.historyoff=n;this.currOff=j;this.currLen=n-j;return 0}},Ud=0<m.indexOf("nocurosr=on"),O=0<m.indexOf("startProgram=app"),mb=0<m.indexOf("mapDisk=on"),ha=null;O&&(this.reconnectOnResize=!1);
hi5.browser.isTouch&&Math.max(p,w)>Math.max(window.innerWidth,window.innerHeight)&&(this.reconnectOnResize=!1);this.isRemoteApp=function(){return O};if(O)if(hi5.browser.isTouch){var $d=Math.max(window.innerWidth,window.innerHeight),ae=Math.max(p,w),jb=Math.max($d,ae);p<jb&&(p=jb);w<jb&&(w=jb)}else p=screen.width,w=screen.height,0==s.windowState&&(w-=window.outerHeight-window.innerHeight+25);else p&=-4,w&=-4;var C=null,sa=null,R=!1,Wa=!1,ja=new function(a){var b=null;this.available=!1;this.delay=a;
if(hi5.browser.isTouch)this.available=!1;else if("webkitAudioContext"in window)b=new webkitAudioContext,this.available=!0;else if("AudioContext"in window)b=new AudioContext,this.available=!0;else if(hi5.browser.isFirefox){this.available=!0;return}if(this.available){this.getBuffer=function(a){try{return b.createBuffer(2,a,F)}catch(c){svGlobal.logger.warn(c),svGlobal.logger.warn("size:"+a+" samples:"+F)}};var c=0;this.playBuffer=function(d){var i=b.createBufferSource();i.buffer=d;i.connect(b.destination);
var f=b.currentTime,h=0<c?c:f+a;h<f&&(h=f+a);c=h+d.duration;i.noteOn(h);return c-f}}}(s.audioBuffer),E=Xa(p,w);this.setAudioBuffer=function(a){s.audioBuffer=a;ja.delay=a;ba&&(ba.delay=a)};for(var ba=null,sc=Array(12),Eb=0;12>Eb;Eb++)sc[Eb]=Array(256);var ac=Array(256),U=0,P=0,G=p-1,H=w-1,ma=null,Fa=null,$a,Vc=0;window.rdpConnection=this;var ra=Vb,Fb=Wb;Va(q);this.running=function(){return R};this.hide=function(){B&&B.hide()};var Ha=new function(){this.ws=null;this.clipRequired=this.prePaste=!1;this.send=
function(a){R&&this.ws.send(a)};var a=null;this.getAppInfo=function(){return $a};this.onresize=function(b){var c=b.target.innerWidth,d=b.target.innerHeight;O?b.target.svSurface&&(b=b.target.svSurface.railWin.getMain(B.zOrders),null!=b&&hc(b,c,d)):!hi5.browser.isTouch&&!hi5.browser.isOpera&&(s.reconnectOnResize&&R)&&(a&&(clearTimeout(a),a=null),a=setTimeout(function(){4>Math.abs(c-p)&&4>Math.abs(d-w)||(svGlobal.logger.warn("w:"+c+" ww:"+p+" h:"+d+" hh:"+w),lb(c,d))},1E3))};this.onorientationchange=
function(a){if(s.reconnectOnResize)lb(window.innerWidth,window.innerHeight);else if(O&&a.target.svSurface){var c=a.target.svSurface.railWin.getMain(B.zOrders);null!=c&&hc(c,a.target.innerWidth,a.target.innerHeight)}};this.getClipData=Wc;this.setDataFromClip=function(a){sa=a;this.prePaste&&this.clipRequired&&(C.send("881"+a),sa="",this.clipRequired=!1);this.prePaste=!1};this.onfocus=function(a){if(O&&a.target.svSurface.railWin){var c=a.target.svSurface.railWin.getTopWin(B.zOrders);c&&C&&(c.activate(1),
svGlobal.logger.info("Activate win:"+c.id),Ta=a.target.svSurface.context)}};this.fileCallback=[];this.getShareFiles=function(a,c){Wa&&(this.ws.send("3A5"+a),this.fileCallback.push(c))};this.notifyFiles=function(a){for(var c=this.fileCallback,d=0,i=c.length;d<i;d++)c[d](a)};this.getFile=function(a){s.reconnectOnResize=!1;window.open(Ga()+"/DOWNLOAD?s="+Fa+"&f="+a)};this.getFileLink=function(a){return Ga()+"/DOWNLOAD?s="+Fa+"&f="+a};this.getGateway=function(){return m};this.reconnect=function(a,c,d){m=
hi5.tool.replaceQuery(m,"user",a);m=hi5.tool.replaceQuery(m,"pwd",c);m=hi5.tool.replaceQuery(m,"domain",d);"sessionStorage"in window&&sessionStorage.clear();window.rdpConnection=this;a=B.getFocused();B.removeElm(a);s.addSurface(a);s.run()}},B,t=[];t.addSurface=function(a){O&&(a.railWin=new Od);t.push(a)};t.setSize=function(a,b,c){for(var d=0,i=t.length;d<i;d++)t[d].setSize(a,b,c)};t.zOrders=[];t.drawLicense=function(a){for(var b=0,c=t.length;b<c;b++)t[b].drawLicense(a)};t.removeEvents=function(){for(var a=
0,b=t.length;a<b;a++)t[a]&&t[a].removeEvents()};t.setReadOnly=function(a){for(var b=0,c=t.length;b<c;b++)t[b].setReadOnly(a)};t.setVisible=function(){svGlobal.logger.info("TODO: setVisible")};t.copyToClip=function(a){1>t.length||t[0].copyToClip(a)};t.setCursor=function(a){O||t[0].setCursor(a);var b=t.getFocused();null!=b&&b.setCursor(a)};t.hide=function(){if(O)for(var a=0,b=t.length;a<b;a++)t[a].browser.close();else t[0].hide()};t.execute=function(a,b){for(var c=0,d=t.length;c<d;c++)t[c][a].apply(t[c],
b)};t.addWin=function(a){function b(){var b=1>a.ownerWinid;if(!b)return b;if(0===a.showState)return!1;var c=a.style;if(0!=(c&4194304))return!0;var f=0!=(a.extStyle&128);(b=b&&!f)&&(0!=(c&2147483648)&&0==(c&2156396544))&&(b=!1);svGlobal.logger.info("*** win id="+a.id+" isMain="+b);return b}var c=t.getFocused();c||(svGlobal.logger.warn("Focusd surface not found!"),c=t[t.length-1]);c?(c.railWin.addWin(a),0<s.windowState&&(b()?("titleInfo"in a&&s.setTitle&&(c.browser.document.title=a.titleInfo+" - "+
(Y.displayName||s.server)),a.fillBrowser(),a.activate(1)):a.checkBound())):svGlobal.logger.warn("No surface available!")};t.delWin=function(a){for(var b,c=t.length-1;0<=c;c--)if(b=t[c].railWin,0<=b.delWin(a))if(b.isRunning()){if(0<s.windowState){var d=b.getMain(t.zOrders);d&&d.fillBrowser();(d=b.getTopWin(t.zOrders))&&d.activate(1)}}else{var i=t[c],d=s.appTimeout;b.isNew()&&(d*=10);setTimeout(function(){i.railWin.isRunning()||t.delSurface(i)},d)}};t.getWinById=function(a){for(var b,c=0,d=t.length;c<
d;c++)if(b=t[c].railWin.getWinById(a))return b;return null};t.delSurface=function(a){a.railWin.isRunning()||(svGlobal.logger.info("delete surface..."),t.removeElm(a),a.close())};t.getOwnerSurface=function(a){for(var b=0,c=t.length;b<c;b++)if(t[b].railWin.hasWin(a))return t[b];return null};t.getFocused=function(){if(!O)return t[0];for(var a=t.length,b=0;b<a;b++)if(t[b].focused)return t[b];return t[a-1]};t.close=function(){for(var a=0,b=t.length;a<b;a++)t[a]&&t[a].close()};B=t;this.getSurfaces=function(){return B};
this.exeAppCmd=function(a){var b=B.getFocused();b&&b.exeCommand(a)};this.setJoinMode=function(a){R&&C.send("8E1"+a)};this.addSurface=function(a){Ta=a.context;-1!=B.indexOf(a)&&a.railWin||(ab&&a.setPlayerMode(),a.setAutoScale(0<s.mode),a.setSize(p,w,O?"hidden":null),a.setController(Ha),a.setFastCopy("on"==Y.fastCopy),a.setTouchpad("on"==Y.touchpad),a.setClipboard("on"==Y.mapClipboard),mb&&(a.setFileHandler(Yb),null==ha&&(ha=new lc(new mc))),a.run(0<m.indexOf("keyboard=99999")),B.addSurface(a))};this.getRunninApps=
function(){for(var a=[],b=0,c=B.length;b<c;b++)null!=B[b].railWin.getMain(B.zOrders)&&a.push(B[b].railWin.getMain(B.zOrders).titleInfo);return a};this.startApp=function(a,b,c){C.send("8C2"+a+"\t"+b+"\t"+c);var d=B[B.length-1];d&&(d.remoteApp={exe:a,args:b,dir:c})};this.VirtualChannel=function(){this.send=function(a){a=a.getData();C.send("8F"+aa.enc(a,a.length))}};this.addChannel=function(a){a.rdp=s;ia=a};this.run=function(){setTimeout(__run,5)};__run=function(){if(!R){Wa=!1;if(Db)C=Db;else{var a=
m+"&width="+p+"&height="+w+"&server_bpp="+q+"&audio="+ja.available+Oc();0>m.indexOf("waWidth")&&(a+=O?"&waWidth="+p+"&waHeight="+w:"");var b=new Date,a=a+("&tzOffset="+b.getTimezoneOffset()+"&time="+b.getTime());(b=hi5.browser.binaryWS(a.substring(0,a.indexOf("/",6))))&&(a+="&binary=on");ia&&(a+="&channelName="+ia.name,ia.flags&&(a+="&channelFlags="+ia.flags));var c=window.opener;if(c){var d=null;try{d=c.__sparkUser}catch(i){}d&&(c=d.account,d=d.session,c&&(a+="&account="+c),d&&(a+="&session="+d))}a+=
"&isTouch="+(hi5.browser.isTouch&&(1024<=window.innerWidth||768<=window.innerHeight));C=new hi5.WebSocket(a);b&&(C.binaryType="arraybuffer")}Ha.ws=C;svGlobal.logger.info(m);C.onopen=Qd;C.onmessage=Rd;C.onclose=function(a){svGlobal.logger.warn("closed, code="+a.code+" reason="+a.reason);R||Xb("connection");if(s.reconnectTimes)s.reconnectTimes--,R=!0,lb(window.innerWidth,window.innerHeight);else{R=!1;try{B&&B.close()}catch(b){}window&&delete window.rdpConnection;if(s&&s.onclose)s.onclose()}};C.onerror=
Pd;a=B[B.length-1];O?a&&(a.remoteApp={exe:Y.exe,args:Y.args,dir:""}):s.setTitle&&(a.browser.document.title=Y.displayName||s.server)}};this.getDesktop=function(){return E};this.mouseDown=function(a,b,c){R&&C.send("80"+a+"\t"+b+"\t"+c)};this.mouseMove=function(a,b){R&&C.send("82"+a+"\t"+b)};this.mouseUp=function(a,b,c){R&&C.send("81"+a+"\t"+b+"\t"+c)};this.writeKeyCode=function(a,b){R&&C.send("8B"+(a?0:49152)+"\t"+b)};this.writeScancode=function(a,b){R&&("number"==typeof a?(C.send("840\t"+a),C.send("8449152\t"+
a)):C.send("84"+(a?0:49152)+"\t"+b))};this.writeText=function(a){R&&C.send("86"+a)};this.refuseControl=function(a){R&&C.send("8E3"+a)};this.giveControl=function(a){R&&C.send("8E4"+a)};this.requestControl=function(){R&&C.send("8E2")};var Zb=0;this.play=function(){C.send("F3")};this.pause=function(){C.send("F2")};this.scan=function(a){C.send("F4"+(a?"1":"0"))};F=I=A=D=0;this.showMessage=function(a){var b=B.getFocused();b?b.showMessage(a):hi5.notifications.notify({msg:a})};var ca=new $b,ib={readVar4Bytes:function(a){var b=
a.getByte(),c=0;switch((b&192)>>6){case 0:c=b&63;break;case 1:c=(b&63)<<8|a.getByte();break;case 2:c=(b&63)<<16;b=a.getByte();c|=b<<8;b=a.getByte();c|=b;break;case 3:c=(b&63)<<24,b=a.getByte(),c|=b<<16,b=a.getByte(),c|=b<<8,b=a.getByte(),c|=b}return c},readVar2Bytes:function(a){var b=a.getByte();return 0!=(b&128)?(b&127)<<8|a.getByte():b}},bb=0,rc=null;this.close=ic;window.addEventListener("unload",ic,!1);var M=16777215,nb=[],Gb=Array(20)}
function RdpBuffer(m,p,w){var q=p,D=p+w;this.markEnd=function(){D=getPosition()};this.markEnd=function(m){D=m};this.getEnd=function(){return D};this.getStart=function(){return start};this.setStart=function(m){start=m};this.getByte=function(){return m[q++]&255};this.getBytes=function(p){var w;if(m.slice)w=m.slice(q,q+p);else if(m.buffer&&m.buffer.slice)w=new Int8Array(m.buffer.slice(q,q+p));else{w=Array(p);for(var F=w[0]=0;F<p;F++)w[F]=m[q+F]}q+=p;return w};this.copyToByteArray=function(p,q,w,D){hi5.tool.arraycopy(m,
w,p,q,D)};this.getCapacity=function(){return m.length};this.size=function(){return w};this.getPosition=function(){return q};this.getLittleEndian16=function(){var p=(m[q+1]&255)<<8|m[q]&255;q+=2;return p};this.getBigEndian16=function(){var p=(m[q]&255)<<8|m[q+1]&255;q+=2;return p};this.getLittleEndian32=function(){var p=(m[q+3]&255)<<24|(m[q+2]&255)<<16|(m[q+1]&255)<<8|m[q]&255;q+=4;return p};this.getLittleEndian64=function(){var p=(m[q+7]&255)<<56|(m[q+6]&255)<<48|(m[q+5]&255)<<40|(m[q+4]&255)<<32|
(m[q+3]&255)<<24|(m[q+2]&255)<<16|(m[q+1]&255)<<8|m[q]&255;q+=8;return p};this.getBigEndian32=function(){var p=(m[q]&255)<<24|(m[q+1]&255)<<16|(m[q+2]&255)<<8|m[q+3]&255;q+=4;return p};this.getUnicodeString=function(m,p){for(var q=Math.floor(m/2),w="",D=0;D<q;D++){var Ea=this.getLittleEndian16();if(p&&0==Ea){this.skipPosition(2*(q-D-1));break}w+=String.fromCharCode(Ea)}return w};this.setUnicodeString=function(m){for(var p=m.length,q=0;q<p;q++)this.setLittleEndian16(m.charCodeAt(q))};this.skipPosition=
function(m){q+=m};this.setPosition=function(m){q=m};this.getData=function(){return m};this.setByte=function(p){m[q++]=p};this.setLittleEndian16=function(p){m[q++]=p&255;m[q++]=p>>8&255};this.setLittleEndian32=function(p){m[q++]=p&255;m[q++]=p>>8&255;m[q++]=p>>16&255;m[q++]=p>>24&255}}function Brush(){this.style=this.yOrigin=this.xOrigin=0;this.pattern=Array(8)}function BoundsOrder(){this.bottom=this.top=this.right=this.left=0}
function DeskSaveOrder(){this.action=this.offset=this.bottom=this.top=this.right=this.left=0}function DestBltOrder(){this.opcode=this.cy=this.cx=this.y=this.x=0}function FontData(m,p,w,q,D,A,I){this.font=m;this.character=p;this.offset=w;this.baseline=q;this.width=D;this.height=A;this.fontdata=I}function LineOrder(){this.opcode=this.backgroundColor=this.endY=this.endX=this.startY=this.startX=this.mixmode=0;this.pen=new Pen}
function MemBltOrder(){this.cacheIDX=this.cacheID=this.colorTable=this.srcY=this.srcX=this.opcode=this.cy=this.cx=this.y=this.x=0}function PaletteData(m,p,w,q,D){this.bits=m;this.size=p;this.red=w;this.green=q;this.blue=D}function PatBltOrder(){this.foregroundColor=this.backgroundColor=this.opcode=this.cy=this.cx=this.y=this.x=0;this.brush=new Brush}function Pen(){this.color=this.width=this.style=0}
function PolyLineOrder(){this.dataSize=this.opcode=this.lines=this.foregroundColor=this.flags=this.y=this.x=0;this.data=Array(256)}function RectangleOrder(){this.color=this.cy=this.cx=this.y=this.x=0}function ScreenBltOrder(){this.srcY=this.srcX=this.opcode=this.cy=this.cx=this.y=this.x=0}
function Text2Order(){this.length=this.opcode=this.boxBottom=this.boxRight=this.boxTop=this.boxLeft=this.clipBottom=this.clipRight=this.clipTop=this.clipLeft=this.font=this.unknown=this.y=this.x=this.backgroundColor=this.foregroundColor=this.mixmode=this.flags=0;this.text=Array(256)}function TriBltOrder(){this.foregroundColor=this.backgroundColor=this.opcode=this.cy=this.cx=this.y=this.x=0;this.brush=new Brush;this.unknown=this.srcY=this.srcX=this.cacheIDX=this.cacheID=this.colorTable=0}
var Connection={KEY_IDS:"__CONNS",KEY_TIMESTAMP:"__TIMESTAMP",hasStorage:"localStorage"in window,getAll:function(){var m=localStorage[this.KEY_IDS];return null==m?[]:m.split(",")},saveForm:function(m){for(var m=m.elements,p=m.length,w={},q=null,D=0;D<p;D++){var A=m[D];if("button"!=A.type){var I=A.name,F=A.value;"server"==I&&(q=F);if("checkbox"==A.type)F=A.checked;else if("radio"==A.type&&!A.checked)continue;if("width"==I&&(F=parseInt(F),F==window.innerWidth||F==screen.width))continue;if("height"==
I&&(F=parseInt(F),F==window.innerHeight||F==screen.height))continue;"pwd"!=I&&(w[I]=F)}}return this.save(q,w)?q:null},save:function(m,p){if(null==m)return!1;var w=localStorage[m];localStorage[m]=JSON.stringify(p);var q=localStorage[this.KEY_IDS];null==q?q=m:null==w&&(q=q+","+m);localStorage[this.KEY_IDS]=q;return!0},loadToForm:function(m,p){if(null==p)return!1;var w=localStorage[p];if(null==w)return!1;for(var w=JSON.parse(w),q=m.elements,D=0,A=q.length;D<A;D++){var I=q[D],F=I.type;if(!("button"==
F||"submit"==F)){var S=I.name,J=w[S];if("undefined"==typeof J){if("gateway"!=S)switch(F){case "text":I.value="";break;case "checkbox":I.checked=!1;case "radio":I.checked=!1}}else"startProgram"==S?"shell"==I.id?(I.checked=!0==J||"shell"==J,I.value="shell"):I.checked=J==I.id:"checkbox"==F?I.checked=J:I.value=J}}return!0},clear:function(){localStorage.clear()},remove:function(m){localStorage.removeItem(m);for(var p=this.getAll(),w="",q=0,D=p.length;q<D;q++)m!=p[q]&&(""!=w&&(w+=","),w+=p[q]);localStorage[this.KEY_IDS]=
w},getValue:function(m){return this.hasStorage?localStorage[m]:null},setValue:function(m,p){localStorage[m]=p},removeItem:function(m){localStorage.removeItem(m)}};svGlobal.Rdp=Rdp;
