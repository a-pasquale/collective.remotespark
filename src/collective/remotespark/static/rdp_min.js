function connvertServer(m){var o={};o.id=m.id;o.server=m.id;o.displayName=m.displayName||m.id;(m=m.rdp)||(m={});o.port=m.port||3389;o.user=m.username||"";o.pwd=m.password||"";o.domain=m.domain||"";o.keyboard=m.keyboard||1033;o.useConsole=m.console||!1;o.legacyMode=m.leagacyMode||m.legacyMode||!1;o.server_bpp=m.color||16;o.playSound=m.playSound||0;o.mapClipboard=m.mapClipboard||!0;o.playSound=m.playSound||0;o.mapPrinter=m.mapPrinter||!0;o.mapDisk=m.mapDisk||!0;o.command=m.command||"";o.directory=m.directory||
"";o.exe=m.remoteProgram||"";o.args=m.remoteArgs||"";o.startProgram=0<o.exe.length?"app":0<o.command.length?"shell":"noapp";m.loadBalanceInfo&&(o.loadBalanceInfo=m.loadBalanceInfo);return o}
function getServers(m,o){var u=Connection.getValue(Connection.KEY_TIMESTAMP),u=null==u?"":"?since="+u;hi5.appcfg&&"boolean"==typeof hi5.appcfg.useWSS&&(m=(hi5.appcfg.useWSS?"wss":"ws")+m.substring(m.indexOf("://")));var p=new hi5.WebSocket(m+u),C=!1,v=!1;p.onmessage=function(m){C=!0;svGlobal.logger.debug(m.data);m=JSON.parse(m.data);m.lastModified&&Connection.setValue(Connection.KEY_TIMESTAMP,m.lastModified+"");if(m=m.connections)for(var o=0,u=m.length;o<u;o++){var A=m[o];null==Connection.getValue(A.id)&&
(Connection.save(A.id,connvertServer(A)),v=!0)}p.close()};p.onclose=function(){o(v,C)}}var svManager={getInstance:function(){return"rdpConnection"in window&&rdpConnection.running()?rdpConnection:null}};svGlobal.getInstance=svManager.getInstance;
window.addEventListener("beforeunload",function(m){var o=svManager.getInstance();if(o){var o=o.getRunninApps(),u=o.length;if(0<u){for(var p=__svi18n.remoteApp.warn+"\n\n",C=0;C<u;C++)p+=o[C]+"\n";p+="\n"+__svi18n.remoteApp.close+"\n";hi5.browser.isFirefox&&hi5.notifications.notify({msg:p});m&&(m.returnValue=p);return p}}},!1);
function Rdp2(m){if(!m){var o=window.opener;try{if(o&&o.__sparkUser&&o.__sparkUser.server&&(m=o.__sparkUser.server),!m&&o.sparkServer)m=o.sparkServer}catch(u){}m||(m=hi5.browser.cookie2Obj());if(!m)return alert(__svi18n.noauth),null}var p=o="",C=window.innerWidth,v=window.innerHeight,t=16,z=null,V;for(V in m){svGlobal.logger.debug("** p:"+V+" v="+m[V]);""!=o&&(o+="&");var A=m[V];if("useSSL"==V)z="true"===A;else{if("boolean"==typeof A)if(A)A="on";else continue;o+=V+"="+encodeURIComponent(A);switch(V){case "gateway":p=
A;break;case "width":C=parseInt(A);break;case "height":v=parseInt(A);break;case "color":t=parseInt(A)}}}null===z&&(z="https:"==location.protocol);return new Rdp((z?"wss://":"ws://")+p+"/RDP?"+o,C,v,t)}svGlobal.Rdp2=Rdp2;
function Rdp(m,o,u,p){var C,v,t,z;function V(){function a(a){a&=65535;return 32767<a?a-65536:a}function b(a){for(var b,c=0,d=0;320>d;d++)b=a[d],r[c++]=b&255,r[c++]=b>>8&255;return r}function c(a,b){var c=Array(8),e=Array(4),g=Array(4),k=Array(4),j=Array(4),f=Array(52),i=b,h=0,h=a[i++]&255;c[0]=h&63;h=(65535&h)>>>6|a[i++]<<2&1023;c[1]=h&63;h=(65535&h)>>>6|a[i++]<<4&4095;c[2]=h&31;h=(65535&h)>>>5;c[3]=h&31;h=(65535&h)>>>5|a[i++]<<2&1023;c[4]=h&15;h=(65535&h)>>>4;c[5]=h&15;h=(65535&h)>>>4|a[i++]<<2&
1023;c[6]=h&7;h=(65535&h)>>>3;c[7]=h&7;h=(65535&h)>>>3|a[i++]<<4&4095;e[0]=h&127;h=(65535&h)>>>7;k[0]=h&3;h=(65535&h)>>>2;g[0]=h&3;h=(65535&h)>>>2|a[i++]<<1&511;j[0]=h&63;f[0]=(65535&h)>>>6&7;h=a[i++]&255;f[1]=h&7;h=(65535&h)>>>3;f[2]=h&7;h=(65535&h)>>>3|a[i++]<<2&1023;f[3]=h&7;h=(65535&h)>>>3;f[4]=h&7;h=(65535&h)>>>3;f[5]=h&7;h=(65535&h)>>>3|a[i++]<<1&511;f[6]=h&7;h=(65535&h)>>>3;f[7]=h&7;f[8]=(65535&h)>>>3&7;h=a[i++]&255;f[9]=h&7;h=(65535&h)>>>3;f[10]=h&7;h=(65535&h)>>>3|a[i++]<<2&1023;f[11]=h&
7;h=(65535&h)>>>3;f[12]=h&7;h=(65535&h)>>>3|a[i++]<<4&4095;e[1]=h&127;h=(65535&h)>>>7;k[1]=h&3;h=(65535&h)>>>2;g[1]=h&3;h=(65535&h)>>>2|a[i++]<<1&511;j[1]=h&63;f[13]=(65535&h)>>>6&7;h=a[i++]&255;f[14]=h&7;h=(65535&h)>>>3;f[15]=h&7;h=(65535&h)>>>3|a[i++]<<2&1023;f[16]=h&7;h=(65535&h)>>>3;f[17]=h&7;h=(65535&h)>>>3;f[18]=h&7;h=(65535&h)>>>3|a[i++]<<1&511;f[19]=h&7;h=(65535&h)>>>3;f[20]=h&7;f[21]=(65535&h)>>>3&7;h=a[i++]&255;f[22]=h&7;h=(65535&h)>>>3;f[23]=h&7;h=(65535&h)>>>3|a[i++]<<2&1023;f[24]=h&7;
h=(65535&h)>>>3;f[25]=h&7;h=(65535&h)>>>3|a[i++]<<4&4095;e[2]=h&127;h=(65535&h)>>>7;k[2]=h&3;h=(65535&h)>>>2;g[2]=h&3;h=(65535&h)>>>2|a[i++]<<1&511;j[2]=h&63;f[26]=(65535&h)>>>6&7;h=a[i++]&255;f[27]=h&7;h=(65535&h)>>>3;f[28]=h&7;h=(65535&h)>>>3|a[i++]<<2&1023;f[29]=h&7;h=(65535&h)>>>3;f[30]=h&7;h=(65535&h)>>>3;f[31]=h&7;h=(65535&h)>>>3|a[i++]<<1&511;f[32]=h&7;h=(65535&h)>>>3;f[33]=h&7;f[34]=(65535&h)>>>3&7;h=a[i++]&255;f[35]=h&7;h=(65535&h)>>>3;f[36]=h&7;h=(65535&h)>>>3|a[i++]<<2&1023;f[37]=h&7;h=
(65535&h)>>>3;f[38]=h&7;h=(65535&h)>>>3|a[i++]<<4&4095;e[3]=h&127;h=(65535&h)>>>7;k[3]=h&3;h=(65535&h)>>>2;g[3]=h&3;h=(65535&h)>>>2|a[i++]<<1&511;j[3]=h&63;f[39]=(65535&h)>>>6&7;h=a[i++]&255;f[40]=h&7;h=(65535&h)>>>3;f[41]=h&7;h=(65535&h)>>>3|a[i++]<<2&1023;f[42]=h&7;h=(65535&h)>>>3;f[43]=h&7;h=(65535&h)>>>3;f[44]=h&7;h=(65535&h)>>>3|a[i++]<<1&511;f[45]=h&7;h=(65535&h)>>>3;f[46]=h&7;f[47]=(65535&h)>>>3&7;h=a[i++]&255;f[48]=h&7;h=(65535&h)>>>3;f[49]=h&7;h=(65535&h)>>>3|a[i++]<<2&1023;f[50]=h&7;h=(65535&
h)>>>3;f[51]=h&7;h=(65535&h)>>>3;d(c,e,g,k,j,f,s,0);h=h&15|a[i++]<<4&4095;c[0]=h&63;c[1]=(65535&h)>>>6&63;h=a[i++]&255;c[2]=h&31;h=(65535&h)>>>5|a[i++]<<3&2047;c[3]=h&31;h=(65535&h)>>>5;c[4]=h&15;h=(65535&h)>>>4|a[i++]<<2&1023;c[5]=h&15;h=(65535&h)>>>4;c[6]=h&7;c[7]=(65535&h)>>>3&7;h=a[i++]&255;e[0]=h&127;h=(65535&h)>>>7|a[i++]<<1&511;k[0]=h&3;h=(65535&h)>>>2;g[0]=h&3;h=(65535&h)>>>2|a[i++]<<5&8191;j[0]=h&63;h=(65535&h)>>>6;f[0]=h&7;h=(65535&h)>>>3;f[1]=h&7;h=(65535&h)>>>3|a[i++]<<1&511;f[2]=h&7;
h=(65535&h)>>>3;f[3]=h&7;f[4]=(65535&h)>>>3&7;h=a[i++]&255;f[5]=h&7;h=(65535&h)>>>3;f[6]=h&7;h=(65535&h)>>>3|a[i++]<<2&1023;f[7]=h&7;h=(65535&h)>>>3;f[8]=h&7;h=(65535&h)>>>3;f[9]=h&7;h=(65535&h)>>>3|a[i++]<<1&511;f[10]=h&7;h=(65535&h)>>>3;f[11]=h&7;f[12]=(65535&h)>>>3&7;h=a[i++]&255;e[1]=h&127;h=(65535&h)>>>7|a[i++]<<1&511;k[1]=h&3;h=(65535&h)>>>2;g[1]=h&3;h=(65535&h)>>>2|a[i++]<<5&8191;j[1]=h&63;h=(65535&h)>>>6;f[13]=h&7;h=(65535&h)>>>3;f[14]=h&7;h=(65535&h)>>>3|a[i++]<<1&511;f[15]=h&7;h=(65535&
h)>>>3;f[16]=h&7;f[17]=(65535&h)>>>3&7;h=a[i++]&255;f[18]=h&7;h=(65535&h)>>>3;f[19]=h&7;h=(65535&h)>>>3|a[i++]<<2&1023;f[20]=h&7;h=(65535&h)>>>3;f[21]=h&7;h=(65535&h)>>>3;f[22]=h&7;h=(65535&h)>>>3|a[i++]<<1&511;f[23]=h&7;h=(65535&h)>>>3;f[24]=h&7;f[25]=(65535&h)>>>3&7;h=a[i++]&255;e[2]=h&127;h=(65535&h)>>>7|a[i++]<<1&511;k[2]=h&3;h=(65535&h)>>>2;g[2]=h&3;h=(65535&h)>>>2|a[i++]<<5&8191;j[2]=h&63;h=(65535&h)>>>6;f[26]=h&7;h=(65535&h)>>>3;f[27]=h&7;h=(65535&h)>>>3|a[i++]<<1&511;f[28]=h&7;h=(65535&h)>>>
3;f[29]=h&7;f[30]=(65535&h)>>>3&7;h=a[i++]&255;f[31]=h&7;h=(65535&h)>>>3;f[32]=h&7;h=(65535&h)>>>3|a[i++]<<2&1023;f[33]=h&7;h=(65535&h)>>>3;f[34]=h&7;h=(65535&h)>>>3;f[35]=h&7;h=(65535&h)>>>3|a[i++]<<1&511;f[36]=h&7;h=(65535&h)>>>3;f[37]=h&7;f[38]=(65535&h)>>>3&7;h=a[i++]&255;e[3]=h&127;h=(65535&h)>>>7|a[i++]<<1&511;k[3]=h&3;h=(65535&h)>>>2;g[3]=h&3;h=(65535&h)>>>2|a[i++]<<5&8191;j[3]=h&63;h=(65535&h)>>>6;f[39]=h&7;h=(65535&h)>>>3;f[40]=h&7;h=(65535&h)>>>3|a[i++]<<1&511;f[41]=h&7;h=(65535&h)>>>3;
f[42]=h&7;f[43]=(65535&h)>>>3&7;h=a[i++]&255;f[44]=h&7;h=(65535&h)>>>3;f[45]=h&7;h=(65535&h)>>>3|a[i++]<<2&1023;f[46]=h&7;h=(65535&h)>>>3;f[47]=h&7;h=(65535&h)>>>3;f[48]=h&7;h=(65535&h)>>>3|a[i++]<<1&511;f[49]=h&7;h=(65535&h)>>>3;f[50]=h&7;f[51]=(65535&h)>>>3&7;d(c,e,g,k,j,f,s,160);return s}function d(a,b,c,d,r,s,q,u){var B=0,h=Array(160);h.fill(0);var D=Array(40);D.fill(0);for(var y=0;3>=y;y++,B+=13){var t=r[y],z=c[y],Md=B,x=s,C=D,F=Array(13);F.fill(0);var H=void 0,E=H=0;15<t&&(H=(t>>3)-1);E=t-(H<<
3);if(0==E)H=-4,E=7;else{for(;7>=E;)E=E<<1|1,H--;E-=8}if(-4>H||6<H)throw"Invalid quantization, exp:"+H;if(0>E||7<E)throw"Invalid quantization, mant = "+E;t=Array(2);t[0]=H;t[1]=E;for(var H=t,t=F,A=void 0,J=E=void 0,L=void 0,E=l[H[1]],J=k(6,H[0]),H=k(J,1),L=16<=H?0:-16>=H?-0.0:0>H?f(1,-H):1<<H,M=H=0;13>M;M++){A=(x[Md++]<<1)-7;if(!(7>=A&&-7<=A))throw"Invalid inverse quantization, temp = "+A;A<<=12;A=n(E,A);A=j(A,L);t[H++]=f(A,J)}x=13;H=t=0;if(!(0<=z&&3>=z))throw"Invalid positioning: Mc = "+z;switch(z){case 3:C[H++]=
0;case 2:C[H++]=0;case 1:C[H++]=0;case 0:C[H++]=F[t++],x--}do C[H++]=0,C[H++]=0,C[H++]=F[t++];while(0<--x);for(;4>++z;)C[H++]=0;t=b[y];H=d[y];C=D;x=z=F=void 0;K=x=40>t||120<t?K:t;if(!(40<=x&&120>=x))throw"Invlaid filtering Nr = "+x;F=m[H];if(-32768==F)throw"Invlaid filtering brp = "+F;for(t=0;39>=t;t++)z=n(F,o[t-x+120]),o[t+120]=j(C[t],z);hi5.tool.arraycopy(o,40,o,0,120);hi5.tool.arraycopy(o,120,h,40*y,39)}b=Array(8);c=p[Vc];d=p[Vc^=1];r=0;g(a,c,r++,0,0,-32,13107);g(a,c,r++,0,0,-32,13107);g(a,c,r++,
0,2048,-16,13107);g(a,c,r++,0,-2560,-16,13107);g(a,c,r++,0,94,-8,19223);g(a,c,r++,0,-1792,-8,17476);g(a,c,r++,0,-341,-4,31454);g(a,c,r++,0,-1144,-4,29708);for(a=0;8>a;a++)b[a]=j(d[a]>>2,c[a]>>2),b[a]=j(b[a],d[a]>>1);e(b);i(b,13,h,q,0,u);for(a=0;8>a;a++)b[a]=j(d[a]>>1,c[a]>>1);e(b);i(b,14,h,q,13,u);for(a=0;8>a;a++)b[a]=j(d[a]>>2,c[a]>>2),b[a]=j(b[a],c[a]>>1);e(b);i(b,13,h,q,27,u);for(a=0;8>a;a++)b[a]=c[a];e(b);i(b,120,h,q,40,u);a=u;for(b=u+160;b-- >u;a++)h=n(v,28180),v=j(q[a],h),q[a]=j(v,v)&65528}
function g(a,b,c,d,f,e,g){d=j(a[c],e)<<10;d=k(d,f<<1);d=n(g,d);b[c]=j(d,d)}function e(a){for(var b=0,c=0;8>c;c++)0>a[c]?(b=-32768===a[c]?32767:-a[c],a[c]=-(11059>b?b<<1:20070>b?b+11059:j(b>>2,26112))):(b=a[c],a[c]=11059>b?b<<1:20070>b?b+11059:j(b>>2,26112))}function i(b,c,d,f,e,g){for(var i=0,l=0,n=0,h=a;0!=c;){c--;for(var i=d[e],m=7;0<=m;m--)l=b[m],n=q[m],n=h(-32768==l&&-32768==n?32767:65535&l*n+16384>>15),i=k(i,n),l=h(-32768==l&&-32768==i?32767:65535&l*i+16384>>15),q[m+1]=j(q[m],l);f[g+e++]=q[0]=
i}}function n(b,c){return-32768==b&&-32768==c?32767:a(b*c+16384>>15)}function j(a,b){var c=a+b;return-32768>c?-32768:32767<c?32767:c}function k(a,b){var c=a-b;return-32768>c?-32768:32767<c?32767:c}function f(a,b){return 16<=b?0>a?-1:0:-16>=b?0:0>b?a<<-b:a>>b}var l=[18431,20479,22527,24575,26623,28671,30719,32767],m=[3277,11469,21299,32767],o=Array(280),p=[Array(8),Array(8)],Vc=0,K=40,q=Array(9),v=0,r=Array(640),s=Array(320);this.decode=function(a,d,f){for(var e=[];d<f;)var i=c(a,d),e=e.concat(b(i)),
d=d+65;return e};this.decodeBytes=c}function A(a,b){function c(a,b,c,e,f){for(var a=a.createImageData(e,f),g=a.data,m=d,e=b+e,f=c+f,o,p=0,q,K=c;K<f;K++)for(q=b;q<e;q++)c=m[K][q],o=p<<2,g[o]=c>>16&255,g[o+1]=c>>8&255,g[o+2]=c&255,g[o+3]=255,p++;return a}for(var d=Array(b),g=0;g<b;g++)d[g]=Array(a);var e=null;this.width=a;this.height=b;this.getBuffer=function(){return d};this.setRGB=function(a,b,c){d[b][a]=c};this.getRGB=function(a,b){return d[b][a]};this.setRGBs=function(a,b,c,e,f,g,m){for(var o=0,
c=a+c,e=b+e,p=d;b<e;b++,g+=m)for(var o=g,q=a;q<c;q++)p[b][q]=f[o++]};this.copyArea=function(a,b,c,e,f,g){for(var m=this.getRGBs(a,b,c,e),a=a+f,g=b+g,b=d,c=a+c,e=g+e,f=0,o=g;o<e;o++)for(g=a;g<c;g++)b[o][g]=m[f++]};this.getRGBs=function(a,b,c,e){for(var f=Array(c*e),g=d,c=a+c,e=b+e,m=0,o=b;o<e;o++)for(b=a;b<c;b++)f[m++]=g[o][b];return f};this.repaint=function(a,b,d,e){Ha.putImageData(c(Ha,a,b,d,e),a,b)};this.postPaint=function(a,b,c,d){e?e.union(a,b,c,d):e=new hi5.graphic.Rectangle(a,b,c,d)};this.commitPaint=
function(){e&&(this.repaint(e.x,e.y,e.width,e.height),e=null)};this.fillRect=function(a,b,c,e,f){for(var g=d,c=a+c,e=b+e,m=b;m<e;m++)for(b=a;b<c;b++)g[m][b]=f}}function Wb(){var a="SI_"+q.server;ca.domain&&(a+=ca.domain);ca.user&&(a+=ca.user);return a}function Wc(){if(!T&&"sessionStorage"in window&&!ca.pwd){var a=sessionStorage[Wb()];if(null!=a)try{var b=JSON.parse(a);if(!("random"in b))return"";for(var c=b.random,a=0;16>a;a++)c[a]&=255;svGlobal.logger.info("load session, id="+b.logId+" server="+
q.server);return"&logId="+b.logId+"&random="+encodeURIComponent(Y.enc(c))}catch(d){}}return""}function Xb(a){return 4278190080|(a>>8&248|a>>13&7)<<16|(a>>3&252|a>>9&3)<<8|a<<3&248|a>>2&7}function Xc(a){return 4278190080|(a>>7&248|a>>12&7)<<16|(a>>2&248|a>>8&7)<<8|a<<3&248|a>>2&7}function Yc(a){return 4278190080|ja[0][a]<<16|ja[1][a]<<8|ja[2][a]}function Zc(a){return 4278190080|(a&255)<<16|a&65280|(a&16711680)>>16}function $c(a){return 4278190080|(a&255)<<16|a&65280|(a&16711680)>>16}function Hb(a){p=
a;ad=(a+7)/8>>0;switch(a){case 16:pa=Xb;break;case 15:pa=Xc;break;case 8:pa=Yc;break;case 32:pa=Zc;break;case 24:pa=$c}}function Ib(a,b){o=a;u=b;L=M=0;F=o-1;E=u-1}function Yb(a){var b=__svi18n.errorCode[a];if(b){if(q.onerror)q.onerror({name:a,message:b});q.displayMsg&&hi5.notifications.notify({msg:b});0<svGlobal.log&&console.error(b)}}function Nd(){va=null;O=!1;ja=null;Cd();Z=new wc;Xa=0;xc=null;Zb=Array(256);mb=[];for(var a=0;12>a;a++)yc[a]=Array(256);Jb=Array(20);Ya.reset()}function Od(){var a;
if(null==wa)a="";else{a=Ia()+"/CLIP?s="+wa+"&t="+(new Date).getTime();var b=new XMLHttpRequest;b.open("GET",a,!1);b.setRequestHeader("Content-Type","text/plain;charset=UTF-8");b.send(null);a=b.responseText}return a}function Pd(){function a(a){return a.winWidth&&a.winHeight&&a.showState&&45<a.winHeight&&45<a.winWidth}var b=[],c=(new Date).getTime(),d=this;this.addWin=function(a){b.push(a)};this.isNew=function(){return 3E4>(new Date).getTime()-c};this.getAll=function(){return b};this.hasWin=function(a){return 0<=
b.indexOf(a)};this.close=function(){for(var a=0,c=b.length;a<c;a++)b[a].close()};this.delWin=function(a){for(var c=0,d=b.length;c<d;c++)if(b[c].id==a)return b.splice(c,1),c;return-1};this.isRunning=function(){var c,d=b.length;if(1>d)return!1;for(var i=0,d=b.length;i<d;i++)if(c=b[i],a(c))return!0;return!1};this.getWinById=function(a){var c,d=b.length;if(1>d)return!1;for(var n=0,d=b.length;n<d;n++)if(c=b[n],c.id==a)return c;return null};this.getTopWin=function(c){var e=null,i,n=c.length;for(i=0;i<n&&
(!(e=d.getWinById(c[i]))||!a(e));i++)e=null;if(!e){svGlobal.logger.warn("No win found");n=b.length;for(i=n-1;0<=i&&!(e=b[i],a(e));i--)e=null}return e};this.getMain=function(b){if(b=d.getTopWin(b)){for(var c;0<b.ownerWinid;)if((c=d.getWinById(b.ownerWinid))&&a(c))b=c;else break;return b}return null}}function nb(a,b){O&&(svGlobal.logger.info("reconnecting..."),x.send("8E0"+(a&-4)+"\t"+(b&-4)))}function zc(a){var b={},c=0;this.read=function(d,g,e){var i=B.getFocused().fileProgress,n=b[d];if("undefined"!=
typeof n){var j=n.name;1>n.size?alert(__svi18n.file.zero+j):(n=n.slice(g,g+e),j=new FileReader,j.onloadend=function(b){b.target.readyState==FileReader.DONE&&(b=new Uint8Array(b.target.result),a.send(d,g,e,b),c+=e,i.setProgress(c))},j.readAsArrayBuffer(n))}};this.addFile=function(c){if(!("slice"in c)&&(c.slice=c.webkitSlice||c.mozSlice,!("slice"in c))){alert(__svi18n.file.slice);return}var g=B.getFocused().fileProgress;"none"==g.style.display&&(g.style.display="block");var e=c.name;b[e]=c;g.maxValue+=
c.size;a.start(e,c.size)};this.confirmId=function(a,c){b[a]=b[c]};this.close=function(a){var g=B.getFocused(),e=g.fileProgress,i=b[a];i&&(delete b[a],delete b[i.name]);for(var n in b)return;c=e.maxValue=0;e.style.display="none";g.showMessage(__svi18n.file.uploadDone);g.refreshFiles()}}function $b(a){if(da&&Ja)for(var b=0,c=a.length;b<c;b++)da.addFile(a[b])}function ac(){this.start=function(a,b){x.send("3A0"+a+"\t"+b)};this.send=function(a,b,c,d){x.send("3A3"+a+"\t"+b+"\t"+c+"\t"+Y.enc(d))}}function Ka(a,
b){return D&&D.width>a&&D.height>b?D:new A(a,b)}function Qd(a){svGlobal.logger.warn(a)}function Rd(){svGlobal.logger.info("opened...");O=!0;x.send("87"+navigator.userAgent);if(q.onopen)q.onopen()}function Kb(a){a=Y.dec(a,0);return new RdpBuffer(a,0,a.length)}function Sd(a){var b,c=a.data;if("string"==typeof c)switch(b=parseInt(c.substring(0,2),16),a=c.substring(2),b){case 15:if(ha&&ha.onopen)ha.onopen();break;case 26:b=JSON.parse(a);if(b.name){svGlobal.logger.info("msg="+a);if(q.onerror)q.onerror(b);
a=__svi18n.errorCode["S"+b.name];a+=b.message;q.displayMsg&&q.showMessage(a)}else 0<svGlobal.log&&console.erro("No error code for message:"+a);break;case 27:B.drawLicense(a);break;case 48:bc(Kb(a));break;case 49:cc(Kb(a));break;case 50:b=parseInt(a.substring(0,1));a=a.substring(1);switch(b){case 1:svGlobal.logger.info("....... copy to clip:"+a);B.copyToClip(a);if(q.openLink&&(b=0==a.indexOf("http://")||0==a.indexOf("https://")||0==a.indexOf("ftp://")||0==a.indexOf("mailto:")||0==a.indexOf("tel:")||
0==a.indexOf("callto:"),!b&&0==a.indexOf("www.")&&(b=!0,a="http://"+a),b))(b=B.getFocused())&&b.processLink(a);break;case 2:svGlobal.logger.info("....... clipReq, clipString:"+va),xa.clipRequired=!0,xa.prePaste||(x.send("881"+(null==va?"":va)),xa.clipRequired=!1,va="")}break;case 51:B.setReadOnly("1"==a);break;case 54:a=Ia()+a;svGlobal.logger.info("Downloading file:"+a);b=B.getFocused();null!=b&&b.showPDF(a);break;case 55:b=parseInt(a.substring(0,1),16);a=a.substring(1);switch(b){case 0:a=a.split("\t");
C=parseInt(a[0]);t=parseInt(a[1]);v=parseInt(a[2]);z=parseInt(a[3]);svGlobal.logger.debug("Audio Format, tag="+C+" channels="+t+" bitsPerSample="+v+" samplePerSec="+z);hi5.browser.isFirefox&&null==ya&&(ya=new dc(q.audioBuffer));break;case 1:Td(a)}break;case 56:ob=a=JSON.parse(a);wa=a.session;ob.server=q.server;if(a=hi5.$("joinSelect"))a.value=ob.joinMode;if(a=hi5.$("requestControl"))a.disabled=ob.hasControl;break;case 58:b=a;a=parseInt(b.charAt(0));b=b.substring(1);if(5==a)xa.notifyFiles(JSON.parse(b));
else if(null!=da)switch(b=b.split("\t"),a){case 1:da.confirmId(b[0],b[1]);break;case 2:da.read(b[0],parseInt(b[1]),parseInt(b[2]));break;case 4:da.close(b[0])}break;case 59:a=Y.dec(a,0);a=(new RdpBuffer(a,0,a.length)).getLittleEndian32();Za||!(a&16)?(ec=!1,da=null,B.execute("setFileHandler",[null])):a&128&&(da=null,B.execute("disableUpload",[null]));if(a&64&&(b=__svi18n.info.recording))q.displayMsg&&hi5.notifications.notify({msg:b}),svGlobal.logger.info(b);a&256||B.execute("disableShadow",[null]);
break;case 60:Ac(Kb(a));break;case 61:a=JSON.parse(a);switch(a.type){case 0:Ib(a.width,a.height);D=Ka(o,u);Hb(a.color);if(b=a.server)q.server=a.server;fc=a.length;if(c=B.getFocused())if(c.setSize(o,u,T?"hidden":null),b&&q.setTitle&&(c.browser.document.title=q.server),b=a.keyboard,"undefined"!==typeof b&&0===b&&c.setUnicode(!0),b=a.mapDisk)ec=!0,c.setFileHandler($b),null==da&&(da=new zc(new ac));if(q.onopened)q.onopened(a);break;case 1:if(a=a.duration,q.onprogress)q.onprogress(a,fc)}break;case 62:Ud(a);
break;case 63:a=Kb(a);ha&&ha.process(a);break;default:svGlobal.logger.warn("@TODO:"+c+"\n")}else switch(a=new Int8Array(c),a=new RdpBuffer(a,0,a.length),b=a.getLittleEndian16(),b){case 48:bc(a);break;case 49:cc(a);break;case 55:switch(a.getByte()){case 0:C=a.getLittleEndian16();t=a.getLittleEndian16();z=a.getLittleEndian32();a.skipPosition(6);v=a.getLittleEndian16();svGlobal.logger.debug("Audio Format, tag="+C+" channels="+t+" bitsPerSample="+v+" samplePerSec="+z);hi5.browser.isFirefox&&null==ya&&
(ya=new dc(q.audioBuffer));break;case 1:Vd(a)}break;case 60:Ac(a);break;case 63:ha&&ha.process(a);break;default:svGlobal.logger.warn("@TODO:"+b+"\n")}}function Ud(a){var b=parseInt(a.substring(0,1),16),c,d=a.substring(1),a=!1;switch(b){case 0:c=JSON.parse(d);Nd();O=!0;b=c.width;a=c.height;if(b==o&&a==u)break;Ib(b,a);B.setSize(b,a,T?"hidden":null);D=Ka(b,a);break;case 1:q.reconnectOnResize=!1;c=JSON.parse(d);q.onsessionjoin&&(a=q.onsessionjoin(c));if(a)break;q.showMessage(__svi18n.info.joinsession.applyArgs([c.numericId,
c.__ip,c.name]));break;case 2:c=JSON.parse(d);q.onsessionexit&&(a=q.onsessionexit(c));if(a)break;q.showMessage(__svi18n.info.exitsession.applyArgs([c.numericId,c.__ip,c.name]));break;case 3:B.setReadOnly(!1);if(b=hi5.$("requestControl"))b.disabled=!0;q.ongivecontrol&&(a=q.ongivecontrol());if(a)break;q.showMessage(__svi18n.info.givecontrol);break;case 4:B.setReadOnly(!0);if(b=hi5.$("requestControl"))b.disabled=!1;q.ontakebackcontrol&&(a=q.ontakebackcontrol());if(a)break;q.showMessage(__svi18n.info.nocontrol);
break;case 5:c=JSON.parse(d);q.onrequirecontrol&&(a=q.onrequirecontrol(c));if(a)break;b=__svi18n.info.title.applyArgs([c.name,c.numericId,c.__ip]);hi5.notifications.notify({title:b,msg:"Requesting control.",cbYes:function(){q.giveControl(c.numericId);this.destroy()},cbNo:function(){q.refuseControl(c.numericId);this.destroy()}});break;case 6:B.execute("setTouchRemoting",[!0]);break;case 7:q.reconnectOnResize=!1,c=JSON.parse(d),D=Ka(c.width,c.height),Ib(c.width,c.height),B.setSize(c.width,c.height),
svGlobal.logger.warn("Resolution changed, width:"+c.width+" height:"+c.height)}}function Ac(a){switch(a.getByte()){case 32:a.getLittleEndian16();var b=a.getLittleEndian16(),a=a.getLittleEndian16();B.getFocused().moveCursor(b,a,!0)}}function Td(a){function b(a){var b=0,a=a*i;for(j=0;j<i;j++)b|=(e[a+j]&255)<<8*j;b>k?(b-=l,b/=-f):b/=k;return b}function c(){x.send("8A"+g)}if($.available){var d=a.indexOf("\t"),g=a.substring(0,d),e=Y.dec(a,d+1);49==C&&(za||(za=new V),e=za.decode(e,0,e.length));var a=v,
i=a>>3,n=Math.floor(e.length/i),j=0,k=Math.pow(2,a-1)-1,f=-k-1,l=Math.pow(2,a),a=0;if(hi5.browser.isFirefox){d=Array(n);for(a=0;a<n;a++)d[a]=b(a);a=ya.add(d);setTimeout(c,a-1E3*$.delay)}else{for(var d=t,n=Math.floor(n/d),m=$.getBuffer(n),o=m.getChannelData(0),p=m.getChannelData(1),a=0;a<n;){var q=2*a,K=b(q);1==d?(K*=0.707,o[a]=K,p[a]=K):(o[a]=K,p[a]=b(q+1));a++}a=$.playBuffer(m);setTimeout(c,1E3*(a-$.delay))}}}function Vd(a){function b(){var a=0,a=e[f++]&255|(e[f++]&255)<<8;a>n?(a-=k,a/=-j):a/=n;
return a}function c(){x.send("8A"+d)}if($.available){var d=a.getByte()+","+a.getLittleEndian16()+","+a.getLittleEndian64(),g=a.getPosition(),e=a.getData(),i=a.getEnd()-g;49==C&&(za||(za=new V),e=za.decode(e,g,i),g=0,i=e.length);var a=v,i=Math.floor(i/(a>>3)),n=Math.pow(2,a-1)-1,j=-n-1,k=Math.pow(2,a),f=g,g=0;if(hi5.browser.isFirefox){a=Array(i);for(g=0;g<i;g++)a[g]=b(g);g=ya.add(a);setTimeout(c,g-1E3*$.delay)}else{for(var a=t,i=Math.floor(i/a),l=$.getBuffer(i),m=l.getChannelData(0),o=l.getChannelData(1),
g=0;g<i;){var p=b();1==a?(p*=0.707,m[g]=p,o[g]=p):(m[g]=p,o[g]=b());g++}g=$.playBuffer(l);Za||setTimeout(c,1E3*(g-$.delay))}}}function dc(a){var b=[],c,d,g,e=new Wd(t,z,function(b){var c=b.length,e=c>i.size();if(d||e)i.stop(),setTimeout(function(){i.start()},1E3*a);else for(e=0;e<c;e++)b[e]=i.pull()}),i=this;this.delay=a;this.reset=function(){c=b.length=0;d=!0;e.stop();g=0};this.reset();this.start=function(){d&&(e.start(),d=!1)};this.stop=function(){e.stop();d=!0};this.size=function(){for(var a=b.length,
c=0,d=0;d<a;d++)c+=b[d].length;return c};this.add=function(c){var d=(new Date).getTime();g<d&&(g=d);g+=1E3*(c.length/(z*t));var i=b.length;b[i]=c;0==i&&(d=(new Date).getTime(),setTimeout(function(){e.start()},1E3*a));return g-d};this.pull=function(){if(0==b.length)return null;var a=b[0];if(c<a.length)return a[c++];b.shift();c=0;return this.pull()}}function Wd(a,b,c){function d(){var a;if(n){a=g.mozWriteAudio(n.subarray(j));e+=a;j+=a;if(j<n.length)return;n=null}a=g.mozCurrentSampleOffset()+i-e;if(0<
a){var b=new Float32Array(a);c(b);a=g.mozWriteAudio(b);a<b.length&&(n=b,j=a);e+=a}}var g=new Audio;g.mozSetup(a,b);var e=0,i=a*b/2,n=null,j=0,k=null;this.start=function(){k=setInterval(d,100)};this.stop=function(){null!=k&&clearInterval(k)}}function Ia(){var a=m.indexOf("://"),b=m.substring(a+3),a=b.indexOf("/");0<a&&(b=b.substring(0,a));return location.protocol+"//"+b}function bc(a){var b=a.getLittleEndian16(),c=a.getByte(),d=a.getByte(),g=a.getLittleEndian16(),e=null;if(0!=(d&32)){if(65536<b)throw"Invalid package size for decompression.";
if(-1==Ya.dec(a.getData(),a.getPosition(),g-18,d))throw"Error on decompressing data.";e=Ya.getData()}else e=a;switch(c){case 2:var i=e,n=i.getLittleEndian16();switch(n){case 0:i.skipPosition(2);n=i.getLittleEndian16();i.skipPosition(2);Bc(i,n);break;case 1:Cc(i);break;case 2:Dc(i);break;case 3:break;default:svGlobal.logger.warn("Unimplemented Update type "+n)}break;case 20:break;case 31:break;case 27:i=e;n=0;n=i.getLittleEndian16();i.skipPosition(2);switch(n){case 3:i.skipPositon(4);break;case 6:$a(i,
24);break;case 7:Ec(i);break;case 1:i=i.getLittleEndian16();switch(i){case 0:B.setCursor("default");break;default:svGlobal.logger.warn("XXX system pointer message "+i)}break;case 8:n=i.getLittleEndian16(),$a(i,n)}break;case 34:break;case 38:a=e;b=a.getLittleEndian32();if(3>b){Ja=!0;try{var j=q.sessionInfo;switch(b){case 0:a.skipPosition(4);j.domain=a.getUnicodeString(52,!0);a.skipPosition(4);j.userName=a.getUnicodeString(512,!0);j.sessionId=a.getLittleEndian32();break;case 1:j.version=a.getLittleEndian16(),
a.skipPosition(4),j.sessionId=a.getLittleEndian32(),i=a.getLittleEndian32(),n=a.getLittleEndian32(),a.skipPosition(558),j.domain=a.getUnicodeString(i,!0),j.userName=a.getUnicodeString(n,!0)}if(q.onloggedin)q.onloggedin()}catch(k){}}else if(3==b)if(a.skipPosition(2),2==a.getLittleEndian32())svGlobal.logger.warn(__svi18n.logError);else{a.skipPosition(4);if(28!=a.getLittleEndian32())throw"Invalid length of SaveSessoinInfo PDU";a.skipPosition(4);i={};i.logId=a.getLittleEndian32();i.time=(new Date).getTime();
q.sessionInfo.sessionId=i.logId;if(!Ja&&q.onloggedin)q.onloggedin();Ja=!0;n=a.getBytes(16);j=Array(16);for(a=0;16>a;a++)j[a]=n[a]&255;i.random=j;x.send("8D"+i.logId+"\t"+Y.enc(j));if("sessionStorage"in window)try{sessionStorage[Wb()]=JSON.stringify(i)}catch(f){}}break;case 47:i=e.getLittleEndian32();1>i||Yb(i);break;case 54:i=e.getLittleEndian32().toString(16).toUpperCase();i=__svi18n.serverStatus[i];q.displayMsg&&q.showMessage(i);break;default:svGlobal.logger.warn("Unimplemented Data PDU type "+
c)}}function cc(a){var b=a.getByte(),c=b&15,d=b>>4&3;if(0!=d)throw"Fragmentation is not supported yet";var g,e=0;2==(b>>6&3)&&(e=a.getByte());g=a.getLittleEndian16();b=null;if(0!=(e&32)){if(1!=(e&15))throw"only support PACKET_COMPR_TYPE_64K";if(-1==Ya.dec(a.getData(),a.getPosition(),g,e))throw __svi18n.errorDecompress;b=Ya.getData()}else b=a;if(0!=d)if(2==d&&(null==Aa?Aa=[]:Aa.length=0),Aa.push(b.getData().slice(b.getPosition(),b.getEnd())),1==d){a=0;d=Aa.length;for(a=0;a<d;a++);e=[];for(a=0;a<d;a++)e.concat(Aa[a]);
b=new RdpBuffer(e,0,e.length);Aa.length=0}else return;switch(c){case 0:c=b.getLittleEndian16();Bc(b,c);break;case 1:b.skipPosition(2);Cc(b);break;case 2:b.skipPosition(2);Dc(b);break;case 3:break;case 5:B.setCursor("default");break;case 6:break;case 8:break;case 9:$a(b,24);break;case 10:Ec(b);break;case 11:c=b;a=c.getLittleEndian16();$a(c,a);break;default:svGlobal.logger.warn("XXX RDP5 opcode "+c)}}function Ec(a){a=a.getLittleEndian16();(a=Fc(a))&&B.setCursor(a)}function Xd(a,b,c,d,g,e,i,n){this.x=
a;this.y=b;this.width=c;this.height=d;this.mask=g;this.pixel=e;this.bpp=i;this.cache_idx=n}function $a(a,b){if(!Yd){var c=0,d=0,g=0,e=0,i=0,n=0,j=0,i=a.getLittleEndian16(),c=a.getLittleEndian16(),d=a.getLittleEndian16(),g=a.getLittleEndian16(),e=a.getLittleEndian16(),n=a.getLittleEndian16(),j=a.getLittleEndian16(),j=a.getBytes(j),k=a.getBytes(n);if(0>c||c>=g-1)c=0;0>d?d=0:d>=e&&(d=e-1);for(var f=!0,l=0;l<n;l++)if(-1!=k[l]){f=!1;break}if(!f){j=new Xd(c,d,g,e,k,j,b,i);if(!hi5.browser.isOpera){var d=
j.x,g=j.y,n=j.width,e=j.height,c=j.cache_idx,k=j.mask,f=j.pixel,l=j.bpp,j=Array(n*e),m=0,o=0<d&&0==k[0],p=0,q,K;for(q=0;q<e;q++)for(K=0;K<n;K++){j[m]=Zd(K,q,n,e,l,f);if(!o)if(p=q,1!=l&&(p=e-p-1),p=p*n+K,p=0==(k[p/8>>0]&128>>p%8)?1:0,0==p&&0!=j[m])j[m]=~j[m],j[m]|=4278190080;else if(1==p||0!=j[m])j[m]|=4278190080;m++}f=4*n*e;l=n*e/8;k=62+f+l+l;k=new RdpBuffer(Array(k),0,k);k.setLittleEndian16(0);k.setLittleEndian16(2);k.setLittleEndian16(1);k.setByte(n);k.setByte(e);k.setByte(0);k.setByte(0);k.setLittleEndian16(d);
k.setLittleEndian16(g);k.setLittleEndian32(40+f+l+l);k.setLittleEndian32(22);k.setLittleEndian32(40);k.setLittleEndian32(n);k.setLittleEndian32(2*e);k.setLittleEndian16(1);k.setLittleEndian16(32);k.setLittleEndian32(0);k.setLittleEndian32(l+l);k.setLittleEndian32(0);k.setLittleEndian32(0);k.setLittleEndian32(0);k.setLittleEndian32(0);for(f=e-1;0<=f;f--)for(l=0;l<n;l++)m=j[n*f+l],k.setByte(m&255),k.setByte(m>>8&255),k.setByte(m>>16&255),k.setByte(m>>24&255);n=n/8>>0;for(f=0;f<e;f+=1)for(l=0;l<n;l+=
1)k.setByte(0);for(f=0;f<e;f+=1)for(l=0;l<n;l+=1)k.setByte(0);d={data:"data:image/x-icon;base64,"+Y.enc(k.getData()),hotX:d,hotY:g};if(20>c)Jb[c]=d;else throw"Could not put Cursor!";}(i=Fc(i))&&B.setCursor(i)}}}function Zd(a,b,c,d,g,e){1!=g&&(b=d-b-1);b=(b*c+a)*g;c=b/8>>0;a=e[c]&255;switch(g){case 1:return 0==(a&128>>b%8)?0:4294967295;case 8:return 0==a?0:4294967295;case 15:return a|=(e[c+1]&255)<<8,g=Array(4),gc(a,15,g,0),g[0]<<16|g[1]<<8|g[2];case 16:return a|=(e[c+1]&255)<<8,g=Array(4),gc(a,16,
g,0),g[0]<<16|g[1]<<8|g[2];case 24:return(e[c+2]&255)<<16|(e[c+1]&255)<<8|a;case 32:return(e[c+3]&255)<<24|(e[c+2]&255)<<16|(e[c+1]&255)<<8|a;default:throw"invalid bpp value for Xor Mask.";}}function Dc(a){var b=0,c=null,d=null,g=null,e=0;a.skipPosition(2);b=a.getLittleEndian16();a.skipPosition(2);for(var c=Array(b),d=Array(b),g=Array(b),a=a.getBytes(3*b),i=0;i<b;i++)c[i]=a[e],d[i]=a[e+1],g[i]=a[e+2],e+=3;256==b&&(null==ja&&(ja=Array(3)),ja[0]=c,ja[1]=d,ja[2]=g)}function Bc(a,b){for(var c=0,d=0;c<
b;){d=a.getByte();if(0==(d&1)){var g=d>>2;if(2!=(d&3))throw"Not a valid Alt secondary order";switch(g){case 11:var e=a,i=e.getLittleEndian16(),n=e.getLittleEndian32(),j=e.getPosition()+(i-7);if(0!=(n&16777216)){var k=n,f=e,l=f.getLittleEndian32();0!=(k&1073741824)?svGlobal.logger.info("XXX rail icon, winId="+l):0!=(k&2147483648)?svGlobal.logger.info("XXX rail cache icon, winId="+l):0!=(k&536870912)?(svGlobal.logger.info("***** delete winId="+l),B.delWin(l)):$d(f,k,l)}else if(0!=(n&33554432))svGlobal.logger.info("XXX Alt Sec window Notify="+
n);else if(0!=(n&67108864)){var m=n,q=e;svGlobal.logger.info("*** -- Alt Sec window Desktop="+m);if(0!=(m&1))svGlobal.logger.info("Desktop non monitored flags="+m);else if(0!=(m&32)){var v=q.getLittleEndian32();svGlobal.logger.info("Desktop monitored flags="+m+" winId="+v);if(0!=(m&16)){var t=q.getByte();if(0<t){var K=B.zOrders;K.length=t;for(var z=0;z<t;z++)K[z]=q.getLittleEndian32(),svGlobal.logger.info("---zorders:"+K[z])}}}}else svGlobal.logger.info("XXX Alt Sec window order flgas="+n);e.setPosition(j);
break;default:svGlobal.logger.warn("XXX Alt Sec order not implemented:"+g)}}else if(0!=(d&2)){var x=a,r=void 0,s=void 0,w=void 0,C=void 0,r=x.getLittleEndian16(),w=x.getLittleEndian16(),s=x.getByte(),C=x.getPosition()+r+7;switch(s){case 0:svGlobal.logger.warn("TODO: raw bitmap cache");break;case 1:svGlobal.logger.info("TODO: color cache");break;case 2:var A=x,J=w,O=A.getByte();A.getByte();var N=A.getByte(),V=A.getByte(),T=A.getByte(),ca=Math.floor((T+7)/8),h=A.getLittleEndian16(),ja=A.getLittleEndian16(),
da=0;0!=(J&1024)?da=h:(A.skipPosition(2),da=A.getLittleEndian16(),A.skipPosition(2),A.skipPosition(2));var ha=void 0,$=A.getBytes(da),ha=1==ca?bd(N,V,$.length,$):cd(N,V,$.length,$,ca,p);Dd(O,ja,new dd(ha,N,V,0,0,T),0);break;case 3:for(var Y=x,ya=null,va=0,Aa=0,H=0,Ha=0,Ja=0,xa=0,za=0,Wb=0,va=Y.getByte(),Aa=Y.getByte(),Ya=0;Ya<Aa;Ya++){var H=Y.getLittleEndian16(),Ha=Y.getLittleEndian16(),Ja=Y.getLittleEndian16(),xa=Y.getLittleEndian16(),za=Y.getLittleEndian16(),Wb=za*Math.floor((xa+7)/8)+3&-4,pb=ya=
new ae(va,H,Ha,Ja,xa,za,Y.getBytes(Wb));if(12>pb.font&&256>pb.character)yc[pb.font][pb.character]=pb;else throw svGlobal.logger.warn("put font: font="+pb.font+" c="+pb.character),"Could not put font in cache";}break;case 4:Ed(x,w,!1);break;case 5:Ed(x,w,!0);break;default:svGlobal.logger.info("XXX second Order, type="+s)}x.setPosition(C)}else{var na=a,ab=d,sa=0,wa=0,Ba=!1;if(0==(ab&1))throw"Not a standard order!";0!=(ab&8)&&(Z.orderType=na.getByte());switch(Z.orderType){case 14:case 27:wa=3;break;
case 1:case 13:case 9:wa=2;break;default:wa=1}var ob=na,ua=wa,Ua=0,lb=0;0!=(ab&64)&&ua--;0!=(ab&128)&&(ua=2>ua?0:ua-2);for(var Wa=0;Wa<ua;Wa++)lb=ob.getByte(),Ua|=lb<<8*Wa;sa=Ua;if(0!=(ab&4)){if(0==(ab&32)){var La=na,ea=Z.bounds,bb=La.getByte();0!=(bb&1)?ea.left=y(La,ea.left,!1):0!=(bb&16)&&(ea.left=y(La,ea.left,!0));0!=(bb&2)?ea.top=y(La,ea.top,!1):0!=(bb&32)&&(ea.top=y(La,ea.top,!0));0!=(bb&4)?ea.right=y(La,ea.right,!1):0!=(bb&64)&&(ea.right=y(La,ea.right,!0));0!=(bb&8)?ea.bottom=y(La,ea.bottom,
!1):0!=(bb&128)&&(ea.bottom=y(La,ea.bottom,!0))}var Ia=Z.bounds;M=Ia.left;L=Ia.top;F=Ia.right;E=Ia.bottom}Ba=0!=(ab&16);switch(Z.orderType){case 0:var hc=na,ka=Z.destBlt,ic=sa,Ka=Ba;0!=(ic&1)&&(ka.x=y(hc,ka.x,Ka));0!=(ic&2)&&(ka.y=y(hc,ka.y,Ka));0!=(ic&4)&&(ka.cx=y(hc,ka.cx,Ka));0!=(ic&8)&&(ka.cy=y(hc,ka.cy,Ka));0!=(ic&16)&&(ka.opcode=Gc(hc.getByte()));var qb=ka.x,rb=ka.y,jc=ka.cx,kc=ka.cy,Kb=ka.opcode;if(!(qb>o||rb>u)){var Za=qb+jc-1;Za>F&&(Za=F);qb<M&&(qb=M);var jc=Za-qb+1,$a=rb+kc-1;$a>E&&($a=
E);rb<L&&(rb=L);kc=$a-rb+1;1>jc||1>kc||(lc(Kb,D,o,qb,rb,jc,kc,null,0,0,0),D.repaint(qb,rb,jc,kc))}break;case 1:var cb=na,P=Z.patBlt,db=sa,Va=Ba;0!=(db&1)&&(P.x=y(cb,P.x,Va));0!=(db&2)&&(P.y=y(cb,P.y,Va));0!=(db&4)&&(P.cx=y(cb,P.cx,Va));0!=(db&8)&&(P.cy=y(cb,P.cy,Va));if(0!=(db&16)){var Vb=P,Fb=cb.getByte();Vb.opcode=Fb&3|(Fb&48)>>2}0!=(db&32)&&(P.backgroundColor=Ma(cb));0!=(db&64)&&(P.foregroundColor=Ma(cb));Fd(cb,P.brush,db>>7);var Hb=P.x,Ib=P.y;if(!(Hb>F||Ib>E)){var Jb=P.opcode,eb=Hb,fb=Ib,qa=P.cx,
Ca=P.cy,Hc=P.foregroundColor,nb=P.backgroundColor,ec=P.brush.xOrigin,gc=P.brush.yOrigin,Ub=P.brush.style,vc=P.brush.pattern,Hc=pa(Hc),nb=pa(nb),Gb=eb+qa-1;Gb>F&&(Gb=F);eb<M&&(eb=M);var qa=Gb-eb+1,ed=fb+Ca-1;ed>E&&(ed=E);fb<L&&(fb=L);Ca=ed-fb+1;if(!(1>qa||1>Ca)){var sb=null;switch(Ub){case 0:for(var sb=Array(qa*Ca),tb=0;tb<sb.length;tb++)sb[tb]=Hc;lc(Jb,D,o,eb,fb,qa,Ca,sb,qa,0,0);D.repaint(eb,fb,qa,Ca);break;case 2:svGlobal.logger.warn("hatch");break;case 3:for(var sb=Array(qa*Ca),Xb=0,tb=0;tb<Ca;tb++)for(var fd=
0;fd<qa;fd++)sb[Xb]=0==(vc[(tb+gc)%8]&1<<(fd+ec)%8)?Hc:nb,Xb++;lc(Jb,D,o,eb,fb,qa,Ca,sb,qa,0,0);D.repaint(eb,fb,qa,Ca);break;default:svGlobal.logger.warn("Unsupported brush style "+Ub)}}}break;case 2:var ub=na,R=Z.screenBlt,vb=sa,Lb=Ba;0!=(vb&1)&&(R.x=y(ub,R.x,Lb));0!=(vb&2)&&(R.y=y(ub,R.y,Lb));0!=(vb&4)&&(R.cx=y(ub,R.cx,Lb));0!=(vb&8)&&(R.cy=y(ub,R.cy,Lb));0!=(vb&16)&&(R.opcode=Gc(ub.getByte()));0!=(vb&32)&&(R.srcX=y(ub,R.srcX,Lb));0!=(vb&64)&&(R.srcY=y(ub,R.srcY,Lb));var Na=R.x,Oa=R.y;if(!(Na>F||
Oa>E)){var gb=R.cx,Mb=R.cy,Yb=R.opcode,mc=R.srcX,nc=R.srcY,gd=Na+gb-1;gd>F&&(gd=F);Na<M&&(Na=M);var gb=gd-Na+1,hd=Oa+Mb-1;hd>E&&(hd=E);Oa<L&&(Oa=L);Mb=hd-Oa+1;mc+=Na-R.x;nc+=Oa-R.y;1>gb||1>Mb||(12!=Yb?lc(Yb,D,gb,Na,Oa,gb,Mb,null,gb,mc,nc):D.copyArea(mc,nc,gb,Mb,Na-mc,Oa-nc),D.repaint(Na,Oa,gb,Mb))}break;case 9:var hb=na,W=Z.line,ib=sa,Ic=Ba;0!=(ib&1)&&(W.mixmode=hb.getLittleEndian16());0!=(ib&2)&&(W.startX=y(hb,W.startX,Ic));0!=(ib&4)&&(W.startY=y(hb,W.startY,Ic));0!=(ib&8)&&(W.endX=y(hb,W.endX,Ic));
0!=(ib&16)&&(W.endY=y(hb,W.endY,Ic));0!=(ib&32)&&(W.backgroundColor=Ma(hb));0!=(ib&64)&&(W.opcode=hb.getByte());var id=hb,jd=W.pen,kd=ib>>7;0!=(kd&1)&&(jd.style=id.getByte());0!=(kd&2)&&(jd.width=id.getByte());0!=(kd&4)&&(jd.color=Ma(id));var wb=W.startX,Pa=W.startY,xb=W.endX,oc=W.endY,wc=W.pen.color,zc=W.opcode-1;if(Pa==oc){if(wb>xb)var ld=wb,wb=xb,xb=ld;wb<M&&(wb=M);xb>F&&(xb=F)}else wb==xb&&(Pa>oc&&(ld=Pa,Pa=oc,oc=ld),Pa<L&&(Pa=L),Pa>E&&(Pa=E));Gd(wb,Pa,xb,oc,wc,zc);break;case 10:var yb=na,la=
Z.rectangle,zb=sa,Jc=Ba;0!=(zb&1)&&(la.x=y(yb,la.x,Jc));0!=(zb&2)&&(la.y=y(yb,la.y,Jc));0!=(zb&4)&&(la.cx=y(yb,la.cx,Jc));0!=(zb&8)&&(la.cy=y(yb,la.cy,Jc));0!=(zb&16)&&(Xa=Xa&4294967040|yb.getByte());0!=(zb&32)&&(Xa=Xa&4294902015|yb.getByte()<<8);0!=(zb&64)&&(Xa=Xa&4278255615|yb.getByte()<<16);la.color=Xa;md(la.x,la.y,la.cx,la.cy,la.color,!0);break;case 11:var Nb=na,ta=Z.deskSave,Ob=sa,Kc=Ba;0!=(Ob&1)&&(ta.offset=Nb.getLittleEndian32());0!=(Ob&2)&&(ta.left=y(Nb,ta.left,Kc));0!=(Ob&4)&&(ta.top=y(Nb,
ta.top,Kc));0!=(Ob&8)&&(ta.right=y(Nb,ta.right,Kc));0!=(Ob&16)&&(ta.bottom=y(Nb,ta.bottom,Kc));0!=(Ob&32)&&(ta.action=Nb.getByte());var Qa=ta,nd=Qa.right-Qa.left+1,od=Qa.bottom-Qa.top+1;if(0==Qa.action)1>nd||1>od||(xc=D.getRGBs(Qa.left,Qa.top,nd,od));else{var pd=nd,$b=od,ac=Qa.left,bc=Qa.top;xc?(D.setRGBs(ac,bc,pd,$b,xc,0,pd),D.repaint(ac,bc,pd,$b)):svGlobal.logger.warn("XXX no matched desktop save.")}break;case 13:var Da=na,aa=Z.memBlt,Ra=sa,Pb=Ba;0!=(Ra&1)&&(aa.cacheID=Da.getByte(),aa.colorTable=
Da.getByte());0!=(Ra&2)&&(aa.x=y(Da,aa.x,Pb));0!=(Ra&4)&&(aa.y=y(Da,aa.y,Pb));0!=(Ra&8)&&(aa.cx=y(Da,aa.cx,Pb));0!=(Ra&16)&&(aa.cy=y(Da,aa.cy,Pb));0!=(Ra&32)&&(aa.opcode=Gc(Da.getByte()));0!=(Ra&64)&&(aa.srcX=y(Da,aa.srcX,Pb));0!=(Ra&128)&&(aa.srcY=y(Da,aa.srcY,Pb));0!=(Ra&256)&&(aa.cacheIDX=Da.getLittleEndian16());var X=aa,Sa=X.x,Ta=X.y;if(!(Sa>F||Ta>E)){var pc=X.cx,qc=X.cy,Lc=X.srcX,Mc=X.srcY,qd=Sa+pc-1;qd>F&&(qd=F);Sa<M&&(Sa=M);var pc=qd-Sa+1,rd=Ta+qc-1;rd>E&&(rd=E);Ta<L&&(Ta=L);qc=rd-Ta+1;Lc+=
Sa-X.x;Mc+=Ta-X.y;255==X.cacheID&&svGlobal.logger.warn("XXX: offscree");var Qb="undefined"==typeof mb[X.cacheID]||"undefined"==typeof mb[X.cacheID][X.cacheIDX]?null:mb[X.cacheID][X.cacheIDX];null==Qb?svGlobal.logger.warn("Failed to get bitmap from cache, id:"+X.cacheID+" idx="+X.cacheIDX):(12==X.opcode?D.setRGBs(Sa,Ta,pc,qc,Qb.byteArray,Mc*Qb.width+Lc,Qb.width):lc(X.opcode,D,o,Sa,Ta,pc,qc,Qb.byteArray,Qb.width,Lc,Mc),D.repaint(Sa,Ta,pc,qc))}break;case 14:var ma=na,U=Z.triBlt,oa=sa,Rb=Ba;0!=(oa&1)&&
(U.cacheID=ma.getByte(),U.colorTable=ma.getByte());0!=(oa&2)&&(U.x=y(ma,U.x,Rb));0!=(oa&4)&&(U.y=y(ma,U.y,Rb));0!=(oa&8)&&(U.cx=y(ma,U.cx,Rb));0!=(oa&16)&&(U.cy=y(ma,U.cy,Rb));0!=(oa&32)&&(U.opcode=Gc(ma.getByte()));0!=(oa&64)&&(U.srcX=y(ma,U.srcX,Rb));0!=(oa&128)&&(U.srcY=y(ma,U.srcY,Rb));0!=(oa&256)&&(U.backgroundColor=Ma(ma));0!=(oa&512)&&(U.foregroundColor=Ma(ma));Fd(ma,U.brush,oa>>10);0!=(oa&32768)&&(U.cacheIDX=ma.getLittleEndian16());0!=(oa&65536)&&(U.unknown=ma.getLittleEndian16());svGlobal.logger.warn("XXX: TriBlt");
break;case 22:var Ab=na,Ea=Z.polyLine,Sb=sa,cc=Ba;0!=(Sb&1)&&(Ea.x=y(Ab,Ea.x,cc));0!=(Sb&2)&&(Ea.y=y(Ab,Ea.y,cc));0!=(Sb&4)&&(Ea.opcode=Ab.getByte());0!=(Sb&16)&&(Ea.foregroundColor=Ma(Ab));0!=(Sb&32)&&(Ea.lines=Ab.getByte());if(0!=(Sb&64)){var dc=Ab.getByte();Ea.dataSize=dc;Ea.data=Ab.getBytes(dc)}var Bb=Ea,Nc=Bb.x,Oc=Bb.y,Ac=Bb.foregroundColor,fc=Bb.lines,Bc=Bb.dataSize,sd=Bb.data,Pc=Array(1);Pc[0]=Math.floor((fc-1)/4)+1;for(var jb=0,Cc=0,Dc=Bb.opcode-1,td=0;td<fc&&Pc[0]<Bc;td++){var Ec=Nc,Fc=Oc;
0==td%4&&(jb=sd[Cc++]);0==(jb&192)&&(jb|=192);0!=(jb&64)&&(Nc+=Hd(sd,Pc));0!=(jb&128)&&(Oc+=Hd(sd,Pc));Gd(Ec,Fc,Nc,Oc,Ac,Dc);jb<<=2}break;case 27:var Q=na,G=Z.text2,S=sa;0!=(S&1)&&(G.font=Q.getByte());0!=(S&2)&&(G.flags=Q.getByte());0!=(S&4)&&(G.opcode=Q.getByte());0!=(S&8)&&(G.mixmode=Q.getByte());0!=(S&16)&&(G.foregroundColor=Ma(Q));0!=(S&32)&&(G.backgroundColor=Ma(Q));0!=(S&64)&&(G.clipLeft=Q.getLittleEndian16());0!=(S&128)&&(G.clipTop=Q.getLittleEndian16());0!=(S&256)&&(G.clipRight=Q.getLittleEndian16());
0!=(S&512)&&(G.clipBottom=Q.getLittleEndian16());0!=(S&1024)&&(G.boxLeft=Q.getLittleEndian16());0!=(S&2048)&&(G.boxTop=Q.getLittleEndian16());0!=(S&4096)&&(G.boxRight=Q.getLittleEndian16());0!=(S&8192)&&(G.boxBottom=Q.getLittleEndian16());0!=(S&16384)&&Q.skipPosition(1);0!=(S&32768)&&Q.skipPosition(1);0!=(S&65536)&&Q.skipPosition(1);0!=(S&131072)&&Q.skipPosition(1);0!=(S&262144)&&Q.skipPosition(7);0!=(S&524288)&&(G.x=Q.getLittleEndian16());0!=(S&1048576)&&(G.y=Q.getLittleEndian16());0!=(S&2097152)&&
(G.length=Q.getByte(),G.text=Q.getBytes(G.length));var sc=G.font,Fa=G.flags,ud=G.mixmode,tc=G.foregroundColor,Qc=G.backgroundColor,vd=G.clipLeft,wd=G.clipTop,rc=G.boxLeft,xd=G.boxTop,fa=G.x,ra=G.y,Cb=G.length,ia=G.text,yd=G.clipRight-vd,zd=G.clipBottom-wd,Tb=G.boxRight-rc,Ad=G.boxBottom-xd,ga=null,kb=0,ba=0;rc+Tb>o&&(Tb=o-rc);1<Tb?md(rc,xd,Tb,Ad,Qc,!1):1==ud&&md(vd,wd,yd,zd,Qc,!1);for(var Tc=ia.length,I=0;I<Cb;)switch(ia[ba+I]&255){case 255:var Bd=ia[ba+I+2]&255;if(Bd>Tc-ba){I=Cb=0;break}for(var uc=
Array(ia[ba+I+2]&255),Uc=ia,Wc=ba,Xc=uc,Yc=Bd,Rc=0;Rc<Yc;Rc++)Xc[0+Rc]=Uc[Wc+Rc];var Zc=new be(Bd,uc),Id=ia[ba+I+1]&255;if(Id<Zb.length)Zb[Id]=Zc;else throw"Could not put Text in cache";I+=3;Cb-=I;ba=I;I=0;break;case 254:var Db;a:{var Jd=ia[ba+I+1]&255,Sc=null;if(Jd<Zb.length&&(Sc=Zb[Jd],null!=Sc&&null!=Sc.data)){Db=Sc;break a}Db=null}var Eb=null!=Db?Db.data:null;null!=Db&&0==Eb[1]&&0==(Fa&32)&&(0!=(Fa&4)?ra+=ia[ba+I+2]&255:fa+=ia[ba+I+2]&255);I=I+2<Cb?I+3:I+2;Cb-=I;ba=I;I=0;if(null==Db)break;for(var $c=
Db.size,Ga=0;Ga<$c;Ga++)if(ga=Kd(sc,Eb[Ga]&255),0==(Fa&32)&&(kb=Eb[++Ga]&255,0!=(kb&128)?(0!=(Fa&4)?ra+=Eb[Ga+1]&255|(Eb[Ga+2]&255)<<8:fa+=Eb[Ga+1]&255|(Eb[Ga+2]&255)<<8,Ga+=2):0!=(Fa&4)?ra+=kb:fa+=kb),null!=ga)Ld(ud,fa+ga.offset&65535,ra+ga.baseLine&65535,ga.width,ga.height,ga.fontData,Qc,tc,ad,p),0!=(Fa&32)&&(fa+=ga.width);break;default:ga=Kd(sc,ia[ba+I]&255),0==(Fa&32)&&(kb=ia[ba+ ++I]&255,0!=(kb&128)?(0!=(Fa&4)?ra+=ia[ba+I+1]&255|(ia[ba+I+2]&255)<<8:fa+=ia[ba+I+1]&255|(ia[ba+I+2]&255)<<8,I+=2):
0!=(Fa&4)?ra+=kb:fa+=kb),null!=ga&&(Ld(ud,fa+ga.offset&65535,ra+ga.baseLine&65535,ga.width,ga.height,ga.fontData,Qc,tc,ad,p),0!=(Fa&32)&&(fa+=ga.width)),I++}1<Tb?0<Ad&&D.postPaint(rc,xd,Tb,Ad):0<yd&&0<zd&&D.postPaint(vd,wd,yd,zd);break;default:svGlobal.logger.warn("XXX Order type "+Z.orderType)}0!=(ab&4)&&Cd()}c++}D.commitPaint()}function ce(a){this.id=a;this.fillBrowser=function(){var b=B.getOwnerSurface(this);null!=b?(b=b.browser,this.resize(0,0,b.innerWidth,b.innerHeight)):svGlobal.logger.warn("XXX No browser for "+
a)};this.parent=function(){return B.getWinById(this.ownerWinid)};this.resize=function(a,c,d,g){x.send("8C1"+this.id+"\t"+a+"\t"+c+"\t"+d+"\t"+g)};this.checkBound=function(){var a=B.getOwnerSurface(this);if(null==a)svGlobal.logger.warn("no surface for checkBound");else{var a=a.browser,c=this.winWidth,d=this.winHeight,g=this.winOffsetX,e=this.winOffsetY;if(!(1>c||1>d))if(g>a.innerWidth||e>a.innerHeight)g>a.innerWidth&&(g=Math.floor(a.innerWidth/2)),e>a.innerHeight&&(e=Math.floor(a.innerHeight/2)),this.resize(g,
e,c,d)}};this.exeCommand=function(b){x.send("8C4"+a+"\t"+b)};this.activate=function(b){x.send("8C3"+a+"\t"+b)};this.close=function(){this.exeCommand(61536)}}function sc(a,b,c){x.send("8C1"+a.id+"\t0\t0\t"+b+"\t"+c);a.winWidth=b;a.winHeight=c}function $d(a,b,c){T||(T=!0);var d=0==(b&268435456);svGlobal.logger.info("\n\n================= winId="+c+" existed="+d);var g=d?B.getWinById(c):new ce(c);if(g){0!=(b&2)&&(g.ownerWinid=a.getLittleEndian32(),svGlobal.logger.info("***** ownerWinid="+g.ownerWinid));
0!=(b&8)&&(g.style=a.getLittleEndian32(),g.extStyle=a.getLittleEndian32(),svGlobal.logger.info("***** winId="+c+" style="+g.style+" extStyle="+g.extStyle),svGlobal.logger.info("*****--- WS_POPUP="+(0!=(g.style&2147483648))),svGlobal.logger.info("*****--- WS_DLGFRAME="+(0!=(g.style&4194304))),svGlobal.logger.info("*****--- DS_MODALFRAME="+(0!=(g.style&128))),svGlobal.logger.info("*****--- WS_EX_DLGMODALFRAME="+(0!=(g.extStyle&1))),svGlobal.logger.info("*****--- WS_EX_TOOLWINDOW="+(0!=(g.extStyle&128))),
svGlobal.logger.info("*****--- WS_BORDER="+(0!=(g.style&8388608))),svGlobal.logger.info("*****--- WS_CAPTION="+(0!=(g.style&12582912))),svGlobal.logger.info("*****--- WS_OVERLAPPED="+(0!=(g.style&0))),svGlobal.logger.info("*****--- WS_OVERLAPPEDWINDOW="+(0!=(g.style&13565952))),svGlobal.logger.info("*****--- WS_POPUPWINDOW="+(0!=(g.style&2156396544))),svGlobal.logger.info("*****--- WS_SIZEBOX="+(0!=(g.style&262144))),svGlobal.logger.info("*****--- WS_CHILD="+(0!=(g.style&1073741824))),svGlobal.logger.info("*****--- WS_EX_MDICHILD="+
(0!=(g.extStyle&64))),svGlobal.logger.info("*****--- WS_EX_LAYERED="+(0!=(g.extStyle&524288))));if(0!=(b&16)){g.showState=a.getByte();svGlobal.logger.info("***** winId="+c+" showState="+g.showState);var e=g.showState;if(3==e)g.fillBrowser();else switch(e){case 2:3==q.windowState&&setTimeout(function(){g.exeCommand(61728)},50);break;case 3:setTimeout(function(){g.fillBrowser()},50)}}0!=(b&4)&&(e=a.getLittleEndian16(),g.titleInfo=a.getUnicodeString(e,!1),svGlobal.logger.info("***** winId="+c+" title="+
g.titleInfo));0!=(b&16384)&&(g.clientOffsetX=a.getLittleEndian32(),g.clientOffsetY=a.getLittleEndian32(),svGlobal.logger.info("***** winId="+c+" coffX"+g.clientOffsetX+" coffY="+g.clientOffsetY));0!=(b&65536)&&(g.clientAreaWidth=a.getLittleEndian32(),g.clientAreaHeight=a.getLittleEndian32(),svGlobal.logger.info("***** winId="+c+" cw"+g.clientAreaWidth+" ch="+g.clientAreaHeight));0!=(b&131072)&&(g.rpContent=a.getLittleEndian32());0!=(b&262144)&&(g.rootParentHandle=a.getLittleEndian32());0!=(b&2048)&&
(g.winOffsetX=a.getLittleEndian32(),g.winOffsetY=a.getLittleEndian32(),svGlobal.logger.info("***** winId="+c+" offX"+g.winOffsetX+" offY="+g.winOffsetY));0!=(b&32768)&&(g.winClientDeltaX=a.getLittleEndian32(),g.winClientDeltaY=a.getLittleEndian32(),svGlobal.logger.info("***** winId="+c+" dX"+g.winClientDeltaX+" dY="+g.winClientDeltaY));0!=(b&1024)&&(g.winWidth=a.getLittleEndian32(),g.winHeight=a.getLittleEndian32(),svGlobal.logger.info("***** winId="+c+" w"+g.winWidth+" h="+g.winHeight));0!=(b&256)&&
(c=a.getLittleEndian16(),0<c&&a.skipPosition(8*c));0!=(b&4096)&&(g.visibleOffsetX=a.getLittleEndian32(),g.visibleOffsetY=a.getLittleEndian32());0!=(b&512)&&(b=a.getLittleEndian16(),g.numVisibilityRects=b,0<b&&a.skipPosition(8*b));d||B.addWin(g)}else svGlobal.logger.warn("XXX, No win with id:"+c)}function Ed(a,b,c){var d,g,e,i,n,j=0,k;d=b&7;i=((b&120)>>3)-2;b=(b&65408)>>7;0!=(b&2)&&a.skipPosition(8);0!=(b&1)?e=g=ua.readVar2Bytes(a):(g=ua.readVar2Bytes(a),e=ua.readVar2Bytes(a));j=ua.readVar4Bytes(a);
n=ua.readVar2Bytes(a);0!=(b&16)&&svGlobal.logger.warn("XXX: to do, not cache");k=Array(g*e*i);var f=Array(g*e);if(c){f=1==i?bd(g,e,j,a.getBytes(j)):cd(g,e,j,a.getBytes(j),i,p);if(null==f){svGlobal.logger.warn("Failed to decompress bitmap data");return}a=new dd(f,g,e,0,0,8*i)}else{j=a.getPosition();for(c=0;c<e;c++)f=j+(e-c-1)*g*i,a.copyToByteArray(k,c*g*i,f,g*i);a=new dd(Ub(k,i),g,e,0,0,8*i)}Dd(d,n,a,0);if(0!=(b&2))throw svGlobal.logger.warn("XXX:TODO, persistent"),"Persistent erro";}function y(a,
b,c){var d=0;c?(d=a.getByte(),127<d&&(d-=256),b+=d):b=a.getLittleEndian16();return b}function Gc(a){return a&15}function Ma(a){var b=0,c=0,b=c=a.getByte(),c=a.getByte(),b=b|c<<8,c=a.getByte();return b|c<<16}function Fd(a,b,c){0!=(c&1)&&(b.xOrigin=a.getByte());0!=(c&2)&&(b.yOrigin=a.getByte());0!=(c&4)&&(b.style=a.getByte());var d=b.pattern;0!=(c&8)&&(d[0]=a.getByte());if(0!=(c&16))for(c=1;8>c;c++)d[c]=a.getByte();b.pattern=d}function Cc(a){var b=0,c=0,d=0,g=0,e=0,i=0,n=0,j=0,k=0,f=0,l=0,m=0,g=0,q,
v,t,K;t=K=0;q=o;v=u;for(var b=a.getLittleEndian16(),x=0;x<b;x++){var c=a.getLittleEndian16(),d=a.getLittleEndian16(),g=a.getLittleEndian16(),e=a.getLittleEndian16(),i=a.getLittleEndian16(),n=a.getLittleEndian16(),f=a.getLittleEndian16(),z=Math.floor((f+7)/8),l=a.getLittleEndian16(),m=a.getLittleEndian16(),j=g-c+1,k=e-d+1;q>c&&(q=c);v>d&&(v=d);t<g&&(t=g);K<e&&(K=e);p!=f&&(svGlobal.logger.warn("Server limited colour depth to "+f+" bits"),Hb(f));if(0==l){e=i*z;f=n*e;g=Array(f);l=a.getPosition();for(m=
0;m<n;m++){for(var r=a.getData(),s=l,w=g,y=(n-m-1)*e,B=e,A=0;A<B;A++)w[y+A]=r[s+A];l+=e}a.skipPosition(f);n=void 0;n=0;z=Ub(g,z);D.setRGBs(c,d,j,k,z,n,i);D.postPaint(c,d,j,k)}else(0!=(l&1024)?g=m:(a.skipPosition(2),g=a.getLittleEndian16(),a.skipPosition(4)),g=a.getBytes(g),1==z)?(n=bd(i,n,g.length,g),g=void 0,g=0,z=Ub(n,z),D.setRGBs(c,d,j,k,z,g,i),D.postPaint(c,d,j,k)):(z=cd(i,n,g.length,g,z,p),1>j||1>k||(D.setRGBs(c,d,j,k,z,0,i),D.postPaint(c,d,j,k)))}D.commitPaint()}function Cd(){M=0;F=o-1;L=0;
E=u-1}function Gd(a,b,c,d,g,e){g=pa(g);if(a==c||b==d){var i,n,j;if(b==d){if(b>=L&&b<=E)if(c>a){if(a<M&&(a=M),c>F&&(c=F),i=b*o+a,j=c-a,!(1>j)){for(n=0;n<j;n++)Ua(e,D,a+n,b,g),i++;D.repaint(a,b,j+1,1)}}else if(c<M&&(c=M),a>F&&(a=F),i=b*o+a,j=a-c,!(1>j)){for(n=0;n<j;n++)Ua(e,D,c+n,b,g),i--;D.repaint(c,b,j+1,1)}}else if(a>=M&&a<=F)if(d>b){if(b<L&&(b=L),d>E&&(d=E),i=b*o+a,j=d-b,!(1>j)){for(n=0;n<j;n++)Ua(e,D,a,b+n,g),i+=o;D.repaint(a,b,1,j+1)}}else if(d<L&&(d=L),b>E&&(b=E),i=b*o+a,j=b-d,!(1>j)){for(n=
0;n<j;n++)Ua(e,D,a,d+n,g),i-=o;D.repaint(a,d,1,j+1)}}else{var k=Math.abs(c-a),f=Math.abs(d-b);i=a;n=b;var l,m,p,q,v,t;l=c>=a?j=1:j=-1;p=d>=b?m=1:m=-1;k>=f?(p=j=0,v=k,q=k/2,t=f):(m=l=0,v=f,q=f/2,t=k,k=f);if(!(1>k)){for(f=0;f<=k;f++)i<M||i>F||n<L||n>E||Ua(e,D,i,n,g),q+=t,q>=v&&(q-=v,i+=j,n+=m),i+=l,n+=p;e=a<c?a:c;g=a>c?a:c;c=b<d?b:d;d=b>d?b:d;0>g-e||0>d-c||D.repaint(e,c,g-e+1,d-c+1)}}}function Ld(a,b,c,d,g,e,i,n){var j=0,k=128,j=Math.floor((d-1)/8)+1,f,l,n=pa(n),i=pa(i);if(!(b>F||c>E))if(f=b+d-1,f>
F&&(f=F),d=b<M?M:b,f=f-b+1,l=c+g-1,l>E&&(l=E),g=c<L?L:c,l=l-c+1,!(1>f||1>l))if(j*=g-c,0==a)for(a=0;a<l;a++){for(var m=0;m<f;m++)0==k&&(j++,k=128),b+m>=d&&c+a>=g&&0<=b+m&&0<=c+a&&0!=(e[j]&k)&&D.setRGB(b+m,c+a,n),k>>=1;j++;k=128;j==e.length&&(j=0)}else for(a=0;a<l;a++){for(m=0;m<f;m++)0==k&&(j++,k=128),b+m>=d&&c+a>=g&&0<=b+m&&0<=c+a&&(0!=(e[j]&k)?D.setRGB(b+m,c+a,n):D.setRGB(b+m,c+a,i)),k>>=1;j++;k=128;j==e.length&&(j=0)}}function Hd(a,b){var c=a[b[0]++]&255,d=c&128,c=0!=(c&64)?c|-64:c&63;0!=d&&(c=
c<<8|a[b[0]++]&255);return c}function md(a,b,c,d,g,e){if(!(a>F||b>E))if(c=a+c-1,c>F&&(c=F),a<M&&(a=M),c=c-a+1,d=b+d-1,d>E&&(d=E),b<L&&(b=L),d=d-b+1,!(1>c||1>d))if(D.fillRect(a,b,c,d,pa(g)),e)if(4E4<c*d){var e=Ha,i=Array(4);gc(g,p,i,0);e.fillStyle="rgba("+i[0]+","+i[1]+","+i[2]+","+i[3]+")";Ha.fillRect(a,b,c,d)}else D.postPaint(a,b,c,d)}function tc(){null!=x&&O&&(x.send("85"),x.close())}function be(a,b){this.size=a;this.data=b}function ae(a,b,c,d,g,e,i){this.font=a;this.character=b;this.offset=c;this.baseLine=
d;this.width=g;this.height=e;this.fontData=i}function Va(a,b,c,d,g,e,i){for(var n=g*c+d,j=a.setRGB,k=a.getRGB,f=0;f<i;f++){for(var l=0;l<e;l++){if(null!=a){var m=k(d+l,g+f);j(d+l,g+f,~m&J)}else b[n]=~b[n]&J;n++}n+=c-e}}function lc(a,b,c,d,g,e,i,n,j,k,f){if(!(0>e|0>i|0>c|0>j))switch(a){case 0:n=b.setRGB;for(j=d;j<d+e;j++)for(b=g;b<g+i;b++)n(j,b,0);break;case 1:a=f*j+k;c=b.setRGB;for(k=0;k<i;k++){for(f=0;f<e;f++)c(d+e,g+i,~(b.getRGB(d+e,g+i)|n[a])&J);a+=j-e}break;case 2:a=f*j+k;c=b.setRGB;b=b.getRGB;
for(k=0;k<i;k++){for(f=0;f<e;f++){var l=b(d+e,g+i);c(d+e,g+i,l&~n[a]&J);a++}a+=j-e}break;case 3:Va(b,n,j,k,f,e,i);null==n?b.copyArea(k,f,e,i,d-k,g-f):b.setRGBs(d,g,e,i,n,f*j+k,j);break;case 4:Va(b,null,c,d,g,e,i);Tc(b,c,d,g,e,i,n,j,k,f);break;case 5:Va(b,null,c,d,g,e,i);break;case 6:a=f*j+k;c=b.setRGB;b=b.getRGB;for(k=0;k<i;k++){for(f=0;f<e;f++)l=b(d+f,g+k),c(d+f,g+k,l^n[a]&J),a++;a+=j-e}break;case 7:a=f*j+k;c=b.setRGB;b=b.getRGB;for(k=0;k<i;k++){for(f=0;f<e;f++)l=b(d+f,g+k),c(d+f,g+k,~(l&n[a])&J),
a++;a+=j-e}break;case 8:Tc(b,c,d,g,e,i,n,j,k,f);break;case 9:a=f*j+k;c=b.setRGB;b=b.getRGB;for(k=0;k<i;k++){for(f=0;f<e;f++)l=b(d+f,g+k),c(d+f,g+k,l^~n[a]&J),a++;a+=j-e}break;case 10:break;case 11:a=f*j+k;c=b.setRGB;b=b.getRGB;for(k=0;k<i;k++){for(f=0;f<e;f++)l=b(d+f,g+k),c(d+f,g+k,l|~n[a]&J),a++;a+=j-e}break;case 12:null==n?b.copyArea(k,f,e,i,d-k,g-f):b.setRGBs(d,g,e,i,n,f*j+k,j);break;case 13:Va(b,null,c,d,g,e,i);uc(b,c,d,g,e,i,n,j,k,f);break;case 14:uc(b,c,d,g,e,i,n,j,k,f);break;case 15:n=b.setRGB;
for(j=d;j<d+e;j++)for(b=g;b<g+i;b++)n(j,b,J);break;default:svGlobal.logger.warn("unsupported opcode: "+a)}}function Ua(a,b,c,d,g){if(null!=b){var e=b.getRGB(c,d);switch(a){case 0:b.setRGB(c,d,0);break;case 1:b.setRGB(c,d,~(e|g)&J);break;case 2:b.setRGB(c,d,e&~g&J);break;case 3:b.setRGB(c,d,~g&J);break;case 4:b.setRGB(c,d,(~e&g)*J);break;case 5:b.setRGB(c,d,~e&J);break;case 6:b.setRGB(c,d,e^g&J);break;case 7:b.setRGB(c,d,~e&g&J);break;case 8:b.setRGB(c,d,e&g&J);break;case 9:b.setRGB(c,d,e^~g&J);break;
case 10:break;case 11:b.setRGB(c,d,e|~g&J);break;case 12:b.setRGB(c,d,g);break;case 13:b.setRGB(c,d,(~e|g)&J);break;case 14:b.setRGB(c,d,e|g&J);break;case 15:b.setRGB(c,d,J);break;default:svGlobal.logger.warn("unsupported pixel opcode: "+a),b.setRGB(c,d,g)}}}function Tc(a,b,c,d,g,e,i,n,j,k){b=k*n+j;j=a.setRGB;a=a.getRGB;for(k=0;k<e;k++){for(var f=0;f<g;f++){var l=a(c+f,d+k);j(c+f,d+k,l&i[b]&J);b++}b+=n-g}}function uc(a,b,c,d,g,e,i,n,j,k){b=k*n+j;j=a.setRGB;a=a.getRGB;for(k=0;k<e;k++){for(var f=0;f<
g;f++){var l=a(c+f,d+k);j(c+f,d+k,l|i[b]&J);b++}b+=n-g}}function Dd(a,b,c){"undefined"==typeof mb[a]&&(mb[a]=[]);mb[a][b]=c}function Kd(a,b){if(12>a&&256>b){var c=yc[a][b];if(null!=c)return c}return null}function Fc(a){return 20>a&&(a=Jb[a],null!=a)?a:null}function dd(a,b,c,d,g,e){this.byteArray=a;this.left=d;this.top=g;this.width=b;this.height=c;this.bitsperpixel=e;this.bytesperpixel=Math.floor((e+7)/8)}function gc(a,b,c,d){switch(b){case 16:var b=a>>8&248,g=a>>3&252,a=a<<3&255;c[d]=b|b>>5;c[d+1]=
g|g>>6;c[d+2]=a|a>>5;c[d+3]=255;break;case 15:b=a>>7&248;g=a>>2&248;a=a<<3&255;c[d]=b|b>>5;c[d+1]=g|g>>5;c[d+2]=a|a>>5;c[d+3]=255;break;case 8:c[d]=ja[0][a];c[d+1]=ja[1][a];c[d+2]=ja[2][a];c[d+3]=255;break;case 32:c[d]=a&255,c[d+1]=a>>8&255,c[d+2]=a>>16&255,c[d+3]=a>>24&255;default:c[d]=a&255,c[d+1]=a>>8&255,c[d+2]=a>>16&255,c[d+3]=255}}function lb(a,b,c){for(var d=0,c=c-1;0<=c;c--)d<<=8,d|=a[b+c]&255;return d}function Wa(a,b){var c=a[b]&255,d=(a[b+1]&255)<<8|c,g=d>>7&248,d=d>>2&248,c=c<<3&255;return(g|
g>>5)<<16|(d|d>>5)<<8|c|c>>5}function Uc(a,b,c){return a=0|a[b+c]&255}function Ub(a,b){var c=a.length/b>>0,d=Array(c),g=pa;switch(b){case 1:for(var e=0;e<c;e++)d[e]=g(a[e]&255);break;case 2:for(e=0;e<c;e++)d[e]=g((a[2*e+1]&255)<<8|a[2*e]&255);break;default:for(e=0;e<c;e++)d[e]=g((a[e*b+2]&255)<<16)|(a[e*b+1]&255)<<8|a[e*b]&255}return d}function cd(a,b,c,d,g,e){switch(e){case 16:return de(a,b,c,d);case 15:for(var g=b,e=b=-1,i=0,n=i+c,j=c=0,k=0,f=a,l=-1,m=0,o=j=0,p=0,q=k=0,v=4294967295,t=!1,u=!1,r=
!1,s=Array(a*g);i<n;){m=0;j=d[i++]&255;c=j>>4;switch(c){case 12:case 13:case 14:c-=6;j&=15;k=16;break;case 15:c=j&15;9>c?(j=d[i++]&255,j|=(d[i++]&255)<<8):j=11>c?8:1;k=0;break;default:c>>=1,j&=31,k=32}0!=k&&(r=2==c||7==c,0==j?j=r?(d[i++]&255)+1:(d[i++]&255)+k:r&&(j<<=3));switch(c){case 0:l==c&&!(f==a&&-1==b)&&(t=!0);break;case 8:o=Wa(d,i),i+=2;case 3:p=Wa(d,i);i+=2;break;case 6:case 7:v=Wa(d,i);i+=2;c-=5;break;case 9:q=3;c=2;m=3;break;case 10:q=5,c=2,m=5}l=c;for(k=0;0<j;){if(f>=a){if(0>=g)throw"Decompressing bitmap failed! Height = "+
g;f=0;g--;b=e;e=0+g*a}switch(c){case 0:t&&(s[e+f]=-1==b?v:s[b+f]^v,t=!1,j--,f++);if(-1==b){for(;0!=(j&-8)&&f+8<a;)for(r=0;8>r;r++)s[e+f]=0,j--,f++;for(;0<j&&f<a;)s[e+f]=0,j--,f++}else{for(;0!=(j&-8)&&f+8<a;)for(r=0;8>r;r++)s[e+f]=s[b+f],j--,f++;for(;0<j&&f<a;)s[e+f]=s[b+f],j--,f++}break;case 1:if(-1==b){for(;0!=(j&-8)&&f+8<a;)for(r=0;8>r;r++)s[e+f]=v,j--,f++;for(;0<j&&f<a;)s[e+f]=v,j--,f++}else{for(;0!=(j&-8)&&f+8<a;)for(r=0;8>r;r++)s[e+f]=s[b+f]^v,j--,f++;for(;0<j&&f<a;)s[e+f]=s[b+f]^v,j--,f++}break;
case 2:if(-1==b){for(;0!=(j&-8)&&f+8<a;)for(r=0;8>r;r++)k<<=1,k&=255,0==k&&(q=0!=m?m&255:d[i++],k=1),s[e+f]=0!=(q&k)?v:0,j--,f++;for(;0<j&&f<a;)k<<=1,k&=255,0==k&&(q=0!=m?m&255:d[i++],k=1),s[e+f]=0!=(q&k)?v:0,j--,f++}else{for(;0!=(j&-8)&&f+8<a;)for(r=0;8>r;r++)k<<=1,k&=255,0==k&&(q=0!=m?m&255:d[i++],k=1),s[e+f]=0!=(q&k)?s[b+f]^v:s[b+f],j--,f++;for(;0<j&&f<a;)k<<=1,k&=255,0==k&&(q=0!=m?m&255:d[i++],k=1),s[e+f]=0!=(q&k)?s[b+f]^v:s[b+f],j--,f++}break;case 3:for(;0!=(j&-8)&&f+8<a;)for(r=0;8>r;r++)s[e+
f]=p,j--,f++;for(;0<j&&f<a;)s[e+f]=p,j--,f++;break;case 4:for(;0!=(j&-8)&&f+8<a;)for(r=0;8>r;r++)s[e+f]=Wa(d,i),i+=2,j--,f++;for(;0<j&&f<a;)s[e+f]=Wa(d,i),i+=2,j--,f++;break;case 8:for(;0!=(j&-8)&&f+8<a;)for(r=0;8>r;r++)u?(s[e+f]=p,u=!1):(s[e+f]=o,u=!0,j++),j--,f++;for(;0<j&&f<a;)u?(s[e+f]=p,u=!1):(s[e+f]=o,u=!0,j++),j--,f++;break;case 13:for(;0!=(j&-8)&&f+8<a;)for(r=0;8>r;r++)s[e+f]=16777215,j--,f++;for(;0<j&&f<a;)s[e+f]=16777215,j--,f++;break;case 14:for(;0!=(j&-8)&&f+8<a;)for(r=0;8>r;r++)s[e+f]=
0,j--,f++;for(;0<j&&f<a;)s[e+f]=0,j--,f++;break;default:throw"Unimplemented decompress opcode "+c;}}}return s;case 32:if(16!=d[0])throw"Wrong tag.";input=1;g=Array(4*a*b);e=Vb(d,input,a,b,g,3);input+=e;e=Vb(d,input,a,b,g,2);input+=e;e=Vb(d,input,a,b,g,1);input+=e;Vb(d,input,a,b,g,0);a=Math.floor(g.length/4);d=Array(a);for(e=b=0;e<a;e++)b=e<<2,d[e]=g[b+3]<<24|g[b+2]<<16|g[b+1]<<8|g[b+0]<<0;return d;default:for(var i=e=-1,n=0,c=n+c,r=k=f=0,l=a,m=-1,v=r=q=p=k=o=0,t=4294967295,w=s=u=!1,j=Array(a*b);n<
c;){o=0;k=d[n++]&255;f=k>>4;switch(f){case 12:case 13:case 14:f-=6;k&=15;r=16;break;case 15:f=k&15;9>f?(k=d[n++]&255,k|=(d[n++]&255)<<8):k=11>f?8:1;r=0;break;default:f>>=1,k&=31,r=32}0!=r&&(w=2==f||7==f,0==k?k=w?(d[n++]&255)+1:(d[n++]&255)+r:w&&(k<<=3));switch(f){case 0:m==f&&!(l==a&&-1==e)&&(u=!0);break;case 8:p=lb(d,n,g),n+=g;case 3:q=lb(d,n,g);n+=g;break;case 6:case 7:t=lb(d,n,g);n+=g;f-=5;break;case 9:v=3;f=2;o=3;break;case 10:v=5,f=2,o=5}m=f;for(r=0;0<k;){if(l>=a){if(0>=b)throw"Decompressing bitmap failed! Height = "+
b;l=0;b--;e=i;i=0+b*a}switch(f){case 0:u&&(j[i+l]=-1==e?t:j[e+l]^t,u=!1,k--,l++);if(-1==e){for(;0!=(k&-8)&&l+8<a;)for(w=0;8>w;w++)j[i+l]=0,k--,l++;for(;0<k&&l<a;)j[i+l]=0,k--,l++}else{for(;0!=(k&-8)&&l+8<a;)for(w=0;8>w;w++)j[i+l]=j[e+l],k--,l++;for(;0<k&&l<a;)j[i+l]=j[e+l],k--,l++}break;case 1:if(-1==e){for(;0!=(k&-8)&&l+8<a;)for(w=0;8>w;w++)j[i+l]=t,k--,l++;for(;0<k&&l<a;)j[i+l]=t,k--,l++}else{for(;0!=(k&-8)&&l+8<a;)for(w=0;8>w;w++)j[i+l]=j[e+l]^t,k--,l++;for(;0<k&&l<a;)j[i+l]=j[e+l]^t,k--,l++}break;
case 2:if(-1==e){for(;0!=(k&-8)&&l+8<a;)for(w=0;8>w;w++)r<<=1,r&=255,0==r&&(v=0!=o?o&255:d[n++],r=1),j[i+l]=0!=(v&r)?t:0,k--,l++;for(;0<k&&l<a;)r<<=1,r&=255,0==r&&(v=0!=o?o&255:d[n++],r=1),j[i+l]=0!=(v&r)?t:0,k--,l++}else{for(;0!=(k&-8)&&l+8<a;)for(w=0;8>w;w++)r<<=1,r&=255,0==r&&(v=0!=o?o&255:d[n++],r=1),j[i+l]=0!=(v&r)?j[e+l]^t:j[e+l],k--,l++;for(;0<k&&l<a;)r<<=1,r&=255,0==r&&(v=0!=o?o&255:d[n++],r=1),j[i+l]=0!=(v&r)?j[e+l]^t:j[e+l],k--,l++}break;case 3:for(;0!=(k&-8)&&l+8<a;)for(w=0;8>w;w++)j[i+
l]=q,k--,l++;for(;0<k&&l<a;)j[i+l]=q,k--,l++;break;case 4:for(;0!=(k&-8)&&l+8<a;)for(w=0;8>w;w++)j[i+l]=lb(d,n,g),n+=g,k--,l++;for(;0<k&&l<a;)j[i+l]=lb(d,n,g),n+=g,k--,l++;break;case 8:for(;0!=(k&-8)&&l+8<a;)for(w=0;8>w;w++)s?(j[i+l]=q,s=!1):(j[i+l]=p,s=!0,k++),k--,l++;for(;0<k&&l<a;)s?(j[i+l]=q,s=!1):(j[i+l]=p,s=!0,k++),k--,l++;break;case 13:for(;0!=(k&-8)&&l+8<a;)for(w=0;8>w;w++)j[i+l]=16777215,k--,l++;for(;0<k&&l<a;)j[i+l]=16777215,k--,l++;break;case 14:for(;0!=(k&-8)&&l+8<a;)for(w=0;8>w;w++)j[i+
l]=0,k--,l++;for(;0<k&&l<a;)j[i+l]=0,k--,l++;break;default:throw"Unimplemented decompress opcode "+f;}}}return j}}function Vb(a,b,c,d,g,e){var i,n,j,k,f,l,m,o,p=b,q=e;for(n=m=0;n<d;){e=q+4*c*d-4*(n+1)*c;f=0;o=e;i=0;if(0==m)for(;i<c;){j=a[b++]&255;k=j&15;j=j>>4&15;l=k<<4|j;47>=l&&16<=l&&(k=l,j=0);for(;0<j;)f=a[b++]&255,g[e]=f,e+=4,i++,j--;for(;0<k;)g[e]=f,e+=4,i++,k--}else for(;i<c;){j=a[b++]&255;k=j&15;j=j>>4&15;l=k<<4|j;47>=l&&16<=l&&(k=l,j=0);for(;0<j;)l=a[b++]&255,0!=(l&1)?(l>>=1,l+=1,f=-l):f=
l>>=1,l=g[m+4*i]+f,g[e]=l,e+=4,i++,j--;for(;0<k;)l=g[m+4*i]+f,g[e]=l,e+=4,i++,k--}n++;m=o}return b-p}function de(a,b,c,d){function g(a,b){var c=a[b]&255,d=(a[b+1]&255)<<8|c,e=d>>8&248,d=d>>3&252,c=c<<3&255;return(e|e>>5)<<16|(d|d>>6)<<8|c|c>>5}for(var e=-1,i=-1,n=0,c=n+c,j=0,k=0,f=0,l=a,m=-1,o=0,p=k=0,q=0,v=f=0,t=4294967295,u=!1,r=!1,s=!1,w=Array(a*b);n<c;){o=0;k=d[n++]&255;j=k>>4;switch(j){case 12:case 13:case 14:j-=6;k&=15;f=16;break;case 15:j=k&15;9>j?(k=d[n++]&255,k|=(d[n++]&255)<<8):k=11>j?8:
1;f=0;break;default:j>>=1,k&=31,f=32}0!=f&&(s=2==j||7==j,0==k?k=s?(d[n++]&255)+1:(d[n++]&255)+f:s&&(k<<=3));switch(j){case 0:m==j&&!(l==a&&-1==e)&&(u=!0);break;case 8:p=g(d,n),n+=2;case 3:q=g(d,n);n+=2;break;case 6:case 7:t=g(d,n);n+=2;j-=5;break;case 9:v=3;j=2;o=3;break;case 10:v=5,j=2,o=5}m=j;for(f=0;0<k;){if(l>=a){if(0>=b)throw"Decompressing bitmap failed! Height = "+b;l=0;b--;e=i;i=0+b*a}switch(j){case 0:u&&(w[i+l]=-1==e?t:w[e+l]^t,u=!1,k--,l++);if(-1==e){for(;0!=(k&-8)&&l+8<a;)for(s=0;8>s;s++)w[i+
l]=0,k--,l++;for(;0<k&&l<a;)w[i+l]=0,k--,l++}else{for(;0!=(k&-8)&&l+8<a;)for(s=0;8>s;s++)w[i+l]=w[e+l],k--,l++;for(;0<k&&l<a;)w[i+l]=w[e+l],k--,l++}break;case 1:if(-1==e){for(;0!=(k&-8)&&l+8<a;)for(s=0;8>s;s++)w[i+l]=t,k--,l++;for(;0<k&&l<a;)w[i+l]=t,k--,l++}else{for(;0!=(k&-8)&&l+8<a;)for(s=0;8>s;s++)w[i+l]=w[e+l]^t,k--,l++;for(;0<k&&l<a;)w[i+l]=w[e+l]^t,k--,l++}break;case 2:if(-1==e){for(;0!=(k&-8)&&l+8<a;)for(s=0;8>s;s++)f<<=1,f&=255,0==f&&(v=0!=o?o&255:d[n++]&255,f=1),w[i+l]=0!=(v&f)?t:0,k--,
l++;for(;0<k&&l<a;)f<<=1,f&=255,0==f&&(v=0!=o?o&255:d[n++]&255,f=1),w[i+l]=0!=(v&f)?t:0,k--,l++}else{for(;0!=(k&-8)&&l+8<a;)for(s=0;8>s;s++)f<<=1,f&=255,0==f&&(v=0!=o?o&255:d[n++]&255,f=1),w[i+l]=0!=(v&f)?w[e+l]^t:w[e+l],k--,l++;for(;0<k&&l<a;)f<<=1,f&=255,0==f&&(v=0!=o?o&255:d[n++]&255,f=1),w[i+l]=0!=(v&f)?w[e+l]^t:w[e+l],k--,l++}break;case 3:for(;0!=(k&-8)&&l+8<a;)for(s=0;8>s;s++)w[i+l]=q,k--,l++;for(;0<k&&l<a;)w[i+l]=q,k--,l++;break;case 4:for(;0!=(k&-8)&&l+8<a;)for(s=0;8>s;s++)w[i+l]=g(d,n),n+=
2,k--,l++;for(;0<k&&l<a;)w[i+l]=g(d,n),n+=2,k--,l++;break;case 8:for(;0!=(k&-8)&&l+8<a;)for(s=0;8>s;s++)r?(w[i+l]=q,r=!1):(w[i+l]=p,r=!0,k++),k--,l++;for(;0<k&&l<a;)r?(w[i+l]=q,r=!1):(w[i+l]=p,r=!0,k++),k--,l++;break;case 13:for(;0!=(k&-8)&&l+8<a;)for(s=0;8>s;s++)w[i+l]=16777215,k--,l++;for(;0<k&&l<a;)w[i+l]=16777215,k--,l++;break;case 14:for(;0!=(k&-8)&&l+8<a;)for(s=0;8>s;s++)w[i+l]=0,k--,l++;for(;0<k&&l<a;)w[i+l]=0,k--,l++;break;default:throw"Unimplemented decompress opcode "+j;}}}return w}function bd(a,
b,c,d){for(var g=-1,e=0,i=0,n=0,j=0,k=0,f=a,l=-1,m=0,o=j=0,p=0,q=k=0,v=4294967295,t=!1,u=!1,r=!1,s=Array(a*b);i<c;){m=0;j=d[i++]&255;n=j>>4;switch(n){case 12:case 13:case 14:n-=6;j&=15;k=16;break;case 15:n=j&15;9>n?(j=d[i++]&255,j|=(d[i++]&255)<<8):j=11>n?8:1;k=0;break;default:n>>=1,j&=31,k=32}0!=k&&(r=2==n||7==n,0==j?j=r?(d[i++]&255)+1:(d[i++]&255)+k:r&&(j<<=3));switch(n){case 0:l==n&&!(f==a&&-1==g)&&(t=!0);break;case 8:o=d[i++]&255;case 3:p=d[i++]&255;break;case 6:case 7:v=d[i++];n-=5;break;case 9:q=
3;n=2;m=3;break;case 10:q=5,n=2,m=5}l=n;for(k=0;0<j;){if(f>=a){if(0>=b)throw"Decompressing bitmap failed! Height = "+b;f=0;b--;g=e;e=0+b*a}switch(n){case 0:t&&(s[e+f]=-1==g?v&255:(s[g+f]^v&255)&255,t=!1,j--,f++);if(-1==g){for(;0!=(j&-8)&&f+8<a;)for(r=0;8>r;r++)s[e+f]=0,j--,f++;for(;0<j&&f<a;)s[e+f]=0,j--,f++}else{for(;0!=(j&-8)&&f+8<a;)for(r=0;8>r;r++)s[e+f]=s[g+f],j--,f++;for(;0<j&&f<a;)s[e+f]=s[g+f],j--,f++}break;case 1:if(-1==g){for(;0!=(j&-8)&&f+8<a;)for(r=0;8>r;r++)s[e+f]=v&255,j--,f++;for(;0<
j&&f<a;)s[e+f]=v&255,j--,f++}else{for(;0!=(j&-8)&&f+8<a;)for(r=0;8>r;r++){var w=Uc(s,g,f)^v;s[e+f]=w&255;j--;f++}for(;0<j&&f<a;)r=Uc(s,g,f)^v,s[e+f]=r&255,j--,f++}break;case 2:if(-1==g){for(;0!=(j&-8)&&f+8<a;)for(r=0;8>r;r++)k<<=1,k&=255,0==k&&(q=0!=m?m&255:d[i++],k=1),s[e+f]=0!=(q&k)?v&255:0,j--,f++;for(;0<j&&f<a;)k<<=1,k&=255,0==k&&(q=0!=m?m&255:d[i++],k=1),s[e+f]=0!=(q&k)?v&255:0,j--,f++}else{for(;0!=(j&-8)&&f+8<a;)for(r=0;8>r;r++)k<<=1,k&=255,0==k&&(q=0!=m?m&255:d[i++],k=1),s[e+f]=0!=(q&k)?(s[g+
f]^v&255)&255:s[g+f],j--,f++;for(;0<j&&f<a;)k<<=1,k&=255,0==k&&(q=0!=m?m&255:d[i++],k=1),s[e+f]=0!=(q&k)?(s[g+f]^v&255)&255:s[g+f],j--,f++}break;case 3:for(;0!=(j&-8)&&f+8<a;)for(r=0;8>r;r++)s[e+f]=p&255,j--,f++;for(;0<j&&f<a;)s[e+f]=p&255,j--,f++;break;case 4:for(;0!=(j&-8)&&f+8<a;)for(r=0;8>r;r++)s[e+f]=d[i++],j--,f++;for(;0<j&&f<a;)s[e+f]=d[i++],j--,f++;break;case 8:for(;0!=(j&-8)&&f+8<a;)for(r=0;8>r;r++)u?(s[e+f]=p&255,u=!1):(s[e+f]=o&255,u=!0,j++),j--,f++;for(;0<j&&f<a;)u?(s[e+f]=p&255,u=!1):
(s[e+f]=o&255,u=!0,j++),j--,f++;break;case 13:for(;0!=(j&-8)&&f+8<a;)for(r=0;8>r;r++)s[e+f]=255,j--,f++;for(;0<j&&f<a;)s[e+f]=255,j--,f++;break;case 14:for(;0!=(j&-8)&&f+8<a;)for(r=0;8>r;r++)s[e+f]=0,j--,f++;for(;0<j&&f<a;)s[e+f]=0,j--,f++;break;default:throw"Unimplemented decompress opcode "+n;}}}return s}function wc(){this.orderType=1;this.bounds=new BoundsOrder;this.destBlt=new DestBltOrder;this.patBlt=new PatBltOrder;this.screenBlt=new ScreenBltOrder;this.line=new LineOrder;this.rectangle=new RectangleOrder;
this.deskSave=new DeskSaveOrder;this.memBlt=new MemBltOrder;this.triBlt=new TriBltOrder;this.polyLine=new PolyLineOrder;this.text2=new Text2Order}this.displayMsg=this.reconnectOnResize=!0;this.sessionTimeout=3E5;this.appTimeout=800;this.reconnectTimes=0;this.windowState=3;this.setTitle=this.notification=this.openLink=!0;this.audioBuffer=2;this.sessionInfo={};this.mode=0;var ha=null,q=this,Ha=null,za=null,vc="object"==typeof m?m:null,Za="object"==typeof m||0<m.indexOf("/PLAY?");Za?(this.mode=1,vc?
m="":(o=screen.width,u=screen.height),m+="&touchpad=on",this.reconnectOnResize=!1):0<m.indexOf("/JOIN?")&&(this.mode=2,this.reconnectOnResize=!1);o||(o=window.innerWidth,u=window.innerHeight);var ca=hi5.tool.queryToObj(m.substring(m.indexOf("?")+1)),Aa=null;if(hi5.appcfg){var N=hi5.appcfg;"undefined"!==typeof N.displayMsg&&(this.displayMsg=N.displayMsg);"undefined"!==typeof N.sessionTimeout&&(this.sessionTimeout=N.sessionTimeout);"undefined"!==typeof N.appTimeout&&(this.appTimeout=N.appTimeout);"undefined"!==
typeof N.reconnectOnResize&&(this.reconnectOnResize=N.reconnectOnResize);"undefined"!==typeof N.reconnectTimes&&(this.reconnectTimes=N.reconnectTimes);"undefined"!==typeof N.windowState&&(this.windowState=N.windowState);"undefined"!==typeof N.openLink&&(this.openLink=N.openLink);"undefined"!==typeof N.notification&&(this.notification=N.notification);"undefined"!==typeof N.setTitle&&(this.setTitle=N.setTitle);"undefined"!=typeof N.audioBuffer&&(this.audioBuffer=N.audioBuffer);"boolean"==typeof N.useWSS&&
(m=(hi5.appcfg.useWSS?"wss":"ws")+m.substring(m.indexOf("://")))}ca.vmid&&(this.reconnectOnResize=!1);this.displayMsg||(this.notification=!1);var o=parseInt(o),u=parseInt(u),p=p?parseInt(p):16,Y={table:"A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z,a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,0,1,2,3,4,5,6,7,8,9,+,/".split(","),pad:"=",enc:function(a,b){var c="",d=this.table,g=this.pad,e;if(!b)b=a.length;var i=b-1;for(e=0;e<i;e=e+3){c=c+d[a[e]>>2];c=c+d[((a[e]&3)<<4)+(a[e+1]>>4)];c=c+
d[((a[e+1]&15)<<2)+(a[e+2]>>6)];c=c+d[a[e+2]&63]}if(b%3){e=b-b%3;c=c+d[a[e]>>2];if(b%3===2){c=c+d[((a[e]&3)<<4)+(a[e+1]>>4)];c=c+d[(a[e+1]&15)<<2];c=c+g}else{c=c+d[(a[e]&3)<<4];c=c+(g+g)}}return c},binaries:[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,62,-1,-1,-1,63,52,53,54,55,56,57,58,59,60,61,-1,-1,-1,0,-1,-1,-1,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,-1,-1,-1,-1,-1,-1,26,27,28,29,30,
31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,-1,-1,-1,-1,-1],dec:function(a,b){var c=this.binaries,d=this.pad,g,e,i,m,j,k=0,f=0;g=a.indexOf("=")-b;var l=a.length;g<0&&(g=l-b);g=Array((g>>2)*3+Math.floor(g%4/1.5));e=0;for(i=b;i<l;i++){m=c[a.charCodeAt(i)&127];j=a.charAt(i)===d;if(m===-1)svGlobal.log>0&&console.error("Illegal character '"+a.charCodeAt(i)+"'");else{f=f<<6|m;k=k+6;if(k>=8){k=k-8;j||(g[e++]=f>>k&255);f=f&(1<<k)-1}}}if(k)throw"Invalid base64 encoding";return g}},Ya={historyoff:0,
history:Array(65536),currOff:0,currLen:0,reset:function(){this.historyoff=0;this.history=Array(65536);this.currLen=this.currOff=0},getData:function(){var a=new RdpBuffer(this.history,this.currOff,this.currLen);a.markEnd(this.currOff+this.currLen);return a},dec:function(a,b,c,d){var g,e=0,i=0,m,j,k,f,l=(d&1)!=0,o=this.history;if((d&32)==0){this.currOff=0;this.currLen=c;return 0}if((d&64)!=0)this.historyoff=0;if((d&128)!=0){for(d=65536;--d>=0;)o[d]=0;this.historyoff=0}this.currLen=this.currOff=0;this.currOff=
k=m=d=this.historyoff;if(c==0)return 0;c=c+i;do{if(e==0){if(i>=c)break;d=(a[b+i++]&255)<<24;e=8}if(d>=0){if(e<8){if(i>=c){if(d!=0)return-1;break}d=d|(a[b+i++]&255)<<24-e;e=e+8}if(m>=65536)return-1;o[m++]=d>>>24&255;d=d<<8;e=e-8}else{d=d<<1;if(--e==0){if(i>=c)return-1;d=(a[b+i++]&255)<<24;e=8}if(d>=0){if(e<8){if(i>=c)return-1;d=d|(a[b+i++]&255)<<24-e;e=e+8}if(m>=65536)return-1;o[m++]=(d>>>24|128)&255;d=d<<8;e=e-8}else{d=d<<1;if(--e<(l?3:2)){if(i>=c)return-1;d=d|(a[b+i++]&255)<<24-e;e=e+8}if(l)switch(d>>>
29){case 7:for(;e<9;e=e+8){if(i>=c)return-1;d=d|(a[b+i++]&255)<<24-e}d=d<<3;g=d>>>26;d=d<<6;e=e-9;break;case 6:for(;e<11;e=e+8){if(i>=c)return-1;d=d|(a[b+i++]&255)<<24-e}d=d<<3;g=(d>>>24)+64;d=d<<8;e=e-11;break;case 5:case 4:for(;e<13;e=e+8){if(i>=c)return-1;d=d|(a[b+i++]&255)<<24-e}d=d<<2;g=(d>>>21)+320;d=d<<11;e=e-13;break;default:for(;e<17;e=e+8){if(i>=c)return-1;d=d|(a[b+i++]&255)<<24-e}d=d<<1;g=(d>>>16)+2368;d=d<<16;e=e-17}else switch(d>>>30){case 3:if(e<8){if(i>=c)return-1;d=d|(a[b+i++]&255)<<
24-e;e=e+8}d=d<<2;g=d>>>26;d=d<<6;e=e-8;break;case 2:for(;e<10;e=e+8){if(i>=c)return-1;d=d|(a[b+i++]&255)<<24-e}d=d<<2;g=(d>>>24)+64;d=d<<8;e=e-10;break;default:for(;e<14;e=e+8){if(i>=c)return-1;d=d|(a[b+i++]&255)<<24-e}g=(d>>>18)+320;d=d<<14;e=e-14}if(e==0){if(i>=c)return-1;d=(a[b+i++]&255)<<24;e=8}if(d>=0){j=3;d=d<<1;e--}else{f=l?14:11;do{d=d<<1;if(--e==0){if(i>=c)return-1;d=(a[b+i++]&255)<<24;e=8}if(d>=0)break;if(--f==0)return-1}while(1);j=(l?16:13)-f;d=d<<1;if(--e<j)for(;e<j;e=e+8){if(i>=c)return-1;
d=d|(a[b+i++]&255)<<24-e}f=j;j=d>>>32-f&~(-1<<f)|1<<f;d=d<<f;e=e-f}if(m+j>=65536)return-1;g=m-g&(l?65535:8191);do o[m++]=o[g++];while(--j!=0)}}}while(1);this.historyoff=m;this.currOff=k;this.currLen=m-k;return 0}},Yd=0<m.indexOf("nocurosr=on"),T=0<m.indexOf("startProgram=app"),ec=0<m.indexOf("mapDisk=on"),da=null;this.server=ca.server;this.port=parseInt(ca.port);T&&(this.reconnectOnResize=!1);hi5.browser.isTouch&&Math.max(o,u)>Math.max(window.innerWidth,window.innerHeight)&&(this.reconnectOnResize=
!1);this.isRemoteApp=function(){return T};if(T)if(hi5.browser.isTouch){var ee=Math.max(window.innerWidth,window.innerHeight),fe=Math.max(o,u),Fb=Math.max(ee,fe);o<Fb&&(o=Fb);u<Fb&&(u=Fb)}else o=screen.width,u=screen.height,0==q.windowState&&(u-=window.outerHeight-window.innerHeight+25);else o&=-4,u&=-4;var x=null,va=null,O=!1,Ja=!1,D=null,$=new function(a){var b=null;this.available=false;this.delay=a;if(hi5.browser.isTouch)this.available=false;else if("webkitAudioContext"in window){b=new webkitAudioContext;
this.available=true}else if("AudioContext"in window){b=new AudioContext;this.available=true}else if(hi5.browser.isFirefox){this.available=true;return}if(this.available){this.getBuffer=function(a){try{return b.createBuffer(2,a,z)}catch(c){svGlobal.logger.warn(c);svGlobal.logger.warn("size:"+a+" samples:"+z)}};var c=0;this.playBuffer=function(d){var g=b.createBufferSource();g.buffer=d;g.connect(b.destination);var e=b.currentTime,i=c>0?c:e+a;i<e&&(i=e+a);c=i+d.duration;g.noteOn(i);return c-e}}}(q.audioBuffer);
this.setAudioBuffer=function(a){q.audioBuffer=a;$.delay=a;if(ya)ya.delay=a};for(var ya=null,yc=Array(12),Gb=0;12>Gb;Gb++)yc[Gb]=Array(256);var Zb=Array(256),M=0,L=0,F=o-1,E=u-1,ja=null,wa=null,ob,ad=0;window.rdpConnection=this;var pa=Xb;Hb(p);this.running=function(){return O};this.hide=function(){B&&B.hide()};var xa=new function(){this.ws=null;this.clipRequired=this.prePaste=false;this.send=function(a){O&&this.ws.send(a)};var a=null;this.getAppInfo=function(){return ob};this.onresize=function(b){var c=
b.target.innerWidth,d=b.target.innerHeight;if(T){if(b.target.svSurface){b=b.target.svSurface.railWin.getMain(B.zOrders);b!=null&&sc(b,c,d)}}else if(!hi5.browser.isTouch&&!hi5.browser.isOpera&&q.reconnectOnResize&&O){if(a){clearTimeout(a);a=null}a=setTimeout(function(){if(!(Math.abs(c-o)<4&&Math.abs(d-u)<4)){svGlobal.logger.warn("w:"+c+" ww:"+o+" h:"+d+" hh:"+u);nb(c,d)}},1E3)}};this.onorientationchange=function(a){if(q.reconnectOnResize)nb(window.innerWidth,window.innerHeight);else if(T&&a.target.svSurface){var c=
a.target.svSurface.railWin.getMain(B.zOrders);c!=null&&sc(c,a.target.innerWidth,a.target.innerHeight)}};this.getClipData=Od;this.setDataFromClip=function(a){va=a;if(this.prePaste&&this.clipRequired){x.send("881"+a);va="";this.clipRequired=false}this.prePaste=false};this.onfocus=function(a){if(T&&a.target.svSurface.railWin){var c=a.target.svSurface.railWin.getTopWin(B.zOrders);if(c&&x){c.activate(1);svGlobal.logger.info("Activate win:"+c.id);Ha=a.target.svSurface.context}}};this.fileCallback=[];this.getShareFiles=
function(a,c){if(Ja){this.ws.send("3A5"+a);this.fileCallback.push(c)}};this.notifyFiles=function(a){for(var c=this.fileCallback,d=0,g=c.length;d<g;d++)c[d](a)};this.getFile=function(a){q.reconnectOnResize=false;window.open(Ia()+"/DOWNLOAD?s="+wa+"&f="+a)};this.getFileLink=function(a){return Ia()+"/DOWNLOAD?s="+wa+"&f="+a};this.getGateway=function(){return m}},B=function(){var a=[];a.addSurface=function(b){b.railWin=new Pd;a.push(b)};a.setSize=function(b,c,d){for(var g=0,e=a.length;g<e;g++)a[g].setSize(b,
c,d)};a.zOrders=[];a.drawLicense=function(b){for(var c=0,d=a.length;c<d;c++)a[c].drawLicense(b)};a.removeEvents=function(){for(var b=0,c=a.length;b<c;b++)a[b]&&a[b].removeEvents()};a.setReadOnly=function(b){for(var c=0,d=a.length;c<d;c++)a[c].setReadOnly(b)};a.setVisible=function(){svGlobal.logger.info("TODO: setVisible")};a.copyToClip=function(b){a.length<1||a[0].copyToClip(b)};a.setCursor=function(b){T||a[0].setCursor(b);var c=a.getFocused();c!=null&&c.setCursor(b)};a.hide=function(){if(T)for(var b=
0,c=a.length;b<c;b++)a[b].browser.close();else a[0].hide()};a.execute=function(b,c){for(var d=0,g=a.length;d<g;d++)a[d][b].apply(a[d],c)};a.addWin=function(b){function c(){var a=b.ownerWinid<1;if(!a)return a;if(b.showState===0)return false;var c=b.style;if((c&4194304)!=0)return true;var d=(b.extStyle&128)!=0;(a=a&&!d)&&(c&2147483648)!=0&&(c&2156396544)==0&&(a=false);svGlobal.logger.info("*** win id="+b.id+" isMain="+a);return a}var d=a.getFocused();if(!d){svGlobal.logger.warn("Focusd surface not found!");
d=a[a.length-1]}if(d){d.railWin.addWin(b);if(q.windowState>0)if(c()){if("titleInfo"in b&&q.setTitle)d.browser.document.title=b.titleInfo+" - "+q.server;b.fillBrowser();b.activate(1)}else b.checkBound()}else svGlobal.logger.warn("No surface available!")};a.delWin=function(b){for(var c,d=a.length-1;d>=0;d--){c=a[d].railWin;if(c.delWin(b)>=0)if(c.isRunning()){if(q.windowState>0){var g=c.getMain(a.zOrders);g&&g.fillBrowser();(g=c.getTopWin(a.zOrders))&&g.activate(1)}}else{var e=a[d],g=q.appTimeout;c.isNew()&&
(g=g*10);setTimeout(function(){e.railWin.isRunning()||a.delSurface(e)},g)}}};a.getWinById=function(b){for(var c,d=0,g=a.length;d<g;d++)if(c=a[d].railWin.getWinById(b))return c;return null};a.delSurface=function(b){if(!b.railWin.isRunning()){svGlobal.logger.info("delete surface...");a.removeElm(b);b.close()}};a.getOwnerSurface=function(b){for(var c=0,d=a.length;c<d;c++)if(a[c].railWin.hasWin(b))return a[c];return null};a.getFocused=function(){if(!T)return a[0];for(var b=a.length,c=0;c<b;c++)if(a[c].focused)return a[c];
return a[b-1]};a.close=function(){for(var b=0,c=a.length;b<c;b++)a[b]&&a[b].close()};return a}();this.getSurfaces=function(){return B};this.exeAppCmd=function(a){var b=B.getFocused();b&&b.exeCommand(a)};this.setJoinMode=function(a){O&&x.send("8E1"+a)};this.addSurface=function(a){Ha=a.context;if(!(B.indexOf(a)!=-1&&a.railWin)){Za&&a.setPlayerMode();a.setAutoScale(q.mode>0);a.setSize(o,u,T?"hidden":null);a.setController(xa);a.setFastCopy(ca.fastCopy=="on");a.setTouchpad(ca.touchpad=="on");a.setClipboard(ca.mapClipboard==
"on");if(ec){a.setFileHandler($b);da==null&&(da=new zc(new ac))}a.run(m.indexOf("keyboard=99999")>0);B.addSurface(a)}};this.getRunninApps=function(){for(var a=[],b=0,c=B.length;b<c;b++)B[b].railWin.getMain(B.zOrders)!=null&&a.push(B[b].railWin.getMain(B.zOrders).titleInfo);return a};this.startApp=function(a,b,c){x.send("8C2"+a+"\t"+b+"\t"+c);var d=B[B.length-1];if(d)d.remoteApp={exe:a,args:b,dir:c}};this.VirtualChannel=function(){this.send=function(a){a=a.getData();x.send("8F"+Y.enc(a,a.length))}};
this.addChannel=function(a){a.rdp=q;ha=a};this.run=function(){hi5.browser.isTouch?setTimeout(__run,80):__run()};__run=function(){if(!O){Ja=false;if(vc)x=vc;else{var a=m+"&width="+o+"&height="+u+"&server_bpp="+p+"&audio="+$.available+Wc();m.indexOf("waWidth")<0&&(a=a+(T?"&waWidth="+o+"&waHeight="+u:""));var b=new Date,a=a+("&tzOffset="+b.getTimezoneOffset()+"&time="+b.getTime());(b=hi5.browser.binaryWS(a.substring(0,a.indexOf("/",6))))&&(a=a+"&binary=on");if(ha){a=a+("&channelName="+ha.name);ha.flags&&
(a=a+("&channelFlags="+ha.flags))}var c=window.opener;if(c){var d=null;try{d=c.__sparkUser}catch(g){}if(d){c=d.account;d=d.session;c&&(a=a+("&account="+c));d&&(a=a+("&session="+d))}}a=a+("&isTouch="+(hi5.browser.isTouch&&(window.innerWidth>=1024||window.innerHeight>=768)));x=new hi5.WebSocket(a);if(b)x.binaryType="arraybuffer"}xa.ws=x;D=Ka(o,u);svGlobal.logger.info(m);x.onopen=Rd;x.onmessage=Sd;x.onclose=function(a){svGlobal.logger.warn("closed, code="+a.code+" reason="+a.reason);O||Yb("connection");
if(q.reconnectTimes){q.reconnectTimes--;O=true;nb(window.innerWidth,window.innerHeight)}else{O=false;try{B&&B.close()}catch(b){}window&&delete window.rdpConnection;if(q&&q.onclose)q.onclose()}};x.onerror=Qd;a=B[B.length-1];if(T){if(a)a.remoteApp={exe:ca.exe,args:ca.args,dir:""}}else if(q.setTitle)a.browser.document.title=q.server}};this.getDesktop=function(){return D};this.mouseDown=function(a,b,c){O&&x.send("80"+a+"\t"+b+"\t"+c)};this.mouseMove=function(a,b){O&&x.send("82"+a+"\t"+b)};this.mouseUp=
function(a,b,c){O&&x.send("81"+a+"\t"+b+"\t"+c)};this.writeKeyCode=function(a,b){O&&x.send("8B"+(a?0:49152)+"\t"+b)};this.writeScancode=function(a,b){if(O)if(typeof a=="number"){x.send("840\t"+a);x.send("8449152\t"+a)}else x.send("84"+(a?0:49152)+"\t"+b)};this.writeText=function(a){O&&x.send("86"+a)};this.refuseControl=function(a){O&&x.send("8E3"+a)};this.giveControl=function(a){O&&x.send("8E4"+a)};this.requestControl=function(){O&&x.send("8E2")};var fc=0;this.play=function(){x.send("F3")};this.pause=
function(){x.send("F2")};this.scan=function(a){x.send("F4"+(a?"1":"0"))};z=v=t=C=0;this.showMessage=function(a){var b=B.getFocused();b?b.showMessage(a):hi5.notifications.notify({msg:a})};var Z=new wc,ua={readVar4Bytes:function(a){var b=a.getByte(),c=0;switch((b&192)>>6){case 0:c=b&63;break;case 1:c=(b&63)<<8|a.getByte();break;case 2:c=(b&63)<<16;b=a.getByte();c=c|b<<8;b=a.getByte();c=c|b;break;case 3:c=(b&63)<<24;b=a.getByte();c=c|b<<16;b=a.getByte();c=c|b<<8;b=a.getByte();c=c|b}return c},readVar2Bytes:function(a){var b=
a.getByte();return(b&128)!=0?(b&127)<<8|a.getByte():b}},Xa=0,xc=null;this.close=tc;window.addEventListener("unload",tc,!1);var J=16777215,mb=[],Jb=Array(20)}
function RdpBuffer(m,o,u){var p=o,C=o+u;this.markEnd=function(){C=getPosition()};this.markEnd=function(m){C=m};this.getEnd=function(){return C};this.getStart=function(){return start};this.setStart=function(m){start=m};this.getByte=function(){return m[p++]&255};this.getBytes=function(o){var t;if(m.slice)t=m.slice(p,p+o);else if(m.buffer&&m.buffer.slice)t=new Int8Array(m.buffer.slice(p,p+o));else{t=Array(o);for(var u=0;u<o;u++)t[u]=m[p+u]}p+=o;return t};this.copyToByteArray=function(o,p,u,C){hi5.tool.arraycopy(m,
u,o,p,C)};this.getCapacity=function(){return m.length};this.size=function(){return u};this.getPosition=function(){return p};this.getLittleEndian16=function(){var o=(m[p+1]&255)<<8|m[p]&255;p+=2;return o};this.getBigEndian16=function(){var o=(m[p]&255)<<8|m[p+1]&255;p+=2;return o};this.getLittleEndian32=function(){var o=(m[p+3]&255)<<24|(m[p+2]&255)<<16|(m[p+1]&255)<<8|m[p]&255;p+=4;return o};this.getLittleEndian64=function(){var o=(m[p+7]&255)<<56|(m[p+6]&255)<<48|(m[p+5]&255)<<40|(m[p+4]&255)<<32|
(m[p+3]&255)<<24|(m[p+2]&255)<<16|(m[p+1]&255)<<8|m[p]&255;p+=8;return o};this.getBigEndian32=function(){var o=(m[p]&255)<<24|(m[p+1]&255)<<16|(m[p+2]&255)<<8|m[p+3]&255;p+=4;return o};this.getUnicodeString=function(m,o){for(var p=Math.floor(m/2),u="",A=0;A<p;A++){var C=this.getLittleEndian16();if(o&&0==C){this.skipPosition(2*(p-A-1));break}u+=String.fromCharCode(C)}return u};this.setUnicodeString=function(m){for(var o=m.length,p=0;p<o;p++)this.setLittleEndian16(m.charCodeAt(p))};this.skipPosition=
function(m){p+=m};this.setPosition=function(m){p=m};this.getData=function(){return m};this.setByte=function(o){m[p++]=o};this.setLittleEndian16=function(o){m[p++]=o&255;m[p++]=o>>8&255};this.setLittleEndian32=function(o){m[p++]=o&255;m[p++]=o>>8&255;m[p++]=o>>16&255;m[p++]=o>>24&255}}function Brush(){this.style=this.yOrigin=this.xOrigin=0;this.pattern=Array(8)}function BoundsOrder(){this.bottom=this.top=this.right=this.left=0}
function DeskSaveOrder(){this.action=this.offset=this.bottom=this.top=this.right=this.left=0}function DestBltOrder(){this.opcode=this.cy=this.cx=this.y=this.x=0}function FontData(m,o,u,p,C,v,t){this.font=m;this.character=o;this.offset=u;this.baseline=p;this.width=C;this.height=v;this.fontdata=t}function LineOrder(){this.opcode=this.backgroundColor=this.endY=this.endX=this.startY=this.startX=this.mixmode=0;this.pen=new Pen}
function MemBltOrder(){this.cacheIDX=this.cacheID=this.colorTable=this.srcY=this.srcX=this.opcode=this.cy=this.cx=this.y=this.x=0}function PaletteData(m,o,u,p,C){this.bits=m;this.size=o;this.red=u;this.green=p;this.blue=C}function PatBltOrder(){this.foregroundColor=this.backgroundColor=this.opcode=this.cy=this.cx=this.y=this.x=0;this.brush=new Brush}function Pen(){this.color=this.width=this.style=0}
function PolyLineOrder(){this.dataSize=this.opcode=this.lines=this.foregroundColor=this.flags=this.y=this.x=0;this.data=Array(256)}function RectangleOrder(){this.color=this.cy=this.cx=this.y=this.x=0}function ScreenBltOrder(){this.srcY=this.srcX=this.opcode=this.cy=this.cx=this.y=this.x=0}
function Text2Order(){this.length=this.opcode=this.boxBottom=this.boxRight=this.boxTop=this.boxLeft=this.clipBottom=this.clipRight=this.clipTop=this.clipLeft=this.font=this.unknown=this.y=this.x=this.backgroundColor=this.foregroundColor=this.mixmode=this.flags=0;this.text=Array(256)}function TriBltOrder(){this.foregroundColor=this.backgroundColor=this.opcode=this.cy=this.cx=this.y=this.x=0;this.brush=new Brush;this.unknown=this.srcY=this.srcX=this.cacheIDX=this.cacheID=this.colorTable=0}
var Connection={KEY_IDS:"__CONNS",KEY_TIMESTAMP:"__TIMESTAMP",hasStorage:"localStorage"in window,getAll:function(){var m=localStorage[this.KEY_IDS];return null==m?[]:m.split(",")},saveForm:function(m){for(var m=m.elements,o=m.length,u={},p=null,C=0;C<o;C++){var v=m[C];if("button"!=v.type){var t=v.name,z=v.value;"server"==t&&(p=z);if("checkbox"==v.type)z=v.checked;else if("radio"==v.type&&!v.checked)continue;if("width"==t&&(z=parseInt(z),z==window.innerWidth||z==screen.width))continue;if("height"==
t&&(z=parseInt(z),z==window.innerHeight||z==screen.height))continue;"pwd"!=t&&(u[t]=z)}}return this.save(p,u)?p:null},save:function(m,o){if(null==m)return!1;var u=localStorage[m];localStorage[m]=JSON.stringify(o);var p=localStorage[this.KEY_IDS];null==p?p=m:null==u&&(p=p+","+m);localStorage[this.KEY_IDS]=p;return!0},loadToForm:function(m,o){if(null==o)return!1;var u=localStorage[o];if(null==u)return!1;for(var u=JSON.parse(u),p=m.elements,C=0,v=p.length;C<v;C++){var t=p[C],z=t.type;if(!("button"==
z||"submit"==z)){var V=t.name,A=u[V];if("undefined"==typeof A){if("gateway"!=V)switch(z){case "text":t.value="";break;case "checkbox":t.checked=!1;case "radio":t.checked=!1}}else"startProgram"==V?"shell"==t.id?(t.checked=!0==A||"shell"==A,t.value="shell"):t.checked=A==t.id:"checkbox"==z?t.checked=A:t.value=A}}return!0},clear:function(){localStorage.clear()},remove:function(m){localStorage.removeItem(m);for(var o=this.getAll(),u="",p=0,C=o.length;p<C;p++)m!=o[p]&&(""!=u&&(u+=","),u+=o[p]);localStorage[this.KEY_IDS]=
u},getValue:function(m){return this.hasStorage?localStorage[m]:null},setValue:function(m,o){localStorage[m]=o},removeItem:function(m){localStorage.removeItem(m)}};svGlobal.Rdp=Rdp;
